"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4724],{2952:(_,S,o)=>{o.d(S,{t:()=>g});var c=o(4438),u=o(4742),r=o(177);function f(m,v){if(1&m&&(c.j41(0,"p"),c.EFF(1),c.k0s()),2&m){const h=c.XpG();c.R7$(),c.JRh(h.text)}}let g=(()=>{var m;class v{constructor(){this.text=""}}return(m=v).\u0275fac=function(e){return new(e||m)},m.\u0275cmp=c.VBU({type:m,selectors:[["q-spinner"]],hostVars:2,hostBindings:function(e,M){2&e&&c.HbH(M.expand)},inputs:{text:"text",expand:"expand"},decls:5,vars:1,consts:[[1,"ion-no-padding","ion-no-margin"],[1,"ion-justify-content-center","ion-align-items-center"],[1,"ion-text-center"],[4,"ngIf"]],template:function(e,M){1&e&&(c.j41(0,"ion-grid",0)(1,"ion-row",1)(2,"ion-col",2),c.nrm(3,"ion-spinner"),c.DNE(4,f,2,1,"p",3),c.k0s()()()),2&e&&(c.R7$(4),c.Y8G("ngIf",M.text))},dependencies:[u.hU,u.lO,u.ln,u.w2,r.bT],styles:[".expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{color:var(--quiculum-gray)}"]}),v})()},4724:(_,S,o)=>{o.r(S),o.d(S,{MessageListPageModule:()=>U});var c=o(177),u=o(9417),r=o(4742),f=o(9598),g=o(467),m=o(6090),v=o(3207),h=o(4324),e=o(4438),M=o(1204),R=o(230),E=o(5151),y=o(9196),L=o(1622),T=o(1274),C=o(6186);let I=(()=>{var n;class l extends L.D{constructor(t,i){super(),this.messageService=t,this.loginStatus=i,this.received=[],this.sent=[],this.addSub(this.loginStatus.isLoggedInState.subscribe(a=>{a||this.clear()}))}get hasMoreReceived(){return this.received.length<this.totalNumberOfReceived}get hasMoreSent(){return this.sent.length<this.totalNumberOfSent}initReceived(){var t=this;return(0,g.A)(function*(){return void 0===t.initReceivedPromise&&(t.initReceivedPromise=t.loadReceived(),t.pageReceived=yield t.initReceivedPromise,t.received=t.pageReceived.items),t.received})()}initSent(){var t=this;return(0,g.A)(function*(){return void 0===t.initSentPromise&&(t.initSentPromise=t.loadSent(),t.pageSent=yield t.initSentPromise,t.sent=t.pageSent.items),t.sent})()}clear(){this.clearReceived(),this.clearSent()}clearReceived(){this.initReceivedPromise=void 0,this.pageReceived=void 0,this.received=[],this.totalNumberOfReceived=void 0}clearSent(){this.initSentPromise=void 0,this.pageSent=void 0,this.sent=[],this.totalNumberOfSent=void 0}loadNextPageOfReceived(){var t=this;return(0,g.A)(function*(){let i=t.pageReceived.skip+t.pageReceived.take,a=t.pageReceived.take;t.pageReceived=yield t.loadReceived(i,a),t.received=t.received.concat(t.pageReceived.items)})()}loadNextPageOfSent(){var t=this;return(0,g.A)(function*(){let i=t.pageSent.skip+t.pageSent.take,a=t.pageSent.take;t.pageSent=yield t.loadSent(i,a),t.sent=t.sent.concat(t.pageSent.items)})()}refreshReceived(){var t=this;return(0,g.A)(function*(){t.clearReceived(),t.initReceived()})()}refreshSent(){var t=this;return(0,g.A)(function*(){t.clearSent(),t.initSent()})()}loadReceived(t=0,i=20){var a=this;return(0,g.A)(function*(){let d={skip:t,take:i,includeAllSchools:!0},p=yield a.messageService.getReceived(d);return a.totalNumberOfReceived=p.countAll,p})()}loadSent(t=0,i=20){var a=this;return(0,g.A)(function*(){let d={skip:t,take:i,includeAllSchools:!0},p=yield a.messageService.getSent(d);return a.totalNumberOfSent=p.countAll,p})()}}return(n=l).\u0275fac=function(t){return new(t||n)(e.KVO(T.b),e.KVO(C.B))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();var j=o(7529),O=o(3037),F=o(4416),k=o(2952);function x(n,l){if(1&n){const s=e.RV6();e.j41(0,"ion-item",13),e.bIt("click",function(){const i=e.eBV(s).$implicit,a=e.XpG(2);return e.Njj(a.openMessage(i,!0))}),e.j41(1,"ion-label")(2,"h2"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s(),e.j41(8,"p"),e.EFF(9),e.k0s()()()}if(2&n){const s=l.$implicit;e.R7$(3),e.JRh(s.subject),e.R7$(2),e.E5c(" ",s.sender.firstName," ",s.sender.lastName,", ",s.schoolName," "),e.R7$(2),e.JRh(s.time),e.R7$(2),e.JRh(s.text)}}function A(n,l){if(1&n&&(e.j41(0,"ion-list"),e.DNE(1,x,10,6,"ion-item",12),e.k0s()),2&n){const s=e.XpG();e.R7$(),e.Y8G("ngForOf",s.messages.received)}}function N(n,l){if(1&n){const s=e.RV6();e.j41(0,"ion-item",13),e.bIt("click",function(){const i=e.eBV(s).$implicit,a=e.XpG(2);return e.Njj(a.openMessage(i,!1))}),e.j41(1,"ion-label")(2,"h2"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s(),e.j41(8,"p"),e.EFF(9),e.k0s()()()}if(2&n){const s=l.$implicit,t=e.XpG(2);e.R7$(3),e.JRh(s.subject),e.R7$(2),e.JRh(t.receiverNames(s)),e.R7$(2),e.JRh(s.time),e.R7$(2),e.JRh(s.text)}}function G(n,l){if(1&n&&(e.j41(0,"ion-list"),e.DNE(1,N,10,4,"ion-item",12),e.k0s()),2&n){const s=e.XpG();e.R7$(),e.Y8G("ngForOf",s.messages.sent)}}function $(n,l){1&n&&e.nrm(0,"q-spinner")}function b(n,l){if(1&n){const s=e.RV6();e.j41(0,"ion-button",14),e.bIt("click",function(){e.eBV(s);const i=e.XpG();return e.Njj(i.onClickLoadMore())}),e.nrm(1,"ion-icon",15),e.k0s()}}const D=[{path:"",component:(()=>{var n;class l extends m.v{constructor(t,i,a,d,p,P,B,J,Y,H){super(i,t,a,d,p,P),this.userInfo=P,this.messages=B,this.modalCtrl=J,this.errorHandler=Y,this.newMessageService=H,this.listType="received",this.isInitialized=!1,this.isLoadingMore=!1}ionViewWillEnter(){}ngOnInit(){var t=this;return(0,g.A)(function*(){const i=yield(0,v.s)(t.translateService.get(["MESSAGES_LOADING_MESSAGES"]));t.withSpinner(()=>t.initView(),i.MESSAGES_LOADING_MESSAGES)})()}ionViewDidEnter(){this.newMessageService.newMessageState.next(!1)}onClickCompose(){var t=this;return(0,g.A)(function*(){let i=yield t.modalCtrl.create({component:h.j});i.present(),i.onDidDismiss().then(a=>{a&&a.data&&a.data.message&&t.messages.refreshSent()})})()}onClickLoadMore(){var t=this;return(0,g.A)(function*(){t.isLoadingMore=!0,yield t.loadMore(),t.isLoadingMore=!1})()}get canLoadMore(){return"received"===this.listType&&this.messages.hasMoreReceived||"sent"===this.listType&&this.messages.hasMoreSent}receiverNames(t){return t.receivers.map(i=>i.name).join(", ")}refresh(t){var i=this;return(0,g.A)(function*(){try{"received"===i.listType?yield i.messages.refreshReceived():yield i.messages.refreshSent()}catch(a){i.errorHandler.handleError("Kunde inte ladda nyheter")}finally{t.target.complete()}})()}initView(){var t=this;return(0,g.A)(function*(){t.isInitialized=!1,yield t.messages.initReceived(),yield t.messages.initSent(),t.isInitialized=!0})()}loadMore(){return"received"===this.listType?this.messages.loadNextPageOfReceived():this.messages.loadNextPageOfSent()}openMessage(t,i){this.navTo(["tabs","messages",t.messageId],{queryParams:{replyEnabled:i},state:{message:t,backToPage:"tabs/messages"}})}}return(n=l).\u0275fac=function(t){return new(t||n)(e.rXU(f.Ix),e.rXU(M.$),e.rXU(r.Xi),e.rXU(R.c$),e.rXU(E.p),e.rXU(y.Z),e.rXU(I),e.rXU(r.W3),e.rXU(j.c),e.rXU(O.r))},n.\u0275cmp=e.VBU({type:n,selectors:[["page-message-list"]],features:[e.Vt3],decls:22,vars:14,consts:[[3,"pageTitle"],["slot","fixed",3,"ionRefresh"],[1,"ion-padding"],["color","action",3,"ngModelChange","ngModel"],["value","received"],["value","sent"],[4,"ngIf"],[1,"ion-text-center"],["fill","clear",3,"click",4,"ngIf"],["vertical","bottom","horizontal","end",1,"ion-margin"],["color","action","large-icon","",3,"click"],["name","add"],["type","button",3,"click",4,"ngFor","ngForOf"],["type","button",3,"click"],["fill","clear",3,"click"],["name","ellipsis-horizontal"]],template:function(t,i){1&t&&(e.nrm(0,"app-header",0),e.nI1(1,"translate"),e.j41(2,"ion-content")(3,"ion-refresher",1),e.bIt("ionRefresh",function(d){return i.refresh(d)}),e.nrm(4,"ion-refresher-content"),e.k0s(),e.j41(5,"div",2)(6,"ion-segment",3),e.mxI("ngModelChange",function(d){return e.DH7(i.listType,d)||(i.listType=d),d}),e.j41(7,"ion-segment-button",4),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"ion-segment-button",5),e.EFF(11),e.nI1(12,"translate"),e.k0s()()(),e.DNE(13,A,2,1,"ion-list",6)(14,G,2,1,"ion-list",6),e.j41(15,"div",7),e.DNE(16,$,1,0,"q-spinner",6)(17,b,2,0,"ion-button",8),e.k0s()(),e.j41(18,"ion-footer")(19,"ion-fab",9)(20,"ion-fab-button",10),e.bIt("click",function(){return i.onClickCompose()}),e.nrm(21,"ion-icon",11),e.k0s()()()),2&t&&(e.FS9("pageTitle",e.bMT(1,8,"MESSAGES_TITLE")),e.R7$(6),e.R50("ngModel",i.listType),e.R7$(2),e.SpI(" ",e.bMT(9,10,"RECEIVED")," "),e.R7$(3),e.SpI(" ",e.bMT(12,12,"SENT")," "),e.R7$(2),e.Y8G("ngIf","received"===i.listType),e.R7$(),e.Y8G("ngIf","sent"===i.listType),e.R7$(2),e.Y8G("ngIf",i.isLoadingMore),e.R7$(),e.Y8G("ngIf",i.canLoadMore&&!i.isLoadingMore))},dependencies:[c.Sq,c.bT,u.BC,u.vS,r.Jm,r.W9,r.Q8,r.YW,r.M0,r.iq,r.uz,r.he,r.nf,r.To,r.Ki,r.Gp,r.eP,r.Je,F.l,k.t,R.D9],encapsulation:2}),l})()}];let V=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[f.iI.forChild(D),f.iI]}),l})();var X=o(7019);let U=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[c.MD,u.YN,r.bv,V,R.h,X.h]}),l})()}}]);