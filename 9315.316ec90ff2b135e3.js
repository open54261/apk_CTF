"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9315],{1916:(L,E,n)=>{n.d(E,{$:()=>P});var a=n(467),l=n(3207),r=n(4438),C=n(4742),p=n(230),D=n(5151);let P=(()=>{var e;class M{constructor(o,u,d){this.loadingCtrl=o,this.translateService=u,this.userAlertService=d,this.subscriptions=[],this.showLoading=!1,this.loadingDismissTimeout=-1,this.loadingDismissTimeoutMS=3e4}ngOnDestroy(){this.subscriptions.forEach(o=>o.unsubscribe())}addSub(o){this.subscriptions.push(o)}translate(o,u){var d=this;return(0,a.A)(function*(){return(yield(0,l.s)(d.translateService.get(o)))||u||o})()}withSpinner(o,u,d){var h=this;return(0,a.A)(function*(){let m;yield h.presentLoading(u),h.loadingDismissTimeout=setTimeout(()=>h.timeoutLoading(d),h.loadingDismissTimeoutMS);try{m=yield o()}catch(O){h.userAlertService.debug(O)}return yield h.dismissLoading(),m})()}timeoutLoading(o){var u=this;return(0,a.A)(function*(){o||(o=yield u.translate("LOADING_FAILED")),u.userAlertService.error(o),yield u.dismissLoading()})()}dismissLoading(){var o=this;return(0,a.A)(function*(){-1!=o.loadingDismissTimeout&&(clearTimeout(o.loadingDismissTimeout),o.loadingDismissTimeout=-1),o.showLoading=!1,(yield o.loadingCtrl.getTop())&&(yield o.loadingCtrl.dismiss(null))})()}presentLoading(o){var u=this;return(0,a.A)(function*(){return u.showLoading=!0,yield u.loadingCtrl.create({message:o}).then(d=>{d.present().then(()=>{u.showLoading&&d.dismiss()})})})()}}return(e=M).\u0275fac=function(o){return new(o||e)(r.rXU(C.Xi),r.rXU(p.c$),r.rXU(D.p))},e.\u0275cmp=r.VBU({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(o,u){},encapsulation:2}),M})()},4416:(L,E,n)=>{n.d(E,{l:()=>_});var a=n(4438),l=n(9598),r=n(4742),C=n(177),p=n(230);const D=["*"];function P(o,u){if(1&o&&(a.j41(0,"ion-buttons",5),a.nrm(1,"ion-back-button",6),a.nI1(2,"translate"),a.k0s()),2&o){const d=a.XpG();a.R7$(),a.FS9("text",a.bMT(2,2,"BACK")),a.Y8G("defaultHref",d.backPage)}}function e(o,u){1&o&&(a.j41(0,"ion-menu-toggle",5)(1,"ion-button",7),a.nrm(2,"ion-icon",8),a.k0s()())}function M(o,u){if(1&o&&(a.j41(0,"ion-title"),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&o){const d=a.XpG();a.R7$(),a.SpI(" ",a.bMT(2,1,d.pageTitle)," ")}}let _=(()=>{var o;class u{constructor(h){this.router=h,this.backPage=""}navToMyAccount(){this.router.navigate(["my-account"])}}return(o=u).\u0275fac=function(h){return new(h||o)(a.rXU(l.Ix))},o.\u0275cmp=a.VBU({type:o,selectors:[["app-header"]],inputs:{pageTitle:"pageTitle",backPage:"backPage"},ngContentSelectors:D,decls:9,vars:3,consts:[["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end"],[3,"click"],["name","cog"],["slot","start"],[3,"defaultHref","text"],["size","small","fill","clear"],["name","menu"]],template:function(h,m){1&h&&(a.NAR(),a.j41(0,"ion-header")(1,"ion-toolbar"),a.DNE(2,P,3,4,"ion-buttons",0)(3,e,3,0,"ion-menu-toggle",0)(4,M,3,3,"ion-title",1),a.j41(5,"ion-buttons",2)(6,"ion-button",3),a.bIt("click",function(){return m.navToMyAccount()}),a.nrm(7,"ion-icon",4),a.k0s()()()(),a.SdG(8)),2&h&&(a.R7$(2),a.Y8G("ngIf",m.backPage),a.R7$(),a.Y8G("ngIf",!m.backPage),a.R7$(),a.Y8G("ngIf",!m.isLoadingUserInfo))},dependencies:[r.Jm,r.QW,r.eU,r.iq,r.cA,r.BC,r.ai,r.el,C.bT,p.D9]}),u})()},2952:(L,E,n)=>{n.d(E,{t:()=>p});var a=n(4438),l=n(4742),r=n(177);function C(D,P){if(1&D&&(a.j41(0,"p"),a.EFF(1),a.k0s()),2&D){const e=a.XpG();a.R7$(),a.JRh(e.text)}}let p=(()=>{var D;class P{constructor(){this.text=""}}return(D=P).\u0275fac=function(M){return new(M||D)},D.\u0275cmp=a.VBU({type:D,selectors:[["q-spinner"]],hostVars:2,hostBindings:function(M,_){2&M&&a.HbH(_.expand)},inputs:{text:"text",expand:"expand"},decls:5,vars:1,consts:[[1,"ion-no-padding","ion-no-margin"],[1,"ion-justify-content-center","ion-align-items-center"],[1,"ion-text-center"],[4,"ngIf"]],template:function(M,_){1&M&&(a.j41(0,"ion-grid",0)(1,"ion-row",1)(2,"ion-col",2),a.nrm(3,"ion-spinner"),a.DNE(4,C,2,1,"p",3),a.k0s()()()),2&M&&(a.R7$(4),a.Y8G("ngIf",_.text))},dependencies:[l.hU,l.lO,l.ln,l.w2,r.bT],styles:[".expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{color:var(--quiculum-gray)}"]}),P})()},6090:(L,E,n)=>{n.d(E,{v:()=>M});var a=n(1916),l=n(4438),r=n(1204),C=n(9598),p=n(4742),D=n(230),P=n(5151),e=n(9196);let M=(()=>{var _;class o extends a.${constructor(d,h,m,O,I,T){super(m,O,I),this.account=d,this.router=h,this.userInfoProvider=T}ionViewDidLoad(){}ionViewWillEnter(){}ionViewDidEnter(){}ionViewWillLeave(){}ionViewDidLeave(){}ionViewWillUnload(){}ionViewCanEnter(){return!0}ionViewCanLeave(){return!0}navTo(d,h){const m=Array.isArray(d)?d:[d];this.router.navigate(m,h)}navToUrl(d,h){this.router.navigateByUrl(d,h)}}return(_=o).\u0275fac=function(d){return new(d||_)(l.rXU(r.$),l.rXU(C.Ix),l.rXU(p.Xi),l.rXU(D.c$),l.rXU(P.p),l.rXU(e.Z))},_.\u0275cmp=l.VBU({type:_,selectors:[["ng-component"]],features:[l.Vt3],decls:0,vars:0,template:function(d,h){}}),o})()},9315:(L,E,n)=>{n.r(E),n.d(E,{LunchMenuPageModule:()=>j});var a=n(177),l=n(9417),r=n(4742),C=n(9598),p=n(467),D=n(3207),P=n(6090),e=n(4438),M=n(1204),_=n(230),o=n(5151),u=n(9196),d=n(6244);let h=(()=>{var i;class f{constructor(t){this.api=t,this.getLunchMenuUrl="api/lunchmenu"}getLunchMenu(){return this.api.get(this.getLunchMenuUrl)}}return(i=f).\u0275fac=function(t){return new(t||i)(e.KVO(d.j))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),f})();var m=n(345),O=n(7376),I=n(4078);let T=(()=>{var i;class f{constructor(t){this.ds=t,this.events=[],this.lang="sv",this.selectDay=new e.bkB,this.selectMonth=new e.bkB,this.dateChanged=new e.bkB,this.now=new Date(Date.now()),this.calendarDays=[],this.weeks=[],this.firstWeekDates=[],this.init()}ngOnChanges(){this.buildViewModel()}onClickDay(t){this.selectedDay=t,this.emitSelectDay()}onClickMonth(){this.jumpToThisMonth(),this.selectToday(),this.emitSelectMonth()}onSwipe(t){2==t.direction&&this.forward(),4==t.direction&&this.back()}get selectedYear(){return this.startOfSelectedMonth?this.startOfSelectedMonth.getFullYear().toString():""}onClickWeek(t){console.log("Clicked on Week",this.getWeekNumber(t[0].date))}hasEventsInWeek(t){return t.some(s=>s.numberOfEvents>0)}getWeekNumber(t){if(!t)return 0;const s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),c=new Date(Date.UTC(s.getUTCFullYear(),0,1));return Math.ceil(((+s-+c)/864e5+1)/7)}isSelected(t){return this.selectedDay&&this.ds.isSameDay(t.date,this.selectedDay.date)}getDayClasses(t){let s=[t.isThisMonth?"this-month":"not-this-month"];return t.isToday&&s.push("today"),this.isSelected(t)&&s.push("selected"),t.numberOfEvents>0&&s.push("has-event"),s}jumpToThisMonth(){this.startOfSelectedMonth=this.ds.startOfMonth(this.now),this.buildViewModel()}init(){this.jumpToThisMonth(),this.selectToday()}buildFirstWeekDates(){let t=[],s=this.ds.startOfWeek(this.startOfSelectedMonth);[0,1,2,3,4,5,6].forEach(c=>t.push(this.ds.addDays(s,c))),this.firstWeekDates=t}buildViewModel(){this.calendarDays=[],this.weeks=[],this.buildFirstWeekDates(),this.buildMonth()}buildMonth(){let t=this.ds.startOfWeek(this.startOfSelectedMonth);for(;this.ds.isSameMonth(t,this.startOfSelectedMonth);){let s=[];[0,1,2,3,4,5,6].forEach(c=>{let g=this.buildCalendarDay(this.ds.addDays(t,c));this.calendarDays.push(g),s.push(g)}),this.weeks.push(s),t=this.ds.addDays(t,7)}}nextWeekStartsInSelectedMonth(){let t=this.startOfSelectedMonth.getMonth(),s=O.last(this.calendarDays).date;return this.ds.addDays(s,1).getMonth()===t}buildCalendarDay(t){return{date:t,day:t.getDate(),isThisMonth:t.getMonth()===this.startOfSelectedMonth.getMonth(),isToday:this.ds.isSameDay(t,Date.now()),numberOfEvents:this.getNumberOfEvents(t)}}emitSelectDay(){let t=this.getNextDayWithEvents(this.selectedDay.date);this.selectDay.emit({date:this.selectedDay.date,numberOfEvents:this.selectedDay.numberOfEvents,nextDateWithEvents:t?t.date:null})}emitSelectMonth(){let t={firstVisibleDate:O.first(this.calendarDays).date,lastVisibleDate:O.last(this.calendarDays).date,startDate:this.ds.startOfMonth(this.startOfSelectedMonth),endDate:this.ds.endOfMonth(this.startOfSelectedMonth)};this.selectMonth.emit(t)}getNextDayWithEvents(t){for(var c=O.findIndex(this.calendarDays,g=>this.ds.isSameDay(g.date,t));c<this.calendarDays.length;c++){let g=this.calendarDays[c];if(g.numberOfEvents>0)return g}return null}getNumberOfEvents(t){let s=O.find(this.events,c=>this.ds.isSameDay(c.date,t));return s?s.numberOfEvents:0}selectToday(){let t=O.find(this.calendarDays,s=>this.ds.isSameDay(s.date,this.now));this.selectedDay=t}back(){this.selectedDate.setDate(this.selectedDate.getDate()-7),this.updateWeek(),this.dateChanged.emit(this.selectedDate)}forward(){this.selectedDate.setDate(this.selectedDate.getDate()+7),this.updateWeek(),this.dateChanged.emit(this.selectedDate)}updateWeek(){this.startOfSelectedWeek=new Date(this.selectedDate),this.startOfSelectedWeek.setDate(this.selectedDate.getDate()-this.selectedDate.getDay()),this.endOfSelectedWeek=new Date(this.selectedDate),this.endOfSelectedWeek.setDate(this.selectedDate.getDate()-this.selectedDate.getDay()+6)}}return(i=f).\u0275fac=function(t){return new(t||i)(e.rXU(I.k))},i.\u0275cmp=e.VBU({type:i,selectors:[["calendar-week"]],inputs:{events:"events",lang:"lang",selectedDate:"selectedDate"},outputs:{selectDay:"selectDay",selectMonth:"selectMonth",dateChanged:"dateChanged"},features:[e.OA$],decls:12,vars:1,consts:[["id","calendar",3,"swipe"],[1,"ion-no-padding"],[1,"ion-justify-content-center"],["size","2",1,"ion-text-center"],["size","small",3,"click"],["name","chevron-back"],["size","8",1,"ion-text-center"],["size","small","fill","clear"],["name","chevron-forward"]],template:function(t,s){1&t&&(e.j41(0,"div",0),e.bIt("swipe",function(g){return s.onSwipe(g)}),e.j41(1,"ion-grid",1)(2,"ion-row",2)(3,"ion-col",3)(4,"ion-button",4),e.bIt("click",function(){return s.back()}),e.nrm(5,"ion-icon",5),e.k0s()(),e.j41(6,"ion-col",6)(7,"ion-button",7),e.EFF(8),e.k0s()(),e.j41(9,"ion-col",3)(10,"ion-button",4),e.bIt("click",function(){return s.forward()}),e.nrm(11,"ion-icon",8),e.k0s()()()()()),2&t&&(e.R7$(8),e.SpI(" Vecka ",s.getWeekNumber(s.selectedDate)," "))},dependencies:[r.Jm,r.hU,r.lO,r.iq,r.ln],styles:["#calendar[_ngcontent-%COMP%]{font-family:Helvetica,Arial,sans-serif}#calendar[_ngcontent-%COMP%]   .calendar-header-col[_ngcontent-%COMP%]{font-size:.75rem;text-align:center;color:#666}#calendar[_ngcontent-%COMP%]   .calendar-row[_ngcontent-%COMP%]:last-child{border-bottom:1px solid #eee}#calendar[_ngcontent-%COMP%]   .calendar-row[_ngcontent-%COMP%]   .calendar-col[_ngcontent-%COMP%]{padding:.5em!important;display:flex;justify-content:center;text-align:center;padding:.8rem;font-size:.8rem;border-left:1px solid #eee;border-top:1px solid #eee}#calendar[_ngcontent-%COMP%]   .calendar-row[_ngcontent-%COMP%]   .calendar-col[_ngcontent-%COMP%]:last-child{border-right:1px solid #eee}#calendar[_ngcontent-%COMP%]   .calendar-row[_ngcontent-%COMP%]   .not-this-month[_ngcontent-%COMP%]{color:#989898;background:#eee}#calendar[_ngcontent-%COMP%]   .calendar-row[_ngcontent-%COMP%]   .today[_ngcontent-%COMP%]{text-decoration:underline}#calendar[_ngcontent-%COMP%]   .calendar-row[_ngcontent-%COMP%]   .event-blip[_ngcontent-%COMP%]{background:var(--quiculum-pink);width:.5rem;height:.5rem;display:inline-block;border-radius:.25rem;position:absolute;top:3.5px;right:3.5px}#calendar[_ngcontent-%COMP%]   .calendar-row[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{box-shadow:none;color:#fff;background:var(--quiculum-pink-tint)}"]}),f})();var U=n(4416),y=n(2952);function k(i,f){1&i&&(e.j41(0,"div",4),e.nrm(1,"q-spinner"),e.k0s())}function A(i,f){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title",6),e.EFF(3),e.k0s()(),e.nrm(4,"ion-card-content",7),e.k0s()),2&i){const v=f.$implicit,t=e.XpG(2);e.R7$(3),e.JRh(t.getDayOfWeek(v.date)),e.R7$(),e.Y8G("innerHTML",t.sanitizeHtml(v.text),e.npT)}}function R(i,f){if(1&i&&(e.j41(0,"div"),e.DNE(1,A,5,2,"ion-card",5),e.k0s()),2&i){const v=e.XpG();e.R7$(),e.Y8G("ngForOf",v.selectedWeek.lunch)}}function b(i,f){1&i&&(e.j41(0,"div")(1,"ion-card")(2,"ion-card-content")(3,"ion-label",8),e.EFF(4),e.nI1(5,"translate"),e.k0s()()()()),2&i&&(e.R7$(4),e.JRh(e.bMT(5,1,"NO_LUNCH")))}const x=[{path:"",component:(()=>{var i;class f extends P.v{constructor(t,s,c,g,S,W,B,H,N){super(t,s,c,g,S,W),this.modalCtrl=B,this.lunchMenuService=H,this.sanitizer=N,this.selectedDate=new Date,this.isBusy=!1,this.userInfo={},this.lunchMenu=[],this.initLang()}get isGuardian(){return this.userInfo&&"Guardian"==this.userInfo.roleName}ngOnInit(){return(0,p.A)(function*(){})()}ionViewWillEnter(){var t=this;return(0,p.A)(function*(){t.isBusy=!0,t.addSub(t.userInfoProvider.userInfoState.subscribe(s=>t.userInfo=s)),yield t.getLunchMenu(),t.isBusy=!1})()}navToMyAccount(){this.navTo("my-account")}initLang(){var t=this;return(0,p.A)(function*(){t.translations=yield(0,D.s)(t.translateService.get(["SEARCH","SEARCH_BY_NAME_OR_SUBJECT"]))})()}getLunchMenu(){var t=this;return(0,p.A)(function*(){try{t.lunchMenu=yield t.lunchMenuService.getLunchMenu(),t.groupedByWeek=t.groupByYearAndWeek(t.lunchMenu),t.updateWeek()}catch(s){console.error("Error fetching lunch menu:",s)}})()}groupByYearAndWeek(t){const s={};for(const g of t){const S=new Date(g.date),W=S.getFullYear(),B=this.getISOWeek(S).toString();s[W]||(s[W]={}),s[W][B]||(s[W][B]=[]),s[W][B].push(g)}const c=[];for(const g in s)for(const S in s[g])c.push({year:+g,week:+S,lunch:s[g][S]});return c}getISOWeek(t){const s=new Date(t);s.setHours(0,0,0,0),s.setDate(s.getDate()+3-(s.getDay()+6)%7);const c=new Date(s.getFullYear(),0,4);return c.setDate(c.getDate()+3-(c.getDay()+6)%7),Math.round(((s.getTime()-c.getTime())/864e5+1)/7)}updateWeek(){if(this.selectedDate){const t=this.getISOWeek(this.selectedDate),s=this.selectedDate.getFullYear(),c=this.groupedByWeek.filter(g=>g.week===t&&g.year===s);this.selectedWeek=null,c.length>0&&c[0].lunch.length>0&&(this.selectedWeek=c[0])}}getDayOfWeek(t){return["S\xf6ndag","M\xe5ndag","Tisdag","Onsdag","Torsdag","Fredag","L\xf6rdag"][new Date(t).getDay()]}handleDateChange(t){this.updateWeek()}sanitizeHtml(t){return this.sanitizer.bypassSecurityTrustHtml(t)}}return(i=f).\u0275fac=function(t){return new(t||i)(e.rXU(M.$),e.rXU(C.Ix),e.rXU(r.Xi),e.rXU(_.c$),e.rXU(o.p),e.rXU(u.Z),e.rXU(r.W3),e.rXU(h),e.rXU(m.up))},i.\u0275cmp=e.VBU({type:i,selectors:[["page-lunch-menu"]],features:[e.Vt3],decls:7,vars:7,consts:[[3,"pageTitle"],["class","ion-padding-top",4,"ngIf"],[3,"dateChanged","selectedDate"],[4,"ngIf"],[1,"ion-padding-top"],[4,"ngFor","ngForOf"],["size","small"],[3,"innerHTML"],[1,"text"]],template:function(t,s){1&t&&(e.nrm(0,"app-header",0),e.nI1(1,"translate"),e.j41(2,"ion-content"),e.DNE(3,k,2,0,"div",1),e.j41(4,"calendar-week",2),e.bIt("dateChanged",function(g){return s.handleDateChange(g)}),e.k0s(),e.DNE(5,R,2,1,"div",3)(6,b,6,3,"div",3),e.k0s()),2&t&&(e.FS9("pageTitle",e.bMT(1,5,"LUNCHMENU")),e.R7$(3),e.Y8G("ngIf",s.isBusy),e.R7$(),e.Y8G("selectedDate",s.selectedDate),e.R7$(),e.Y8G("ngIf",s.selectedWeek&&s.selectedWeek.lunch),e.R7$(),e.Y8G("ngIf",!s.selectedWeek||!s.selectedWeek.lunch||0===s.selectedWeek.lunch.length))},dependencies:[a.Sq,a.bT,r.b_,r.I9,r.ME,r.tN,r.W9,r.he,T,U.l,y.t,_.D9],styles:[".userinfo[_ngcontent-%COMP%]{text-align:center;font:1em sans-serif;padding:300px}"]}),f})()}];let K=(()=>{var i;class f{}return(i=f).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[C.iI.forChild(x),C.iI]}),f})();var w=n(7019),V=n(1683);let j=(()=>{var i;class f{}return(i=f).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[a.MD,l.YN,r.bv,K,w.h,_.h,V.Y]}),f})()},1204:(L,E,n)=>{n.d(E,{$:()=>h});var a=n(467),l=n(4438),r=n(4538),C=n(5320),p=n(9196),D=n(772),P=n(6186),e=n(2840),M=n(3656),_=n(2457),o=n(4840),u=n(7643),d=n(2618);let h=(()=>{var m;class O{constructor(T,U,y,k,A,R,b,F,x,K,w){this.loginSchool=T,this.token=U,this.userInfo=y,this.userSettings=k,this.loginStatus=A,this.roleService=R,this.platform=b,this.push=F,this.rolesProvider=x,this.moduleService=K,this.moduleSettingProvider=w}clearStudentCardPage(){this.studentCardPage&&this.studentCardPage.ngOnDestroy()}logout(){this.token.clearToken(),this.userInfo.clear(),this.rolesProvider.clear(),this.moduleSettingProvider.clear(),this.clearStudentCardPage(),this.loginStatus.setStatus(!1),(this.platform.is("capacitor")||this.platform.is("cordova"))&&this.push.removePushToken()}changeRole(T,U){var y=this;return(0,a.A)(function*(){const k=yield y.roleService.changeRole(T,U);yield y.token.updateToken(k),y.userInfo.refresh();let A=yield y.userInfo.init();y.loginStatus.setRole(A.roleName),y.moduleSettingProvider.updateModuleSettings()})()}logOutAndForgetSchool(){this.logout(),this.loginSchool.clearLoginSchool(),this.userSettings.clearUserSettings()}logOutAndForgetSchoolAndSettings(){this.logout(),this.loginSchool.clearLoginSchool(),this.userSettings.clearUserSettings()}}return(m=O).\u0275fac=function(T){return new(T||m)(l.KVO(r.d),l.KVO(C.x),l.KVO(p.Z),l.KVO(D.w),l.KVO(P.B),l.KVO(e.W),l.KVO(M.OD),l.KVO(_.T),l.KVO(o.L),l.KVO(u.v),l.KVO(d.C))},m.\u0275prov=l.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),O})()}}]);