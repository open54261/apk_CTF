"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4262],{1916:(U,M,e)=>{e.d(M,{$:()=>t});var o=e(467),r=e(3207),l=e(4438),E=e(4742),P=e(230),h=e(5151);let t=(()=>{var f;class p{constructor(i,c,a){this.loadingCtrl=i,this.translateService=c,this.userAlertService=a,this.subscriptions=[],this.showLoading=!1,this.loadingDismissTimeout=-1,this.loadingDismissTimeoutMS=3e4}ngOnDestroy(){this.subscriptions.forEach(i=>i.unsubscribe())}addSub(i){this.subscriptions.push(i)}translate(i,c){var a=this;return(0,o.A)(function*(){return(yield(0,r.s)(a.translateService.get(i)))||c||i})()}withSpinner(i,c,a){var d=this;return(0,o.A)(function*(){let g;yield d.presentLoading(c),d.loadingDismissTimeout=setTimeout(()=>d.timeoutLoading(a),d.loadingDismissTimeoutMS);try{g=yield i()}catch(D){d.userAlertService.debug(D)}return yield d.dismissLoading(),g})()}timeoutLoading(i){var c=this;return(0,o.A)(function*(){i||(i=yield c.translate("LOADING_FAILED")),c.userAlertService.error(i),yield c.dismissLoading()})()}dismissLoading(){var i=this;return(0,o.A)(function*(){-1!=i.loadingDismissTimeout&&(clearTimeout(i.loadingDismissTimeout),i.loadingDismissTimeout=-1),i.showLoading=!1,(yield i.loadingCtrl.getTop())&&(yield i.loadingCtrl.dismiss(null))})()}presentLoading(i){var c=this;return(0,o.A)(function*(){return c.showLoading=!0,yield c.loadingCtrl.create({message:i}).then(a=>{a.present().then(()=>{c.showLoading&&a.dismiss()})})})()}}return(f=p).\u0275fac=function(i){return new(i||f)(l.rXU(E.Xi),l.rXU(P.c$),l.rXU(h.p))},f.\u0275cmp=l.VBU({type:f,selectors:[["ng-component"]],decls:0,vars:0,template:function(i,c){},encapsulation:2}),p})()},4416:(U,M,e)=>{e.d(M,{l:()=>v});var o=e(4438),r=e(9598),l=e(4742),E=e(177),P=e(230);const h=["*"];function t(i,c){if(1&i&&(o.j41(0,"ion-buttons",5),o.nrm(1,"ion-back-button",6),o.nI1(2,"translate"),o.k0s()),2&i){const a=o.XpG();o.R7$(),o.FS9("text",o.bMT(2,2,"BACK")),o.Y8G("defaultHref",a.backPage)}}function f(i,c){1&i&&(o.j41(0,"ion-menu-toggle",5)(1,"ion-button",7),o.nrm(2,"ion-icon",8),o.k0s()())}function p(i,c){if(1&i&&(o.j41(0,"ion-title"),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&i){const a=o.XpG();o.R7$(),o.SpI(" ",o.bMT(2,1,a.pageTitle)," ")}}let v=(()=>{var i;class c{constructor(d){this.router=d,this.backPage=""}navToMyAccount(){this.router.navigate(["my-account"])}}return(i=c).\u0275fac=function(d){return new(d||i)(o.rXU(r.Ix))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-header"]],inputs:{pageTitle:"pageTitle",backPage:"backPage"},ngContentSelectors:h,decls:9,vars:3,consts:[["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end"],[3,"click"],["name","cog"],["slot","start"],[3,"defaultHref","text"],["size","small","fill","clear"],["name","menu"]],template:function(d,g){1&d&&(o.NAR(),o.j41(0,"ion-header")(1,"ion-toolbar"),o.DNE(2,t,3,4,"ion-buttons",0)(3,f,3,0,"ion-menu-toggle",0)(4,p,3,3,"ion-title",1),o.j41(5,"ion-buttons",2)(6,"ion-button",3),o.bIt("click",function(){return g.navToMyAccount()}),o.nrm(7,"ion-icon",4),o.k0s()()()(),o.SdG(8)),2&d&&(o.R7$(2),o.Y8G("ngIf",g.backPage),o.R7$(),o.Y8G("ngIf",!g.backPage),o.R7$(),o.Y8G("ngIf",!g.isLoadingUserInfo))},dependencies:[l.Jm,l.QW,l.eU,l.iq,l.cA,l.BC,l.ai,l.el,E.bT,P.D9]}),c})()},2952:(U,M,e)=>{e.d(M,{t:()=>P});var o=e(4438),r=e(4742),l=e(177);function E(h,t){if(1&h&&(o.j41(0,"p"),o.EFF(1),o.k0s()),2&h){const f=o.XpG();o.R7$(),o.JRh(f.text)}}let P=(()=>{var h;class t{constructor(){this.text=""}}return(h=t).\u0275fac=function(p){return new(p||h)},h.\u0275cmp=o.VBU({type:h,selectors:[["q-spinner"]],hostVars:2,hostBindings:function(p,v){2&p&&o.HbH(v.expand)},inputs:{text:"text",expand:"expand"},decls:5,vars:1,consts:[[1,"ion-no-padding","ion-no-margin"],[1,"ion-justify-content-center","ion-align-items-center"],[1,"ion-text-center"],[4,"ngIf"]],template:function(p,v){1&p&&(o.j41(0,"ion-grid",0)(1,"ion-row",1)(2,"ion-col",2),o.nrm(3,"ion-spinner"),o.DNE(4,E,2,1,"p",3),o.k0s()()()),2&p&&(o.R7$(4),o.Y8G("ngIf",v.text))},dependencies:[r.hU,r.lO,r.ln,r.w2,l.bT],styles:[".expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{color:var(--quiculum-gray)}"]}),t})()},6090:(U,M,e)=>{e.d(M,{v:()=>p});var o=e(1916),r=e(4438),l=e(1204),E=e(9598),P=e(4742),h=e(230),t=e(5151),f=e(9196);let p=(()=>{var v;class i extends o.${constructor(a,d,g,D,A,T){super(g,D,A),this.account=a,this.router=d,this.userInfoProvider=T}ionViewDidLoad(){}ionViewWillEnter(){}ionViewDidEnter(){}ionViewWillLeave(){}ionViewDidLeave(){}ionViewWillUnload(){}ionViewCanEnter(){return!0}ionViewCanLeave(){return!0}navTo(a,d){const g=Array.isArray(a)?a:[a];this.router.navigate(g,d)}navToUrl(a,d){this.router.navigateByUrl(a,d)}}return(v=i).\u0275fac=function(a){return new(a||v)(r.rXU(l.$),r.rXU(E.Ix),r.rXU(P.Xi),r.rXU(h.c$),r.rXU(t.p),r.rXU(f.Z))},v.\u0275cmp=r.VBU({type:v,selectors:[["ng-component"]],features:[r.Vt3],decls:0,vars:0,template:function(a,d){}}),i})()},4262:(U,M,e)=>{e.r(M),e.d(M,{NotificationsPageModule:()=>F});var o=e(177),r=e(9417),l=e(4742),E=e(9598),P=e(467),h=e(6090),t=e(4438),f=e(1204),p=e(6244),v=e(1626);let i=(()=>{var s;class m{constructor(n){this.http=n}mapToIonIcon(n){switch(n){case"fa-bullhorn":case"fa-bullhorn-o":return"megaphone";case"fa-home":return"home";case"fa-user":return"person";case"fa-users":return"people";case"fa-bell":case"fa-bell-o":return"notifications";case"fa-e-mail":case"fa-e-mail-o":case"fa-envelope":case"fa-envelope-o":case"fa-mail":case"fa-mail-o":return"mail-outline";case"fa-comments-o":return"chatbubbles-outline";default:return"star"}}}return(s=m).\u0275fac=function(n){return new(n||s)(t.KVO(v.Qq))},s.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),m})();var c=e(7529),a=e(230),d=e(5151),g=e(9196),D=e(1622),A=e(6186),T=e(4078);let L=(()=>{var s;class m extends D.D{constructor(n,u,I){super(),this.api=n,this.loginStatus=u,this.dateService=I,this.listEndpoint="api/systemnotices",this.list=[],this.addSub(this.loginStatus.isLoggedInState.subscribe(C=>{C||this.clear()}))}get hasMore(){return this.list.length<this.totalNumberOfNotices&&this.lastNoticeIsAfterServerUpdateWithItemIdsInNotices()}init(){var n=this;return(0,P.A)(function*(){return void 0===n.initPromise&&(n.initPromise=n.loadList(),n.page=yield n.initPromise,n.list=n.page.items.filter(u=>n.noticeIsAfterServerUpdateWithItemIdsInNotices(u))),n.list})()}clear(){this.initPromise=void 0,this.page=void 0,this.list=[]}loadNextPage(){var n=this;return(0,P.A)(function*(){let u=n.page.skip+n.page.take,I=n.page.take;n.page=yield n.loadList(u,I),n.list=n.list.concat(n.page.items.filter(C=>n.noticeIsAfterServerUpdateWithItemIdsInNotices(C)))})()}refresh(){var n=this;return(0,P.A)(function*(){let u=yield n.loadList();n.list=u.items.filter(I=>n.noticeIsAfterServerUpdateWithItemIdsInNotices(I))})()}noticeIsAfterServerUpdateWithItemIdsInNotices(n){let u=new Date(2019,2,7);return this.dateService.isBefore(u,n.time)}lastNoticeIsAfterServerUpdateWithItemIdsInNotices(){let n=this.list.length?this.list[this.list.length-1]:null;return n&&this.noticeIsAfterServerUpdateWithItemIdsInNotices(n)}loadList(n=0,u=20){var I=this;return(0,P.A)(function*(){let C={skip:n,take:u,includeAllSchools:!0},R=yield I.api.get(I.listEndpoint,C);return I.totalNumberOfNotices=R.countAll,R})()}}return(s=m).\u0275fac=function(n){return new(n||s)(t.KVO(p.j),t.KVO(A.B),t.KVO(T.k))},s.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),m})();var O=e(4416),S=e(2952);function y(s,m){if(1&s&&(t.j41(0,"p",10),t.EFF(1),t.k0s()),2&s){const _=t.XpG().$implicit;t.R7$(),t.JRh(_.title)}}function N(s,m){if(1&s&&(t.j41(0,"p",11),t.EFF(1),t.k0s()),2&s){const _=t.XpG().$implicit;t.R7$(),t.JRh(_.text)}}function B(s,m){if(1&s){const _=t.RV6();t.j41(0,"ion-item",6),t.bIt("click",function(){const u=t.eBV(_).$implicit,I=t.XpG();return t.Njj(I.onClickNotice(u))}),t.nrm(1,"ion-icon",7),t.j41(2,"ion-label"),t.DNE(3,y,2,1,"p",8)(4,N,2,1,"p",9),t.k0s()()}if(2&s){const _=m.$implicit,n=t.XpG();t.R7$(),t.xc7("color",n.iconColor(_)),t.Y8G("name",n.icons.mapToIonIcon(_.icon)),t.R7$(2),t.Y8G("ngIf",_.title),t.R7$(),t.Y8G("ngIf",_.text)}}function K(s,m){1&s&&t.nrm(0,"q-spinner",12)}function W(s,m){if(1&s){const _=t.RV6();t.j41(0,"ion-button",13),t.bIt("click",function(){t.eBV(_);const u=t.XpG();return t.Njj(u.onClickLoadMore())}),t.nrm(1,"ion-icon",14),t.k0s()}}const x=[{path:"",component:(()=>{var s;class m extends h.v{constructor(n,u,I,C,R,H,Y,k,X,J){super(n,I,u,Y,k,X),this.api=C,this.icons=R,this.errorHandler=H,this.userInfo=X,this.systemNotices=J,this.isLoadingMore=!1}iconColor({color:n}){return n||"black"}ionViewDidEnter(){this.loadInitial()}onClickNotice(n){switch(n.moduleId){case"messages":this.navTo(["tabs","messages",n.itemId],{queryParams:{replyEnabled:!0},state:{backToPage:"notifications"}});break;case"noticeboard":this.navTo(["tabs","notice-board",n.itemId],{noticeId:n.itemId,state:{backToPage:"notifications"}});break;case"appointments":this.navTo("appointments");break;case"preschooldocumentation":this.navTo("documentation")}}onClickLoadMore(){this.loadMore()}canLoadMore(){return this.systemNotices.hasMore}loadInitial(){return this.systemNotices.refresh(),this.withSpinner(()=>this.systemNotices.init())}loadMore(){var n=this;return(0,P.A)(function*(){n.isLoadingMore=!0,yield n.systemNotices.loadNextPage(),n.isLoadingMore=!1})()}refresh(n){var u=this;return(0,P.A)(function*(){u.clear();try{yield u.loadInitial()}catch(I){u.errorHandler.handleError("Kunde inte ladda notiser")}finally{n.target.complete()}})()}clear(){this.systemNotices.clear()}}return(s=m).\u0275fac=function(n){return new(n||s)(t.rXU(f.$),t.rXU(l.Xi),t.rXU(E.Ix),t.rXU(p.j),t.rXU(i),t.rXU(c.c),t.rXU(a.c$),t.rXU(d.p),t.rXU(g.Z),t.rXU(L))},s.\u0275cmp=t.VBU({type:s,selectors:[["page-notifications"]],features:[t.Vt3],decls:10,vars:6,consts:[[3,"pageTitle"],["slot","fixed",3,"ionRefresh"],["button","",3,"click",4,"ngFor","ngForOf"],[1,"ion-text-center"],["class","ion-margin-top",4,"ngIf"],["fill","clear",3,"click",4,"ngIf"],["button","",3,"click"],["slot","start",3,"name"],["class","title",4,"ngIf"],["class","text",4,"ngIf"],[1,"title"],[1,"text"],[1,"ion-margin-top"],["fill","clear",3,"click"],["name","ellipsis-horizontal"]],template:function(n,u){1&n&&(t.nrm(0,"app-header",0),t.nI1(1,"translate"),t.j41(2,"ion-content")(3,"ion-refresher",1),t.bIt("ionRefresh",function(C){return u.refresh(C)}),t.nrm(4,"ion-refresher-content"),t.k0s(),t.j41(5,"ion-list"),t.DNE(6,B,5,5,"ion-item",2),t.k0s(),t.j41(7,"div",3),t.DNE(8,K,1,0,"q-spinner",4)(9,W,2,0,"ion-button",5),t.k0s()()),2&n&&(t.FS9("pageTitle",t.bMT(1,4,"NOTIFICATIONS_TITLE")),t.R7$(6),t.Y8G("ngForOf",u.systemNotices.list),t.R7$(2),t.Y8G("ngIf",u.isLoadingMore),t.R7$(),t.Y8G("ngIf",u.canLoadMore&&!u.isLoadingMore))},dependencies:[o.Sq,o.bT,l.Jm,l.W9,l.iq,l.uz,l.he,l.nf,l.To,l.Ki,O.l,S.t,a.D9]}),m})()}];let j=(()=>{var s;class m{}return(s=m).\u0275fac=function(n){return new(n||s)},s.\u0275mod=t.$C({type:s}),s.\u0275inj=t.G2t({imports:[E.iI.forChild(x),E.iI]}),m})();var $=e(7019),G=e(1683),b=e(60);let F=(()=>{var s;class m{}return(s=m).\u0275fac=function(n){return new(n||s)},s.\u0275mod=t.$C({type:s}),s.\u0275inj=t.G2t({imports:[o.MD,r.YN,l.bv,j,$.h,a.h,G.Y,b.dX]}),m})()},1204:(U,M,e)=>{e.d(M,{$:()=>d});var o=e(467),r=e(4438),l=e(4538),E=e(5320),P=e(9196),h=e(772),t=e(6186),f=e(2840),p=e(3656),v=e(2457),i=e(4840),c=e(7643),a=e(2618);let d=(()=>{var g;class D{constructor(T,L,O,S,y,N,B,K,W,V,x){this.loginSchool=T,this.token=L,this.userInfo=O,this.userSettings=S,this.loginStatus=y,this.roleService=N,this.platform=B,this.push=K,this.rolesProvider=W,this.moduleService=V,this.moduleSettingProvider=x}clearStudentCardPage(){this.studentCardPage&&this.studentCardPage.ngOnDestroy()}logout(){this.token.clearToken(),this.userInfo.clear(),this.rolesProvider.clear(),this.moduleSettingProvider.clear(),this.clearStudentCardPage(),this.loginStatus.setStatus(!1),(this.platform.is("capacitor")||this.platform.is("cordova"))&&this.push.removePushToken()}changeRole(T,L){var O=this;return(0,o.A)(function*(){const S=yield O.roleService.changeRole(T,L);yield O.token.updateToken(S),O.userInfo.refresh();let y=yield O.userInfo.init();O.loginStatus.setRole(y.roleName),O.moduleSettingProvider.updateModuleSettings()})()}logOutAndForgetSchool(){this.logout(),this.loginSchool.clearLoginSchool(),this.userSettings.clearUserSettings()}logOutAndForgetSchoolAndSettings(){this.logout(),this.loginSchool.clearLoginSchool(),this.userSettings.clearUserSettings()}}return(g=D).\u0275fac=function(T){return new(T||g)(r.KVO(l.d),r.KVO(E.x),r.KVO(P.Z),r.KVO(h.w),r.KVO(t.B),r.KVO(f.W),r.KVO(p.OD),r.KVO(v.T),r.KVO(i.L),r.KVO(c.v),r.KVO(a.C))},g.\u0275prov=r.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),D})()}}]);