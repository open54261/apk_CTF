"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2607],{4416:(j,k,d)=>{d.d(k,{l:()=>D});var l=d(4438),c=d(9598),s=d(4742),m=d(177),b=d(230);const e=["*"];function S(v,O){if(1&v&&(l.j41(0,"ion-buttons",5),l.nrm(1,"ion-back-button",6),l.nI1(2,"translate"),l.k0s()),2&v){const p=l.XpG();l.R7$(),l.FS9("text",l.bMT(2,2,"BACK")),l.Y8G("defaultHref",p.backPage)}}function A(v,O){1&v&&(l.j41(0,"ion-menu-toggle",5)(1,"ion-button",7),l.nrm(2,"ion-icon",8),l.k0s()())}function I(v,O){if(1&v&&(l.j41(0,"ion-title"),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&v){const p=l.XpG();l.R7$(),l.SpI(" ",l.bMT(2,1,p.pageTitle)," ")}}let D=(()=>{var v;class O{constructor(G){this.router=G,this.backPage=""}navToMyAccount(){this.router.navigate(["my-account"])}}return(v=O).\u0275fac=function(G){return new(G||v)(l.rXU(c.Ix))},v.\u0275cmp=l.VBU({type:v,selectors:[["app-header"]],inputs:{pageTitle:"pageTitle",backPage:"backPage"},ngContentSelectors:e,decls:9,vars:3,consts:[["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end"],[3,"click"],["name","cog"],["slot","start"],[3,"defaultHref","text"],["size","small","fill","clear"],["name","menu"]],template:function(G,y){1&G&&(l.NAR(),l.j41(0,"ion-header")(1,"ion-toolbar"),l.DNE(2,S,3,4,"ion-buttons",0)(3,A,3,0,"ion-menu-toggle",0)(4,I,3,3,"ion-title",1),l.j41(5,"ion-buttons",2)(6,"ion-button",3),l.bIt("click",function(){return y.navToMyAccount()}),l.nrm(7,"ion-icon",4),l.k0s()()()(),l.SdG(8)),2&G&&(l.R7$(2),l.Y8G("ngIf",y.backPage),l.R7$(),l.Y8G("ngIf",!y.backPage),l.R7$(),l.Y8G("ngIf",!y.isLoadingUserInfo))},dependencies:[s.Jm,s.QW,s.eU,s.iq,s.cA,s.BC,s.ai,s.el,m.bT,b.D9]}),O})()},2952:(j,k,d)=>{d.d(k,{t:()=>b});var l=d(4438),c=d(4742),s=d(177);function m(e,S){if(1&e&&(l.j41(0,"p"),l.EFF(1),l.k0s()),2&e){const A=l.XpG();l.R7$(),l.JRh(A.text)}}let b=(()=>{var e;class S{constructor(){this.text=""}}return(e=S).\u0275fac=function(I){return new(I||e)},e.\u0275cmp=l.VBU({type:e,selectors:[["q-spinner"]],hostVars:2,hostBindings:function(I,D){2&I&&l.HbH(D.expand)},inputs:{text:"text",expand:"expand"},decls:5,vars:1,consts:[[1,"ion-no-padding","ion-no-margin"],[1,"ion-justify-content-center","ion-align-items-center"],[1,"ion-text-center"],[4,"ngIf"]],template:function(I,D){1&I&&(l.j41(0,"ion-grid",0)(1,"ion-row",1)(2,"ion-col",2),l.nrm(3,"ion-spinner"),l.DNE(4,m,2,1,"p",3),l.k0s()()()),2&I&&(l.R7$(4),l.Y8G("ngIf",D.text))},dependencies:[c.hU,c.lO,c.ln,c.w2,s.bT],styles:[".expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{color:var(--quiculum-gray)}"]}),S})()},1876:(j,k,d)=>{d.d(k,{Y:()=>l});class l{constructor(s){this._selectedItems=[],this.equalityFunction=(m,b)=>m==b,s&&(this.equalityFunction=s)}get isAnySelected(){return this._selectedItems.length>0}get selectedItems(){return this._selectedItems}isSelected(s){return!!this.selectedItems.find(b=>this.equalityFunction(s,b))}clear(){this._selectedItems=[]}deselectItem(s){let b=this.selectedItems.findIndex(e=>this.equalityFunction(s,e));b>-1&&this.selectedItems.splice(b,1)}selectItem(s){this.isSelected(s)||this.selectedItems.push(s)}selectItems(s){s.forEach(m=>this.selectItem(m))}setSelectedItems(s){this._selectedItems=s}toggleItem(s){this.isSelected(s)?this.deselectItem(s):this.selectItem(s)}}},1106:(j,k,d)=>{d.d(k,{U:()=>c});var l=d(4438);let c=(()=>{var s;class m{onInput(e){this.resize()}constructor(e){this.element=e}ngOnInit(){setTimeout(()=>this.resize(),0),this.interval=setInterval(()=>this.resize(),2e3)}ngOnDestroy(){clearInterval(this.interval)}resize(){let e=this.element.nativeElement.getElementsByClassName("text-input")[0],S=0;e&&(S=e.scrollHeight,e.style.height=S+"px"),this.element.nativeElement.style.height=S+16+"px"}}return(s=m).\u0275fac=function(e){return new(e||s)(l.rXU(l.aKT))},s.\u0275dir=l.FsC({type:s,selectors:[["ion-textarea","autosize",""]],hostBindings:function(e,S){1&e&&l.bIt("input",function(I){return S.onInput(I.target)})}}),m})()},2607:(j,k,d)=>{d.r(k),d.d(k,{AbsenceReportPageModule:()=>Bt});var l=d(177),c=d(4742),s=d(9417),m=d(9598),b=d(6090),e=d(4438),S=d(1204),A=d(230),I=d(5151),D=d(6969),v=d(9196),O=d(6186),p=d(467),G=d(8593),y=d(5383),P=d(7376),M=d(1916),h=d(9841),T=d(9813),g=d(7900),u=d(4078),E=d(9585),F=d(1038),L=d(2952),X=d(1106),$=d(60);function U(n,a){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.JRh(o.day.note)}}function z(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-textarea",8),e.nI1(1,"translate"),e.mxI("ngModelChange",function(i){e.eBV(o);const r=e.XpG(2);return e.DH7(r.note,i)||(r.note=i),e.Njj(i)}),e.k0s()}if(2&n){const o=e.XpG(2);e.FS9("placeholder",e.bMT(1,2,"WRITE_YOUR_MESSAGE_HERE")),e.R50("ngModel",o.note)}}function W(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",9),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.isEditing=!0)}),e.nrm(1,"fa-icon",10),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("icon",o.faEdit)}}function J(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",11),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickCancel())}),e.nrm(1,"fa-icon",10),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("icon",o.faRemove)}}function K(n,a){if(1&n&&e.nrm(0,"fa-icon",10),2&n){const o=e.XpG(3);e.Y8G("icon",o.faSave)}}function H(n,a){if(1&n&&e.nrm(0,"fa-icon",15),2&n){const o=e.XpG(3);e.Y8G("icon",o.faSpinner)("fixedWidth",!0)("pulse",!0)}}function q(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",12),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickSave())}),e.DNE(1,K,1,1,"fa-icon",13)(2,H,1,3,"fa-icon",14),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",!o.isSavingNote),e.R7$(),e.Y8G("ngIf",o.isSavingNote)}}function Q(n,a){if(1&n&&(e.j41(0,"ion-row")(1,"ion-col",2),e.DNE(2,U,2,1,"div",1)(3,z,2,4,"ion-textarea",3),e.k0s(),e.j41(4,"ion-col",4),e.DNE(5,W,2,1,"ion-button",5)(6,J,2,1,"ion-button",6)(7,q,3,2,"ion-button",7),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.Y8G("ngIf",!o.isEditing),e.R7$(),e.Y8G("ngIf",o.isEditing),e.R7$(2),e.Y8G("ngIf",!o.isEditing),e.R7$(),e.Y8G("ngIf",o.isEditing),e.R7$(),e.Y8G("ngIf",o.isEditing)}}function Z(n,a){if(1&n&&(e.j41(0,"ion-row")(1,"ion-col"),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.SpI(" ",o.day.schoolNote," ")}}let ee=(()=>{var n;class a extends M.${constructor(t,i,r,_){super(t,i,r),this.preschoolAttendanceService=_,this.isEditing=!1,this.isSavingNote=!1,this.faEdit=y.MT7,this.faRemove=y.iuH,this.faSpinner=y.z1G,this.faSave=y.hSh}ngOnInit(){this.absence=this.day.absence,this.note=this.day.note}onClickReport(){this.day.absence=!this.day.absence,this.save()}onClickCancel(){this.note=this.day.note,this.isEditing=!1}onClickSave(){var t=this;return(0,p.A)(function*(){t.isSavingNote=!0,t.day.note=t.note,yield t.save(),t.isEditing=!1,t.isSavingNote=!1})()}save(){var t=this;return(0,p.A)(function*(){console.log(t.day);try{yield t.preschoolAttendanceService.updateAttendance(t.day)}catch(r){let _=yield t.translate("ERROR_COULD_NOT_SAVE");t.userAlertService.alert(_)}let i=yield t.translate("SAVE_COMPLETE");t.userAlertService.info(i)})()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(c.Xi),e.rXU(A.c$),e.rXU(I.p),e.rXU(T.Q))},n.\u0275cmp=e.VBU({type:n,selectors:[["absence-report-form-leisure-item"]],inputs:{day:"day"},features:[e.Vt3],decls:3,vars:2,consts:[[2,"margin-left","5px"],[4,"ngIf"],["size","9"],["autocapitalize","on","autosize","",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],["size","3",1,"ion-text-end"],["size","small",3,"click",4,"ngIf"],["size","small","color","warning",3,"click",4,"ngIf"],["size","small","color","success",3,"click",4,"ngIf"],["autocapitalize","on","autosize","",3,"ngModelChange","ngModel","placeholder"],["size","small",3,"click"],[3,"icon"],["size","small","color","warning",3,"click"],["size","small","color","success",3,"click"],[3,"icon",4,"ngIf"],[3,"icon","fixedWidth","pulse",4,"ngIf"],[3,"icon","fixedWidth","pulse"]],template:function(t,i){1&t&&(e.j41(0,"div",0),e.DNE(1,Q,8,5,"ion-row",1)(2,Z,3,1,"ion-row",1),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngIf",!i.day.closed),e.R7$(),e.Y8G("ngIf",i.day.schoolNote))},dependencies:[c.Jm,c.hU,c.ln,c.nc,c.Gw,X.U,l.bT,s.BC,s.vS,$.aY,A.D9],styles:[".absence-report-form[_ngcontent-%COMP%]{border-top:1px solid lightgray}h4[_ngcontent-%COMP%]{text-transform:uppercase;margin-top:.1em;margin-bottom:.1em}.check-in[_ngcontent-%COMP%], .check-out[_ngcontent-%COMP%]{white-space:nowrap}.check-in[_ngcontent-%COMP%]{padding-right:16px!important}.time-changed[_ngcontent-%COMP%]{font-size:.9em;text-decoration:line-through;opacity:.75}"]}),a})();var N=d(7143);function te(n,a){1&n&&e.nrm(0,"q-spinner",2)}function ne(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-list",7)(1,"ion-list-header",8),e.nrm(2,"ion-label"),e.j41(3,"ion-button",9),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickSelectAll())}),e.EFF(4),e.nI1(5,"translate"),e.k0s()()()}2&n&&(e.R7$(4),e.JRh(e.bMT(5,1,"SELECT_ALL_DAYS")))}function ie(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-item",15),e.bIt("click",function(){const i=e.eBV(o).$implicit,r=e.XpG(3);return e.Njj(r.onClickAttendance(i))}),e.j41(1,"ion-label")(2,"p",16),e.EFF(3),e.nI1(4,"qTime"),e.nI1(5,"qTime"),e.k0s(),e.j41(6,"p",17),e.EFF(7),e.k0s()(),e.j41(8,"ion-badge",18),e.EFF(9),e.k0s()()}if(2&n){const o=a.$implicit,t=e.XpG(3);e.AVh("disabled",o.disabled),e.R7$(3),e.Lme("",e.bMT(4,7,o.attendance.lessonTime)," - ",e.bMT(5,9,o.attendance.lessonEnd),""),e.R7$(4),e.JRh(o.attendance.lesson),e.R7$(),e.Y8G("color",t.getAttendanceColor(o)),e.R7$(),e.SpI(" ",t.getAttendanceType(o)," ")}}function oe(n,a){1&n&&(e.j41(0,"ion-badge",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"REPORTED_ABSENCE"),""))}function se(n,a){1&n&&(e.j41(0,"ion-badge",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"REPORT"),""))}function ae(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-item",19)(1,"ion-label")(2,"p",16),e.EFF(3),e.nI1(4,"qTime"),e.nI1(5,"qTime"),e.k0s(),e.j41(6,"p",17),e.EFF(7),e.nI1(8,"translate"),e.k0s()(),e.j41(9,"div",20),e.bIt("click",function(){e.eBV(o);const i=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.onClickAttendance(i.leisure))}),e.DNE(10,oe,3,3,"ion-badge",21)(11,se,3,3,"ion-badge",22),e.k0s()()}if(2&n){const o=e.XpG().$implicit,t=e.XpG(2);e.AVh("disabled",o.leisure.disabled),e.R7$(3),e.Lme("",e.bMT(4,7,o.leisure.attendance.plannedStart)," - ",e.bMT(5,9,o.leisure.attendance.plannedEnd),""),e.R7$(4),e.JRh(e.bMT(8,11,"LEISURE")),e.R7$(3),e.Y8G("ngIf",t.isAbsence(o.leisure)),e.R7$(),e.Y8G("ngIf",!t.isAbsence(o.leisure))}}function re(n,a){if(1&n&&(e.j41(0,"div"),e.nrm(1,"absence-report-form-leisure-item",25),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(),e.Y8G("day",o.leisure.attendance)}}function ce(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-list",10)(1,"ion-list-header")(2,"ion-label"),e.EFF(3),e.k0s(),e.j41(4,"ion-button",9),e.bIt("click",function(){const i=e.eBV(o).$implicit,r=e.XpG(2);return e.Njj(r.onClickSelectAllDay(i))}),e.EFF(5),e.nI1(6,"translate"),e.k0s()(),e.DNE(7,ie,10,11,"ion-item",11)(8,ae,12,13,"ion-item",12),e.j41(9,"ion-grid",13)(10,"ion-row")(11,"ion-col"),e.DNE(12,re,2,1,"div",1),e.k0s()()(),e.nrm(13,"hr",14),e.k0s()}if(2&n){const o=a.$implicit,t=e.XpG(2);e.R7$(3),e.JRh(o.heading),e.R7$(2),e.JRh(e.bMT(6,5,"SELECT_ALL_DAY")),e.R7$(2),e.Y8G("ngForOf",o.attendances),e.R7$(),e.Y8G("ngIf",t.isLeisureChild&&o.leisure),e.R7$(4),e.Y8G("ngIf",t.isLeisureChild&&o.leisure)}}function le(n,a){1&n&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.JRh(e.bMT(2,1,"NO_LESSONS")))}function de(n,a){if(1&n){const o=e.RV6();e.j41(0,"div",27),e.nrm(1,"ion-icon",28),e.j41(2,"div"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"ion-button",29),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.dismiss())}),e.EFF(6),e.nI1(7,"translate"),e.k0s()()}2&n&&(e.R7$(3),e.JRh(e.bMT(4,2,"SAVE_COMPLETE")),e.R7$(3),e.JRh(e.bMT(7,4,"BACK")))}function _e(n,a){if(1&n&&(e.qex(0),e.DNE(1,ne,6,3,"ion-list",3)(2,ce,14,7,"ion-list",4)(3,le,3,3,"div",5)(4,de,8,6,"div",6),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",(null==o.attendanceLists?null:o.attendanceLists.length)>1),e.R7$(),e.Y8G("ngForOf",o.attendanceLists),e.R7$(),e.Y8G("ngIf",0==o.attendanceLists.length),e.R7$(),e.Y8G("ngIf",o.isComplete)}}let V=(()=>{var n;class a extends M.${constructor(t,i,r,_,f,C,R,x,B){super(t,i,r),this.attendanceService=_,this.preschoolAttendanceService=f,this.attendanceTypes=C,this.dateService=R,this.schoolOptionsService=x,this.modalCtrl=B,this.confirmButtonEnabled=!1,this.confirmButtonEnabledChanged=new e.bkB(!1),this.isSavingChanged=new e.bkB(!1),this.attendanceLists=[],this.attendances=[],this.preschoolAttendances=[],this.isLoadingAttendance=!1,this.isLoadingAttendanceTypes=!1,this.isLoadingOptions=!1,this.isSaving=!1,this.isComplete=!1,this.faSpinner=y.z1G}ngOnInit(){this.initializeView()}get isBusy(){return this.isLoadingAttendanceTypes||this.isLoadingOptions||this.isLoadingAttendance}get isEmpty(){return 0==this.attendanceLists.length}get isLeisureChild(){return this.student&&this.student.leisureChild&&this.calendarFrames&&this.calendarFrames.some(t=>t.hoursPerWeek>0)}setConfirmButtonEnabled(){const t=this.attendanceLists.some(i=>i.attendances&&i.attendances.some(r=>r.changed)||i.leisure&&i.leisure.changed);this.confirmButtonEnabledChanged.emit(t),this.confirmButtonEnabled=t}isAbsence(t){return t.changed?!t.attendance.absence:t.attendance.absence}onClickAttendance(t){t.disabled||(t.changed=!t.changed,this.setConfirmButtonEnabled())}onClickSelectAll(){this.isAllSelected()?this.attendanceLists.forEach(t=>this.deselectList(t)):this.attendanceLists.forEach(t=>this.selectList(t))}onClickSelectAllDay(t){this.selectAllDay(t)}onClickConfirm(){var t=this;return(0,p.A)(function*(){let i=yield t.translate("ATTENDANCE_SAVING_ABSENCE_REPORT");t.withSpinner(()=>t.saveChanges(),i)})()}headline(t){let i=this.dateService.date(t);return this.dateService.formatWeekDayShort(i)+" "+this.dateService.formatDateShort(i)}getAttendanceColor(t){return this.attendanceTypes.getColor(t.changed?"ValidAbsence"==t.attendance.attendanceCategory?this.notReportedType.attendanceCategory:this.validAbsenceType.attendanceCategory:t.attendance.attendanceCategory)}getAttendanceType(t){return t.changed?"ValidAbsence"==t.attendance.attendanceCategory?this.notReportedType.name:this.validAbsenceType.name:t.attendance.attendanceType}initializeView(){var t=this;return(0,p.A)(function*(){yield Promise.all([t.initializeAttendanceTypes(t.student.schoolId),t.loadOptions(t.student.schoolId),t.loadCalendarFrame()]),yield t.loadAttendance(),t.notReportedType=t.attendanceTypes.notReportedType,t.validAbsenceType=t.attendanceTypes.validAbsenceType})()}isAllSelected(){return this.attendanceLists.every(t=>this.isAllInListSelected(t))}isAllInListSelected(t){return(!t.attendances||t.attendances.every(i=>i.changed||i.disabled))&&(!t.leisure||t.leisure.changed||t.leisure.disabled)}isEnabled(t){if("NotReported"!=t.attendanceCategory)return!1;let i=this.options&&!this.options.allowAbsenceReportOnlyForFutureLessons,r=`${this.dateService.formatDateIso8601(t.lessonDate)} ${t.lessonTime}`;return this.dateService.isAfterNow(r)||i&&this.dateService.isToday(r)}isLeisureEnabled(t){let i=this.options&&!this.options.allowAbsenceReportOnlyForFutureLessons,r=`${this.dateService.formatDateIso8601(t.date)} ${t.plannedStart}`;return this.dateService.isAfterNow(r)||i&&this.dateService.isToday(r)}selectAllDay(t){this.isAllInListSelected(t)?this.deselectList(t):this.selectList(t)}selectList(t){t.attendances&&t.attendances.forEach(i=>{!i.changed&&!i.disabled&&(i.changed=!0)}),t.leisure&&!t.leisure.changed&&!t.leisure.disabled&&(t.leisure.changed=!0),this.setConfirmButtonEnabled()}deselectList(t){t.attendances&&t.attendances.forEach(i=>{i.changed&&!i.disabled&&(i.changed=!1)}),t.leisure&&t.leisure.changed&&!t.leisure.disabled&&(t.leisure.changed=!1)}initStartAndEndDates(t){this.startDate=this.dateService.today(),this.endDate=this.calculateEndDate(this.startDate,t)}calculateEndDate(t,i){let r=new Date(Date.now());return i.setAttendanceOnLogin||this.dateService.isFriday(r)?new Date(t):this.dateService.addDays(t,2)}loadCalendarFrame(){var t=this;return(0,p.A)(function*(){t.calendarFrames=yield t.preschoolAttendanceService.getCalendarFrames(t.student.studentId)})()}loadAttendance(){var t=this;return(0,p.A)(function*(){if(t.isLoadingAttendance=!0,!t.student.studentId||t.isInvalidDate(t.startDate)||t.isInvalidDate(t.endDate))return t.attendances=[],void(t.isLoadingAttendance=!1);t.attendances=yield t.attendanceService.getAttendance(t.student.studentId,new Date(t.startDate),t.endDate),t.isLeisureChild&&(t.preschoolAttendances=yield t.preschoolAttendanceService.getChildAttendances(t.student.studentId,t.startDate,t.endDate)),t.attendanceLists=t.createReportLists(t.attendances,t.preschoolAttendances),t.isLoadingAttendance=!1})()}createReportLists(t,i){let r=P.groupBy(t,C=>this.dateService.formatDateIso8601(C.lessonDate)),_=P.uniq(P.keys(r).concat(i.map(C=>this.dateService.formatDateIso8601(C.date)))),f=[];return _.forEach(C=>{f.push({date:C,heading:this.dateService.formatDayAndDate(this.dateService.date(C)),attendances:this.buildAttendanceViewModels(P.sortBy(r[C],"lessonTime")),leisure:this.buildPreschoolAttendanceViewModel(i.find(R=>this.dateService.isSameDay(R.date,C)))})}),P.sortBy(f,"date")}buildAttendanceViewModels(t){return t?t.map(i=>this.buildAttendanceViewModel(i)):[]}buildAttendanceViewModel(t){return{attendance:t,disabled:!this.isEnabled(t),changed:!1}}buildPreschoolAttendanceViewModel(t){return t?{attendance:t,disabled:!this.isLeisureEnabled(t),changed:!1}:null}initializeAttendanceTypes(t){var i=this;return(0,p.A)(function*(){i.isLoadingAttendanceTypes=!0,yield i.attendanceTypes.init({schoolId:t}),i.isLoadingAttendanceTypes=!1})()}loadOptions(t){var i=this;return(0,p.A)(function*(){i.isLoadingOptions=!0,i.options=yield i.schoolOptionsService.loadSchoolOptions(t),i.initStartAndEndDates(i.options),i.isLoadingOptions=!1})()}saveChanges(){var t=this;return(0,p.A)(function*(){t.isSaving=!0,t.isSavingChanged.emit(!0);try{let r=t.attendanceLists.filter(R=>R.attendances).map(R=>R.attendances).flat().filter(R=>R.changed).map(R=>R.attendance),_=t.applyAttendanceChanges(r);yield t.attendanceService.updateAttendances(_);let f=t.attendanceLists.map(R=>R.leisure).filter(R=>R&&R.changed).map(R=>R.attendance);t.applyPreschoolAttendanceChanges(f).forEach(function(){var R=(0,p.A)(function*(x){return yield t.preschoolAttendanceService.updateAttendance(x)});return function(x){return R.apply(this,arguments)}}())}catch(r){let _=yield t.translate("SAVE_FAILED");t.userAlertService.error(_)}finally{t.isSaving=!1,t.isSavingChanged.emit(!1)}t.updateViewModelAfterSaveComplete();let i=yield t.translate("SAVE_COMPLETE");t.userAlertService.info(i)})()}applyAttendanceChanges(t){let i=[];return t.forEach(r=>{let _=Object.assign({},r);this.updateAttendanceType(_),i.push(_)}),i}updateViewModelAfterSaveComplete(){this.attendanceLists.forEach(t=>{t.attendances.forEach(i=>{i.changed&&(this.updateAttendanceType(i.attendance),i.changed=!1,i.disabled=!0)}),t.leisure&&(t.leisure.changed=!1)}),this.setConfirmButtonEnabled()}applyPreschoolAttendanceChanges(t){let i=[...t];return i.forEach(r=>r.absence=!r.absence),i}isInvalidDate(t){return null==t||isNaN(t.getTime())}updateAttendanceType(t){let i="ValidAbsence"==t.attendanceCategory?this.notReportedType:this.validAbsenceType;t.attendanceTypeId=i.attendanceTypeId,t.attendanceType=i.name,t.attendanceCategory=i.attendanceCategory,("GrantedAbsence"==t.attendanceCategory||"ValidAbsence"==t.attendanceCategory)&&t.minutesAbsent<=0&&(t.minutesAbsent=t.minutesTotal)}dismiss(){this.modalCtrl.dismiss()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(c.Xi),e.rXU(A.c$),e.rXU(I.p),e.rXU(h.$),e.rXU(T.Q),e.rXU(g.a),e.rXU(u.k),e.rXU(E.Y),e.rXU(c.W3))},n.\u0275cmp=e.VBU({type:n,selectors:[["absence-report-form-restricted"]],inputs:{student:"student"},outputs:{confirmButtonEnabledChanged:"confirmButtonEnabledChanged",isSavingChanged:"isSavingChanged"},features:[e.Vt3],decls:2,vars:2,consts:[["class","ion-margin-top",4,"ngIf"],[4,"ngIf"],[1,"ion-margin-top"],["class","ion-no-margin","lines","none",4,"ngIf"],["class","attendance-list",4,"ngFor","ngForOf"],["class","ion-padding ion-text-center",4,"ngIf"],["class","absence-report-complete",4,"ngIf"],["lines","none",1,"ion-no-margin"],[1,"ion-padding-vertical"],["size","small",3,"click"],[1,"attendance-list"],["detail","false",3,"disabled","click",4,"ngFor","ngForOf"],["lines","none",3,"disabled",4,"ngIf"],[1,"absencegrid"],[1,"line-after-grid"],["detail","false",3,"click"],[1,"time"],[1,"lesson"],["qLabel","","slot","end",1,"attendance-type-label",3,"color"],["lines","none"],[3,"click"],["qLabel","","slot","end","class","attendance-type-label","color","warning",4,"ngIf"],["qLabel","","slot","end","class","attendance-type-label","color","empty",4,"ngIf"],["qLabel","","slot","end","color","warning",1,"attendance-type-label"],["qLabel","","slot","end","color","empty",1,"attendance-type-label"],[3,"day"],[1,"ion-padding","ion-text-center"],[1,"absence-report-complete"],["name","checkmark","color","success"],["size","large","fill","clear",1,"ion-margin-top",3,"click"]],template:function(t,i){1&t&&e.DNE(0,te,1,0,"q-spinner",0)(1,_e,5,4,"ng-container",1),2&t&&(e.Y8G("ngIf",i.isBusy),e.R7$(),e.Y8G("ngIf",!i.isBusy))},dependencies:[c.In,c.Jm,c.hU,c.lO,c.iq,c.uz,c.he,c.nf,c.AF,c.ln,F.C,l.Sq,l.bT,L.t,ee,N.k,A.D9],styles:["ion-grid.grid[_ngcontent-%COMP%]{padding-left:0}ion-col.col[_ngcontent-%COMP%]{padding-left:0}.absence-report-complete[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:7em}.absence-report-complete[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:2em}.attendance-list[_ngcontent-%COMP%]   ion-item.disabled[_ngcontent-%COMP%]{background-color:var(--disabled)}.attendance-list[_ngcontent-%COMP%]   ion-icon.empty[_ngcontent-%COMP%]{color:#d3d3d3}.attendance-list[_ngcontent-%COMP%]   p.time[_ngcontent-%COMP%]{color:#000;font-size:.7em}.attendance-list[_ngcontent-%COMP%]   .attendance-type-label[_ngcontent-%COMP%]{margin:0}.line-after-grid[_ngcontent-%COMP%]{border:0;height:1px;background-color:rgba(161,161,161,.494);margin-left:15px;margin-top:-10px}.absencegrid[_ngcontent-%COMP%]{margin-top:-10px}"]}),a})();var pe=d(2934);function ue(n,a){1&n&&e.nrm(0,"q-spinner",4)}function me(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-datetime",20,0),e.bIt("ionChange",function(){e.eBV(o);const i=e.sdS(1),r=e.XpG(3);return e.Njj(r.onClickStartDate(i.value))})("ionCancel",function(){e.eBV(o);const i=e.XpG(3);return e.Njj(i.showStartDatePicker=!1)}),e.j41(2,"span",21),e.EFF(3,"V\xe4lj fr\xe5n datum"),e.k0s()()}if(2&n){const o=e.XpG(3);e.Y8G("value",o.startDate)("showDefaultTitle",!0)("firstDayOfWeek",1)}}function he(n,a){if(1&n&&(e.j41(0,"ion-content"),e.DNE(1,me,4,3,"ion-datetime",19),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.showStartDatePicker)}}function fe(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-datetime",20,1),e.bIt("ionChange",function(){e.eBV(o);const i=e.sdS(1),r=e.XpG(3);return e.Njj(r.onClickEndDate(i.value))})("ionCancel",function(){e.eBV(o);const i=e.XpG(3);return e.Njj(i.showEndDatePicker=!1)}),e.j41(2,"span",21),e.EFF(3,"V\xe4lj till datum"),e.k0s()()}if(2&n){const o=e.XpG(3);e.Y8G("value",o.endDate)("showDefaultTitle",!0)("firstDayOfWeek",1)}}function ge(n,a){if(1&n&&(e.j41(0,"ion-content"),e.DNE(1,fe,4,3,"ion-datetime",19),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.showEndDatePicker)}}function be(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-list",15)(1,"ion-list-header",16),e.nrm(2,"ion-label"),e.j41(3,"ion-button",22),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickSelectAll())}),e.EFF(4),e.nI1(5,"translate"),e.k0s()()()}2&n&&(e.R7$(4),e.SpI(" ",e.bMT(5,1,"SELECT_ALL_DAYS")," "))}function Re(n,a){1&n&&e.nrm(0,"ion-icon",32)}function Ae(n,a){1&n&&e.nrm(0,"ion-icon",33)}function Ce(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-item",26),e.bIt("click",function(){const i=e.eBV(o).$implicit,r=e.XpG(3);return e.Njj(r.onClickAttendance(i))}),e.DNE(1,Re,1,0,"ion-icon",27)(2,Ae,1,0,"ion-icon",28),e.j41(3,"ion-label")(4,"p",29),e.EFF(5),e.k0s(),e.j41(6,"p",30),e.EFF(7),e.k0s()(),e.j41(8,"ion-badge",31),e.EFF(9),e.k0s()()}if(2&n){const o=a.$implicit,t=e.XpG(3);e.AVh("disabled",!t.isEnabled(o)),e.R7$(),e.Y8G("ngIf",!t.isSelected(o)),e.R7$(),e.Y8G("ngIf",t.isSelected(o)),e.R7$(3),e.Lme("",o.lessonTime," - ",o.lessonEnd,""),e.R7$(2),e.JRh(o.lesson),e.R7$(),e.Y8G("color",t.getAttendanceColor(o)),e.R7$(),e.SpI(" ",o.attendanceType," ")}}function Ie(n,a){1&n&&e.nrm(0,"ion-icon",32)}function Ee(n,a){1&n&&e.nrm(0,"ion-icon",33)}function Se(n,a){1&n&&(e.j41(0,"ion-badge",36),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"REPORTED_ABSENCE"),""))}function Te(n,a){1&n&&(e.j41(0,"ion-badge",37),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"REPORT")," "))}function ve(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-item",22),e.bIt("click",function(){e.eBV(o);const i=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.onClickLeisureAttendance(i.leisure))}),e.DNE(1,Ie,1,0,"ion-icon",27)(2,Ee,1,0,"ion-icon",28),e.j41(3,"ion-label")(4,"p",29),e.EFF(5),e.nI1(6,"qTime"),e.nI1(7,"qTime"),e.k0s(),e.j41(8,"p",30),e.EFF(9),e.nI1(10,"translate"),e.k0s()(),e.DNE(11,Se,3,3,"ion-badge",34)(12,Te,3,3,"ion-badge",35),e.k0s()}if(2&n){const o=e.XpG().$implicit,t=e.XpG(2);e.AVh("disabled",!t.isLeisureEnabled(o.leisure)),e.R7$(),e.Y8G("ngIf",!t.isLeisureSelected(o.leisure)),e.R7$(),e.Y8G("ngIf",t.isLeisureSelected(o.leisure)),e.R7$(3),e.Lme(" ",e.bMT(6,9,o.leisure.plannedStart)," - ",e.bMT(7,11,o.leisure.plannedEnd)," "),e.R7$(4),e.JRh(e.bMT(10,13,"LEISURE")),e.R7$(2),e.Y8G("ngIf",o.leisure.absence),e.R7$(),e.Y8G("ngIf",!o.leisure.absence)}}function ye(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-list",23)(1,"ion-list-header")(2,"ion-label"),e.EFF(3),e.k0s(),e.j41(4,"ion-button",22),e.bIt("click",function(){const i=e.eBV(o).$implicit,r=e.XpG(2);return e.Njj(r.onClickSelectAllDay(i))}),e.EFF(5),e.nI1(6,"translate"),e.k0s()(),e.DNE(7,Ce,10,9,"ion-item",24)(8,ve,13,15,"ion-item",25),e.k0s()}if(2&n){const o=a.$implicit,t=e.XpG(2);e.R7$(3),e.JRh(o.heading),e.R7$(2),e.SpI(" ",e.bMT(6,4,"SELECT_ALL_DAY")," "),e.R7$(2),e.Y8G("ngForOf",o.attendances),e.R7$(),e.Y8G("ngIf",t.isLeisureChild&&o.leisure)}}function Fe(n,a){1&n&&(e.j41(0,"div",38),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"NO_LESSONS")," "))}function ke(n,a){if(1&n){const o=e.RV6();e.j41(0,"div",39),e.nrm(1,"ion-icon",40),e.j41(2,"div"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"ion-button",41),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.dismiss())}),e.EFF(6),e.nI1(7,"translate"),e.k0s()()}2&n&&(e.R7$(3),e.JRh(e.bMT(4,2,"SAVE_COMPLETE")),e.R7$(3),e.JRh(e.bMT(7,4,"BACK")))}function Pe(n,a){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"ion-grid")(2,"ion-row")(3,"ion-col",5)(4,"ion-item",6),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return i.showStartDatePicker=!i.showStartDatePicker,e.Njj(i.showEndDatePicker=!1)}),e.j41(5,"ion-label",7),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.nrm(8,"ion-input",8),e.nI1(9,"date"),e.k0s()(),e.j41(10,"ion-col",5)(11,"ion-item",9),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return i.showEndDatePicker=!i.showEndDatePicker,e.Njj(i.showStartDatePicker=!1)}),e.j41(12,"ion-label",7),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.nrm(15,"ion-input",8),e.nI1(16,"date"),e.k0s()()()(),e.j41(17,"ion-modal",10),e.DNE(18,he,2,1,"ng-template"),e.k0s(),e.j41(19,"ion-modal",11),e.DNE(20,ge,2,1,"ng-template"),e.k0s(),e.DNE(21,be,6,3,"ion-list",12)(22,ye,9,6,"ion-list",13)(23,Fe,3,3,"div",14),e.j41(24,"ion-list",15)(25,"ion-list-header",16),e.nrm(26,"ion-label"),e.j41(27,"ion-button",17),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.onClickReportMultiple())}),e.EFF(28),e.nI1(29,"translate"),e.k0s()()(),e.DNE(30,ke,8,6,"div",18),e.bVm()}if(2&n){const o=e.XpG();e.R7$(4),e.Y8G("color",o.showStartDatePicker?"quiculum":""),e.R7$(2),e.JRh(e.bMT(7,12,"FROM")),e.R7$(2),e.FS9("value",e.bMT(9,14,o.startDate)),e.R7$(3),e.Y8G("color",o.showEndDatePicker?"quiculum":""),e.R7$(2),e.JRh(e.bMT(14,16,"TO")),e.R7$(2),e.FS9("value",e.bMT(16,18,o.endDate)),e.R7$(6),e.Y8G("ngIf",(null==o.attendanceLists?null:o.attendanceLists.length)>1),e.R7$(),e.Y8G("ngForOf",o.attendanceLists),e.R7$(),e.Y8G("ngIf",0==o.attendanceLists.length),e.R7$(4),e.Y8G("disabled",!o.reportMultipleButtonEnabled),e.R7$(),e.SpI(" ",e.bMT(29,20,"SELECT_ABSENCE_TYPE")," "),e.R7$(2),e.Y8G("ngIf",o.isComplete)}}let Y=(()=>{var n;class a{constructor(t,i,r,_,f,C,R,x){this.attendanceService=t,this.preschoolAttendanceService=i,this.attendanceTypes=r,this.dateService=_,this.modalCtrl=f,this.schoolOptionsService=C,this.userAlertService=R,this.zone=x,this.confirmButtonEnabled=!1,this.confirmButtonEnabledChanged=new e.bkB(!1),this.isSavingChanged=new e.bkB(!1),this.startDate=(new Date).toISOString().split("T")[0],this.endDate=(new Date).toISOString().split("T")[0],this.showStartDatePicker=!1,this.showEndDatePicker=!1,this.attendanceLists=[],this.selectedAttendances=[],this.changedAttendances=[],this.selectedPreschoolAttendances=[],this.changedPreschoolAttendances=[],this.attendances=[],this.preschoolAttendances=[],this.isLoadingAttendance=!1,this.isLoadingAttendanceTypes=!1,this.isLoadingOptions=!1,this.isSaving=!1,this.isComplete=!1,this.faSpinner=y.z1G}ngOnInit(){this.initializeView()}get isBusy(){return this.isLoadingAttendanceTypes||this.isLoadingOptions||this.isLoadingAttendance}get isEmpty(){return 0==this.attendanceLists.length}get isLeisureChild(){return this.student&&this.student.leisureChild&&this.calendarFrames&&this.calendarFrames.some(t=>t.hoursPerWeek>0)}setConfirmButtonEnabled(){this.confirmButtonEnabledChanged.emit(this.changedAttendances&&!!this.changedAttendances.length)}get reportMultipleButtonEnabled(){return this.selectedAttendances.length>0}isEnabled(t){let i=this.options&&!this.options.allowAbsenceReportOnlyForFutureLessons,r=`${this.dateService.formatDateIso8601(t.lessonDate)} ${t.lessonTime}`;return this.dateService.isAfterNow(r)||i&&this.dateService.isToday(r)}isLeisureEnabled(t){let i=this.options&&!this.options.allowAbsenceReportOnlyForFutureLessons,r=`${this.dateService.formatDateIso8601(t.date)} ${t.plannedStart}`;return this.dateService.isAfterNow(r)||i&&this.dateService.isToday(r)}isSelected(t){return this.selectedAttendances.indexOf(t)>-1}isLeisureSelected(t){return this.selectedPreschoolAttendances.indexOf(t)>-1}onClickReportMultiple(){this.pickAttendanceType()}onClickAttendance(t){this.isEnabled(t)&&this.toggleSelection(t)}onClickLeisureAttendance(t){this.isLeisureEnabled(t)&&(this.isLeisureSelected(t)?(this.deselectLeisure(t),this.restoreLeisureAttendance(t)):(this.updateLeisureAttendance(t,!t.absence),this.selectLeisure(t)))}onClickSelectAll(){this.isAllSelected()?this.attendanceLists.forEach(t=>this.deselectList(t)):this.attendanceLists.forEach(t=>this.selectList(t))}onClickSelectAllDay(t){this.selectAllDay(t)}onClickStartDate(t){this.startDate=t;let i=this.dateService.formatDateIso8601(new Date);this.dateService.isBefore(this.startDate,i)&&(this.startDate=i),this.dateService.isBefore(this.endDate,this.startDate)&&(this.endDate=this.dateService.formatDateIso8601(this.startDate)),this.loadAttendance()}onClickEndDate(t){this.endDate=t,this.dateService.isBefore(this.endDate,this.startDate)&&(this.endDate=this.dateService.formatDateIso8601(this.startDate)),this.loadAttendance()}onClickConfirm(){this.saveChanges()}headline(t){let i=this.dateService.date(t);return this.dateService.formatWeekDayShort(i)+" "+this.dateService.formatDateShort(i)}addToChangedAttendances(t){if(this.isChanged(t)){const i=this.changedAttendances.findIndex(r=>r.eventId==t.eventId&&r.studentId==t.studentId);i>=0&&this.changedAttendances.splice(i,1),this.changedAttendances.push(Object.assign({},t)),this.setConfirmButtonEnabled()}}addToChangedPreschoolAttendances(t){this.isLeisureChanged(t)||this.changedPreschoolAttendances.push(Object.assign({},t))}initializeView(){var t=this;return(0,p.A)(function*(){yield Promise.all([t.initializeAttendanceTypes(t.student.schoolId),t.loadOptions(t.student.schoolId),t.loadCalendarFrame()]),yield t.loadAttendance(),t.notReportedType=t.attendanceTypes.notReportedType,t.validAbsenceType=t.attendanceTypes.validAbsenceType})()}isChanged(t){return this.changedAttendances.findIndex(i=>JSON.stringify(t)&&JSON.stringify(i))>-1||!this.changedAttendances.length}isLeisureChanged(t){return this.changedPreschoolAttendances.findIndex(i=>i.id==t.id)>-1}isAllSelected(){return this.attendanceLists.every(t=>this.isAllInListSelected(t))}isAllInListSelected(t){return(!t.attendances||t.attendances.every(i=>this.isSelected(i)||!this.isEnabled(i)))&&(!t.leisure||this.isLeisureSelected(t.leisure)||!this.isLeisureEnabled(t.leisure))}deselect(t){let i=this.selectedAttendances.indexOf(t);i>-1&&this.selectedAttendances.splice(i,1)}deselectLeisure(t){let i=this.selectedPreschoolAttendances.indexOf(t);i>-1&&this.selectedPreschoolAttendances.splice(i,1)}pickAttendanceType(){var t=this;return(0,p.A)(function*(){let i=P(t.selectedAttendances).map("lessonDate").max();const r=t.selectedAttendances.length?t.selectedAttendances[0]:void 0;let _=yield t.modalCtrl.create({component:pe.t,componentProps:{attendanceDate:i,attendance:r,minutesAbsent:r&&r.minutesAbsent}});_.present(),t.zone.run(()=>_.onDidDismiss().then(f=>{if(f&&f.data&&f.data.type){const{type:C,minutes:R}=f.data;t.selectedAttendances.forEach(x=>t.updateAttendanceType(x,C,R))}}))})()}select(t){this.isSelected(t)||this.selectedAttendances.push(t)}selectLeisure(t){this.isLeisureSelected(t)||this.selectedPreschoolAttendances.push(t)}selectAllDay(t){this.isAllInListSelected(t)?this.deselectList(t):this.selectList(t)}selectList(t){t.attendances&&t.attendances.forEach(i=>{!this.isSelected(i)&&this.isEnabled(i)&&this.select(i)})}deselectList(t){t.attendances&&t.attendances.forEach(i=>{this.isSelected(i)&&(this.deselect(i),this.restoreAttendanceType(i))}),t.leisure&&this.isLeisureSelected(t.leisure)&&(this.deselectLeisure(t.leisure),this.restoreLeisureAttendance(t.leisure))}toggleSelection(t){this.isSelected(t)?this.deselect(t):this.select(t)}updateAttendanceType(t,{attendanceTypeId:i,name:r,attendanceCategory:_},f){this.isComplete=!1,t.attendanceTypeId=i,t.attendanceType=r,t.attendanceCategory=_,("Late"==_||"ValidAbsence"==_)&&(t.minutesAbsent=f),("GrantedAbsence"==_||"ValidAbsence"==_)&&t.minutesAbsent<=0&&(t.minutesAbsent=t.minutesTotal),this.addToChangedAttendances(t)}updateLeisureAttendance(t,i){t.absence!=i&&(this.isComplete=!1,this.changedPreschoolAttendances.find(_=>_.id==t.id)||this.addToChangedPreschoolAttendances(t),t.absence=i)}restoreAttendanceType(t){let i=this.changedAttendances.findIndex(r=>r.eventId==t.eventId&&r.studentId==t.studentId);if(i>-1){this.isComplete=!1;let r=this.changedAttendances[i];t.attendanceTypeId=r.attendanceTypeId,t.attendanceType=r.attendanceType,t.attendanceCategory=r.attendanceCategory,this.changedAttendances.splice(i,1),this.setConfirmButtonEnabled()}}restoreLeisureAttendance(t){let i=this.changedPreschoolAttendances.findIndex(r=>r.id==t.id);i>-1&&(this.isComplete=!1,t.absence=this.changedPreschoolAttendances[i].absence,this.changedAttendances.splice(i,1),this.setConfirmButtonEnabled())}loadCalendarFrame(){var t=this;return(0,p.A)(function*(){t.calendarFrames=yield t.preschoolAttendanceService.getCalendarFrames(t.student.studentId)})()}loadAttendance(){var t=this;return(0,p.A)(function*(){if(t.isLoadingAttendance=!0,t.showEndDatePicker=!1,t.showStartDatePicker=!1,t.selectedAttendances=[],!t.student.studentId||t.isInvalidDate(t.startDate)||t.isInvalidDate(t.endDate))return t.attendances=[],void(t.isLoadingAttendance=!1);t.attendances=yield t.attendanceService.getAttendance(t.student.studentId,t.startDate,t.endDate),t.isLeisureChild&&(t.preschoolAttendances=yield t.preschoolAttendanceService.getChildAttendances(t.student.studentId,t.startDate,t.endDate)),t.attendanceLists=t.createReportLists(t.attendances,t.preschoolAttendances),t.isLoadingAttendance=!1})()}createReportLists(t,i){let r=P.groupBy(t,C=>this.dateService.formatDateIso8601(C.lessonDate)),_=P.uniq(P.keys(r).concat(i.map(C=>this.dateService.formatDateIso8601(C.date)))),f=[];return _.forEach(C=>{f.push({date:C,heading:this.dateService.formatDayAndDate(this.dateService.date(C)),attendances:P.sortBy(r[C],"lessonTime")||[],leisure:i.find(R=>this.dateService.isSameDay(R.date,C))})}),P.sortBy(f,"date")}initializeAttendanceTypes(t){var i=this;return(0,p.A)(function*(){i.isLoadingAttendanceTypes=!0,yield i.attendanceTypes.init({schoolId:t}),i.isLoadingAttendanceTypes=!1})()}loadOptions(t){var i=this;return(0,p.A)(function*(){i.isLoadingOptions=!0,i.options=yield i.schoolOptionsService.loadSchoolOptions(t),i.isLoadingOptions=!1})()}saveChanges(){var t=this;return(0,p.A)(function*(){t.isSaving=!0;try{let i=t.changedAttendances.map(_=>t.attendances.find(f=>f.eventId==_.eventId&&f.studentId==_.studentId));i.length>0&&(yield t.attendanceService.updateAttendances(i)),t.selectedAttendances=[],t.changedAttendances=[],t.changedPreschoolAttendances.map(_=>t.preschoolAttendances.find(f=>f.id==_.id)).forEach(function(){var _=(0,p.A)(function*(f){return yield t.preschoolAttendanceService.updateAttendance(f)});return function(f){return _.apply(this,arguments)}}()),t.selectedPreschoolAttendances=[],t.changedPreschoolAttendances=[],t.isComplete=!0}catch(i){t.userAlertService.error("Kunde inte spara")}finally{t.isSaving=!1,t.setConfirmButtonEnabled()}})()}getAttendanceColor(t){return this.attendanceTypes.getColor(t.attendanceCategory)}isInvalidDate(t){return null==t||isNaN(new Date(t).valueOf())}dismiss(){this.modalCtrl.dismiss()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(h.$),e.rXU(T.Q),e.rXU(g.a),e.rXU(u.k),e.rXU(c.W3),e.rXU(E.Y),e.rXU(I.p),e.rXU(e.SKi))},n.\u0275cmp=e.VBU({type:n,selectors:[["absence-report-form"]],inputs:{student:"student"},outputs:{confirmButtonEnabledChanged:"confirmButtonEnabledChanged",isSavingChanged:"isSavingChanged"},decls:2,vars:2,consts:[["startDatePicker",""],["endDatePicker",""],["class","ion-margin-top",4,"ngIf"],[4,"ngIf"],[1,"ion-margin-top"],["size","6"],["id","open-start-modal",3,"click","color"],["position","stacked"],["readonly","",3,"value"],["id","open-end-modal",3,"click","color"],["trigger","open-start-modal",1,"datePickerModal"],["trigger","open-end-modal",1,"datePickerModal"],["class","ion-no-margin","lines","none",4,"ngIf"],["class","attendance-list",4,"ngFor","ngForOf"],["class","ion-padding ion-text-center",4,"ngIf"],["lines","none",1,"ion-no-margin"],[1,"ion-padding-vertical"],["size","small",3,"click","disabled"],["class","ion-padding ion-text-center absence-report-complete",4,"ngIf"],["presentation","date","locale","sv-SE","size","cover",3,"value","showDefaultTitle","firstDayOfWeek","ionChange","ionCancel",4,"ngIf"],["presentation","date","locale","sv-SE","size","cover",3,"ionChange","ionCancel","value","showDefaultTitle","firstDayOfWeek"],["slot","title"],[3,"click"],[1,"attendance-list"],["detail","false",3,"disabled","click",4,"ngFor","ngForOf"],[3,"disabled","click",4,"ngIf"],["detail","false",3,"click"],["slot","start","class","empty","name","square",4,"ngIf"],["slot","start","color","action","name","checkbox",4,"ngIf"],[1,"time"],[1,"lesson"],["qLabel","","slot","end",1,"attendance-type-label",3,"color"],["slot","start","name","square",1,"empty"],["slot","start","color","action","name","checkbox"],["qLabel","","slot","end","class","attendance-type-label","color","warning",4,"ngIf"],["qLabel","","slot","end","class","attendance-type-label","color","empty",4,"ngIf"],["qLabel","","slot","end","color","warning",1,"attendance-type-label"],["qLabel","","slot","end","color","empty",1,"attendance-type-label"],[1,"ion-padding","ion-text-center"],[1,"ion-padding","ion-text-center","absence-report-complete"],["name","checkmark","color","success"],["size","large","fill","clear",1,"ion-margin-top",3,"click"]],template:function(t,i){1&t&&e.DNE(0,ue,1,0,"q-spinner",2)(1,Pe,31,22,"ng-container",3),2&t&&(e.Y8G("ngIf",i.isBusy),e.R7$(),e.Y8G("ngIf",!i.isBusy))},dependencies:[c.In,c.Jm,c.hU,c.W9,c.A9,c.lO,c.iq,c.$w,c.uz,c.he,c.nf,c.AF,c.ln,c.Sb,c.Je,c.Gw,F.C,l.Sq,l.bT,L.t,N.k,A.D9,l.vh],styles:["ion-grid.grid[_ngcontent-%COMP%]{padding-left:0}ion-col.col[_ngcontent-%COMP%]{padding-left:0}.absence-report-complete[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:7em}.absence-report-complete[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:2em}.attendance-list[_ngcontent-%COMP%]   ion-item.disabled[_ngcontent-%COMP%]{background-color:var(--disabled)}.attendance-list[_ngcontent-%COMP%]   ion-icon.empty[_ngcontent-%COMP%]{color:#d3d3d3}.attendance-list[_ngcontent-%COMP%]   p.time[_ngcontent-%COMP%]{color:#000;font-size:.7em}.attendance-list[_ngcontent-%COMP%]   .attendance-type-label[_ngcontent-%COMP%]{margin:0}"]}),a})();var De=d(3656),xe=d(7583);function Ge(n,a){1&n&&(e.qex(0,10),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"PRESCHOOL_CLOSED")," "))}function Oe(n,a){1&n&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"REPORTED_ABSENCE")," "))}function Me(n,a){if(1&n&&(e.qex(0),e.EFF(1),e.nI1(2,"qTime"),e.j41(3,"span",16),e.EFF(4),e.nI1(5,"qTime"),e.k0s(),e.bVm()),2&n){const o=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,2,o.day.checkInChild)," "),e.R7$(3),e.JRh(e.bMT(5,4,o.day.plannedStart))}}function Le(n,a){if(1&n&&(e.EFF(0),e.nI1(1,"qTime")),2&n){const o=e.XpG(3);e.JRh(e.bMT(1,1,o.day.plannedStart))}}function je(n,a){if(1&n&&(e.j41(0,"ion-col",14),e.EFF(1),e.nI1(2,"translate"),e.DNE(3,Me,6,6,"ng-container",15)(4,Le,2,3,"ng-template",null,0,e.C5r),e.k0s()),2&n){const o=e.sdS(5),t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,3,"CHECK_IN"),": "),e.R7$(2),e.Y8G("ngIf",t.day.checkInChild)("ngIfElse",o)}}function $e(n,a){if(1&n&&(e.qex(0),e.EFF(1),e.nI1(2,"qTime"),e.j41(3,"span",16),e.EFF(4),e.nI1(5,"qTime"),e.k0s(),e.bVm()),2&n){const o=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,2,o.day.checkOutChild)," "),e.R7$(3),e.JRh(e.bMT(5,4,o.day.plannedEnd))}}function Ne(n,a){if(1&n&&e.EFF(0),2&n){const o=e.XpG(3);e.JRh(o.day.plannedEnd)}}function Be(n,a){if(1&n&&(e.j41(0,"ion-col",17),e.EFF(1),e.nI1(2,"translate"),e.DNE(3,$e,6,6,"ng-container",15)(4,Ne,1,1,"ng-template",null,1,e.C5r),e.k0s()),2&n){const o=e.sdS(5),t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,3,"CHECK_OUT"),": "),e.R7$(2),e.Y8G("ngIf",t.day.checkOutChild)("ngIfElse",o)}}function Xe(n,a){if(1&n&&(e.qex(0),e.DNE(1,Oe,3,3,"div",7),e.j41(2,"ion-grid",11)(3,"ion-row"),e.DNE(4,je,6,5,"ion-col",12)(5,Be,6,5,"ion-col",13),e.k0s()(),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.day.absence),e.R7$(3),e.Y8G("ngIf",!o.day.absence),e.R7$(),e.Y8G("ngIf",!o.day.absence)}}function Ve(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",18),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.onClickReport())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("color",o.day.absence?"danger":"warning"),e.R7$(),e.SpI(" ",e.bMT(2,2,o.day.absence?"UNREPORT":"REPORT")," ")}}function Ye(n,a){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.JRh(o.day.note)}}function we(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-textarea",25),e.nI1(1,"translate"),e.mxI("ngModelChange",function(i){e.eBV(o);const r=e.XpG(2);return e.DH7(r.note,i)||(r.note=i),e.Njj(i)}),e.k0s()}if(2&n){const o=e.XpG(2);e.FS9("placeholder",e.bMT(1,2,"WRITE_YOUR_MESSAGE_HERE")),e.R50("ngModel",o.note)}}function Ue(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",26),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.isEditing=!0)}),e.nrm(1,"fa-icon",27),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("icon",o.faEdit)}}function ze(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",28),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickCancel())}),e.nrm(1,"fa-icon",27),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("icon",o.faRemove)}}function We(n,a){if(1&n&&e.nrm(0,"fa-icon",27),2&n){const o=e.XpG(3);e.Y8G("icon",o.faSave)}}function Je(n,a){if(1&n&&e.nrm(0,"fa-icon",32),2&n){const o=e.XpG(3);e.Y8G("icon",o.faSpinner)("fixedWidth",!0)("pulse",!0)}}function Ke(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",29),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickSave())}),e.DNE(1,We,1,1,"fa-icon",30)(2,Je,1,3,"fa-icon",31),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",!o.isSavingNote),e.R7$(),e.Y8G("ngIf",o.isSavingNote)}}function He(n,a){if(1&n&&(e.j41(0,"ion-row")(1,"ion-col",19),e.DNE(2,Ye,2,1,"div",7)(3,we,2,4,"ion-textarea",20),e.k0s(),e.j41(4,"ion-col",21),e.DNE(5,Ue,2,1,"ion-button",22)(6,ze,2,1,"ion-button",23)(7,Ke,3,2,"ion-button",24),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.Y8G("ngIf",!o.isEditing),e.R7$(),e.Y8G("ngIf",o.isEditing),e.R7$(2),e.Y8G("ngIf",!o.isEditing),e.R7$(),e.Y8G("ngIf",o.isEditing),e.R7$(),e.Y8G("ngIf",o.isEditing)}}function qe(n,a){if(1&n&&(e.j41(0,"ion-row")(1,"ion-col"),e.EFF(2),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.SpI(" ",o.day.schoolNote," ")}}let Qe=(()=>{var n;class a extends M.${constructor(t,i,r,_){super(t,i,r),this.preschoolAttendanceService=_,this.isEditing=!1,this.isSavingNote=!1,this.faEdit=y.MT7,this.faRemove=y.iuH,this.faSpinner=y.z1G,this.faSave=y.hSh}ngOnInit(){this.absence=this.day.absence,this.note=this.day.note}onClickReport(){this.day.absence=!this.day.absence,this.save()}onClickCancel(){this.note=this.day.note,this.isEditing=!1}onClickSave(){var t=this;return(0,p.A)(function*(){t.isSavingNote=!0,t.day.note=t.note,yield t.save(),t.isEditing=!1,t.isSavingNote=!1})()}save(){var t=this;return(0,p.A)(function*(){try{yield t.preschoolAttendanceService.updateAttendance(t.day)}catch(r){let _=yield t.translate("ERROR_COULD_NOT_SAVE");t.userAlertService.alert(_)}let i=yield t.translate("SAVE_COMPLETE");t.userAlertService.info(i)})()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(c.Xi),e.rXU(A.c$),e.rXU(I.p),e.rXU(T.Q))},n.\u0275cmp=e.VBU({type:n,selectors:[["absence-report-form-preschool-item"]],inputs:{day:"day"},features:[e.Vt3],decls:13,vars:8,consts:[["plannedStart",""],["plannedEnd",""],[1,"ion-padding-horizontal"],[1,"absence-report-form","ion-no-padding","ion-margin-bottom"],[1,"ion-align-items-top","ion-justify-content-between"],["size","8"],["class","closed",4,"ngIf"],[4,"ngIf"],["size","4",1,"ion-text-end"],["size","small",3,"color","click",4,"ngIf"],[1,"closed"],[1,"ion-no-padding"],["class","check-in",4,"ngIf"],["class","check-out",4,"ngIf"],[1,"check-in"],[4,"ngIf","ngIfElse"],[1,"time-changed"],[1,"check-out"],["size","small",3,"click","color"],["size","9"],["autocapitalize","on","autosize","",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],["size","3",1,"ion-text-end"],["size","small",3,"click",4,"ngIf"],["size","small","color","warning",3,"click",4,"ngIf"],["size","small","color","success",3,"click",4,"ngIf"],["autocapitalize","on","autosize","",3,"ngModelChange","ngModel","placeholder"],["size","small",3,"click"],[3,"icon"],["size","small","color","warning",3,"click"],["size","small","color","success",3,"click"],[3,"icon",4,"ngIf"],[3,"icon","fixedWidth","pulse",4,"ngIf"],[3,"icon","fixedWidth","pulse"]],template:function(t,i){1&t&&(e.j41(0,"div",2)(1,"ion-grid",3)(2,"ion-row",4)(3,"ion-col",5)(4,"h4"),e.EFF(5),e.nI1(6,"qDayAndDate"),e.k0s(),e.DNE(7,Ge,3,3,"ng-container",6)(8,Xe,6,3,"ng-container",7),e.k0s(),e.j41(9,"ion-col",8),e.DNE(10,Ve,3,4,"ion-button",9),e.k0s()(),e.DNE(11,He,8,5,"ion-row",7)(12,qe,3,1,"ion-row",7),e.k0s()()),2&t&&(e.R7$(5),e.JRh(e.bMT(6,6,i.day.date)),e.R7$(2),e.Y8G("ngIf",i.day.closed),e.R7$(),e.Y8G("ngIf",!i.day.closed),e.R7$(2),e.Y8G("ngIf",!i.day.closed),e.R7$(),e.Y8G("ngIf",!i.day.closed),e.R7$(),e.Y8G("ngIf",i.day.schoolNote))},dependencies:[c.Jm,c.hU,c.lO,c.ln,c.nc,c.Gw,X.U,l.bT,s.BC,s.vS,$.aY,xe.K,N.k,A.D9],styles:[".absence-report-form[_ngcontent-%COMP%]{border-top:1px solid lightgray}h4[_ngcontent-%COMP%]{text-transform:uppercase;margin-top:.1em;margin-bottom:.1em}.check-in[_ngcontent-%COMP%], .check-out[_ngcontent-%COMP%]{white-space:nowrap}.check-in[_ngcontent-%COMP%]{padding-right:16px!important}.time-changed[_ngcontent-%COMP%]{font-size:.9em;text-decoration:line-through;opacity:.75}"]}),a})(),Ze=(()=>{var n;class a{constructor(t){this.ds=t}transform(t,...i){return t?this.ds.getIsoWeek(t).toString():""}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(u.k,16))},n.\u0275pipe=e.EJ8({name:"qWeekNumber",type:n,pure:!0}),a})(),et=(()=>{var n;class a{transform(t,...i){return t?t.getFullYear().toString():""}}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.EJ8({name:"qYear",type:n,pure:!0}),a})();function tt(n,a){1&n&&e.nrm(0,"q-spinner",2)}function nt(n,a){if(1&n&&(e.qex(0),e.nrm(1,"absence-report-form-preschool-item",13),e.bVm()),2&n){const o=a.$implicit;e.R7$(),e.Y8G("day",o)}}function it(n,a){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"div",3)(2,"ion-grid",4)(3,"ion-row",5)(4,"ion-col",6)(5,"ion-button",7),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.back())}),e.nrm(6,"ion-icon",8),e.k0s()(),e.j41(7,"ion-col",9),e.EFF(8),e.nI1(9,"translate"),e.nI1(10,"qWeekNumber"),e.nI1(11,"qYear"),e.k0s(),e.j41(12,"ion-col",10)(13,"ion-button",7),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.forward())}),e.nrm(14,"ion-icon",11),e.k0s()()()()(),e.DNE(15,nt,2,1,"ng-container",12),e.bVm()}if(2&n){const o=e.XpG();e.R7$(8),e.E5c(" ",e.bMT(9,4,"WEEK_SHORT"),". ",e.bMT(10,6,o.date)," ",e.bMT(11,8,o.date)," "),e.R7$(7),e.Y8G("ngForOf",o.attendances)}}let ot=(()=>{var n;class a extends M.${constructor(t,i,r,_,f){super(t,i,r),this.preschoolAttendanceService=_,this.dateService=f,this.confirmButtonEnabledChanged=new e.bkB(!1),this.isSavingChanged=new e.bkB(!1),this.isInitialized=!1,this.isSaving=!1}ngOnInit(){this.initView()}back(){this.date=this.dateService.subDays(this.date,7),this.loadAttendances()}forward(){this.date=this.dateService.addDays(this.date,7),this.loadAttendances()}initView(){var t=this;return(0,p.A)(function*(){t.date=t.dateService.startOfWeek(Date.now()),yield t.loadAttendances(),t.isInitialized=!0})()}loadAttendances(){var t=this;return(0,p.A)(function*(){let i=t.date,r=t.dateService.addDays(t.date,5);t.attendances=yield t.preschoolAttendanceService.getChildAttendances(t.student.studentId,i,r)})()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(c.Xi),e.rXU(A.c$),e.rXU(I.p),e.rXU(T.Q),e.rXU(u.k))},n.\u0275cmp=e.VBU({type:n,selectors:[["absence-report-form-preschool"]],inputs:{student:"student"},outputs:{confirmButtonEnabledChanged:"confirmButtonEnabledChanged",isSavingChanged:"isSavingChanged"},features:[e.Vt3],decls:2,vars:2,consts:[["class","ion-margin-top",4,"ngIf"],[4,"ngIf"],[1,"ion-margin-top"],[1,"ion-padding"],[1,"ion-no-padding"],[1,"ion-align-items-center"],["size","2",1,"ion-text-start"],["size","small",3,"click"],["name","chevron-back"],["size","8",1,"week","ion-text-center"],["size","2",1,"ion-text-end"],["name","chevron-forward"],[4,"ngFor","ngForOf"],[1,"ion-margin-bottom",3,"day"]],template:function(t,i){1&t&&e.DNE(0,tt,1,0,"q-spinner",0)(1,it,16,10,"ng-container",1),2&t&&(e.Y8G("ngIf",!i.isInitialized),e.R7$(),e.Y8G("ngIf",i.isInitialized))},dependencies:[c.Jm,c.hU,c.lO,c.iq,c.ln,l.Sq,l.bT,Qe,L.t,Ze,et,A.D9],styles:[".week[_ngcontent-%COMP%]{font-size:1.3em}"]}),a})();function st(n,a){1&n&&e.nrm(0,"q-spinner",8)}function at(n,a){if(1&n){const o=e.RV6();e.j41(0,"absence-report-form",9),e.bIt("confirmButtonEnabledChanged",function(i){e.eBV(o);const r=e.XpG();return e.Njj(r.confirmButtonEnabled=i)})("isSavingChanged",function(i){e.eBV(o);const r=e.XpG();return e.Njj(r.isSaving=i)}),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("student",o.student)}}function rt(n,a){if(1&n){const o=e.RV6();e.j41(0,"absence-report-form-restricted",9),e.bIt("confirmButtonEnabledChanged",function(i){e.eBV(o);const r=e.XpG();return e.Njj(r.confirmButtonEnabled=i)})("isSavingChanged",function(i){e.eBV(o);const r=e.XpG();return e.Njj(r.isSaving=i)}),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("student",o.student)}}function ct(n,a){if(1&n&&e.nrm(0,"absence-report-form-preschool",10),2&n){const o=e.XpG();e.Y8G("student",o.student)}}function lt(n,a){if(1&n&&e.nrm(0,"fa-icon",15),2&n){const o=e.XpG(2);e.Y8G("icon",o.faSpinner)("fixedWidth",!0)("pulse",!0)}}function dt(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-footer")(1,"ion-toolbar")(2,"div",11)(3,"ion-button",12),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.onClickConfirm())}),e.EFF(4),e.nI1(5,"translate"),e.DNE(6,lt,1,3,"fa-icon",13),e.k0s(),e.j41(7,"ion-button",14),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.dismiss())}),e.EFF(8),e.nI1(9,"translate"),e.k0s()()()()}if(2&n){const o=e.XpG();e.R7$(3),e.Y8G("disabled",!o.confirmButtonEnabled||o.isSaving),e.R7$(),e.SpI(" ",e.bMT(5,5,"CONFIRM")," "),e.R7$(2),e.Y8G("ngIf",o.isSaving),e.R7$(),e.Y8G("disabled",o.isSaving),e.R7$(),e.SpI(" ",e.bMT(9,7,"CANCEL")," ")}}let _t=(()=>{var n;class a{constructor(t,i,r){this.modalCtrl=t,this.navParams=i,this.userInfoProvider=r,this.isInitialized=!1,this.confirmButtonEnabled=!1,this.isSaving=!1,this.faSpinner=y.z1G,this.userInfo={},this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.userInfoProvider.userInfoState.subscribe(t=>this.userInfo=t))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}get isPreschool(){return this.student&&this.student.preschoolChild}get isRestricted(){return"Guardian"==this.userInfo.roleName||"Student"==this.userInfo.roleName}ionViewWillEnter(){this.initView()}initView(){var t=this;return(0,p.A)(function*(){t.student=t.navParams.data.student,t.studentName=`${t.student.firstName} ${t.student.lastName}`,t.isInitialized=!0})()}setConfirmButtonEnabled(t){this.confirmButtonEnabled=t}onClickConfirm(){this.isInitialized&&!this.isPreschool&&(this.isRestricted?this.restrictedFormComponent.onClickConfirm():this.absenceReportFormComponent.onClickConfirm())}dismiss(){this.modalCtrl.dismiss()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(c.W3),e.rXU(De.y8),e.rXU(v.Z))},n.\u0275cmp=e.VBU({type:n,selectors:[["page-absence-report-form"]],viewQuery:function(t,i){if(1&t&&(e.GBs(V,5),e.GBs(Y,5)),2&t){let r;e.mGM(r=e.lsd())&&(i.restrictedFormComponent=r.first),e.mGM(r=e.lsd())&&(i.absenceReportFormComponent=r.first)}},decls:22,vars:15,consts:[["slot","start"],[3,"click"],["class","ion-margin-top",4,"ngIf"],[1,"ion-padding"],[1,"student-name"],[3,"student","confirmButtonEnabledChanged","isSavingChanged",4,"ngIf"],[3,"student",4,"ngIf"],[4,"ngIf"],[1,"ion-margin-top"],[3,"confirmButtonEnabledChanged","isSavingChanged","student"],[3,"student"],[1,"ion-text-center"],["color","success",3,"click","disabled"],[3,"icon","fixedWidth","pulse",4,"ngIf"],["fill","clear",3,"click","disabled"],[3,"icon","fixedWidth","pulse"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"ion-buttons",0)(6,"ion-button",1),e.bIt("click",function(){return i.dismiss()}),e.j41(7,"ion-label"),e.EFF(8),e.nI1(9,"translate"),e.k0s()()()()(),e.j41(10,"ion-content"),e.DNE(11,st,1,0,"q-spinner",2),e.j41(12,"div",3)(13,"div"),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"div",4),e.EFF(17),e.k0s()(),e.DNE(18,at,1,1,"absence-report-form",5)(19,rt,1,1,"absence-report-form-restricted",5)(20,ct,1,1,"absence-report-form-preschool",6),e.k0s(),e.DNE(21,dt,10,9,"ion-footer",7)),2&t&&(e.R7$(3),e.JRh(e.bMT(4,9,"ABSENCE_REPORT")),e.R7$(5),e.SpI(" ",e.bMT(9,11,"BACK"),""),e.R7$(3),e.Y8G("ngIf",!i.isInitialized),e.R7$(3),e.JRh(e.bMT(15,13,"ABSENCE_REPORT_FOR")),e.R7$(3),e.JRh(i.studentName),e.R7$(),e.Y8G("ngIf",i.isInitialized&&!i.isPreschool&&!i.isRestricted),e.R7$(),e.Y8G("ngIf",i.isInitialized&&!i.isPreschool&&i.isRestricted),e.R7$(),e.Y8G("ngIf",i.isInitialized&&i.isPreschool),e.R7$(),e.Y8G("ngIf",!i.isPreschool))},dependencies:[l.bT,c.Jm,c.QW,c.W9,c.M0,c.eU,c.he,c.BC,c.ai,Y,ot,V,L.t,$.aY,A.D9],styles:[".student-name[_ngcontent-%COMP%]{font-size:1.33em}"]}),a})();const pt=["student-absence-report",""];function ut(n,a){1&n&&e.nrm(0,"q-spinner",2)}function mt(n,a){if(1&n&&(e.j41(0,"div",5)(1,"h4",6),e.EFF(2),e.k0s()()),2&n){const o=e.XpG(2);e.R7$(2),e.JRh(null==o.student?null:o.student.schoolName)}}function ht(n,a){1&n&&(e.j41(0,"h2",6),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"ABSENCE_REPORTED_TODAY")," "))}function ft(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",10),e.bIt("click",function(){e.eBV(o);const i=e.XpG(3);return e.Njj(i.onClickSimple())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"ABSENCE_REPORT_ABSENCE_FOR_TODAY")," "))}function gt(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",12),e.bIt("click",function(){e.eBV(o);const i=e.XpG(4);return e.Njj(i.onClickAdvanced())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"ABSENCE_PICK_LESSONS")," "))}function bt(n,a){if(1&n&&(e.j41(0,"ion-row")(1,"ion-col",7),e.DNE(2,gt,3,3,"ion-button",11),e.k0s()()),2&n){const o=e.XpG(3);e.R7$(2),e.Y8G("ngIf",!o.onlyAllowReportAbsenceForWholeDay)}}function Rt(n,a){if(1&n&&(e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",7),e.DNE(3,ht,3,3,"h2",8)(4,ft,3,3,"ion-button",9),e.k0s()(),e.DNE(5,bt,3,1,"ion-row",1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(3),e.Y8G("ngIf",o.isReportedAbsentToday),e.R7$(),e.Y8G("ngIf",!o.isReportedAbsentToday),e.R7$(),e.Y8G("ngIf",!o.lessonsDisabled)}}function At(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",7)(3,"h1"),e.EFF(4),e.k0s()()(),e.j41(5,"ion-row")(6,"ion-col",7)(7,"ion-button",13),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickConfirmSimple())}),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"ion-button",14),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.onClickCancelSimple())}),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()()}if(2&n){const o=e.XpG(2);e.R7$(4),e.SpI("Vill du anm\xe4la fr\xe5nvaro f\xf6r ",o.studentName," hela dagen idag?"),e.R7$(3),e.Y8G("disabled",!o.studentId),e.R7$(),e.SpI(" ",e.bMT(9,4,"YES")," "),e.R7$(3),e.SpI(" ",e.bMT(12,6,"CANCEL")," ")}}function Ct(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",7)(3,"h1"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"ion-button",15),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.step="simple")}),e.EFF(7),e.nI1(8,"translate"),e.k0s()()()()}2&n&&(e.R7$(4),e.JRh(e.bMT(5,2,"ABSENCE_YOUR_REPORT_IS_COMPLETE")),e.R7$(3),e.SpI(" ",e.bMT(8,4,"BACK")," "))}function It(n,a){1&n&&(e.j41(0,"p",16),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"ABSENCE_REPORT_ONLY_ALLOWED_FOR_FUTURE_LESSONS")," "))}function Et(n,a){if(1&n&&(e.qex(0),e.DNE(1,mt,3,1,"div",3)(2,Rt,6,3,"ion-grid",1)(3,At,13,8,"ion-grid",1)(4,Ct,9,6,"ion-grid",1)(5,It,3,3,"p",4),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.isGuardian()),e.R7$(),e.Y8G("ngIf","simple"===o.step),e.R7$(),e.Y8G("ngIf","confirm-simple"===o.step),e.R7$(),e.Y8G("ngIf","done"===o.step),e.R7$(),e.Y8G("ngIf",o.onlyFutureReporting)}}let w=(()=>{var n;class a extends M.${constructor(t,i,r,_,f,C,R,x,B,Xt,Vt){super(t,i,r),this.modalCtrl=_,this.attendanceService=f,this.attendanceTypes=C,this.dateService=R,this.studentService=x,this.preschoolAttendanceService=B,this.schoolOptionsService=Xt,this.userInfoProvider=Vt,this.lessonsDisabled=!1,this.isBusy=!0,this.step="simple",this.studentName="",this.today=this.dateService.formatDateIso8601(new Date)}ngOnChanges(t){this.addSub(this.userInfoProvider.userInfoState.subscribe(i=>this.userInfo=i)),t.studentId&&this.studentId&&this.initStudent()}isGuardian(){var t;return this.userInfo&&"Guardian"==(null===(t=this.userInfo)||void 0===t?void 0:t.roleName)}onClickSimple(){this.step="confirm-simple"}onClickAdvanced(){var t=this;return(0,p.A)(function*(){let i=yield t.modalCtrl.create({component:_t,componentProps:{student:t.student}});i.present(),i.onDidDismiss().then(()=>{t.initStudent()})})()}onClickCancelSimple(){this.step="simple"}onClickConfirmSimple(){this.reportAllDay()}onChangeAdvanced(t){this.updateAttendances(t)}get isReportedAbsentToday(){return!!this.student&&(this.student.preschoolChild&&this.preschoolAttendances&&this.preschoolAttendances.length>0?this.preschoolAttendances.filter(i=>this.dateService.isSameDay(this.today,i.date)).every(i=>i.absence):!!(this.attendances&&this.attendances.length>0)&&this.attendances.filter(i=>this.dateService.isSameDay(this.today,i.lessonDate)).every(i=>i.validAbsence))}get onlyFutureReporting(){return this.options&&this.options.allowAbsenceReportOnlyForFutureLessons}get onlyAllowReportAbsenceForWholeDay(){return this.options&&this.options.onlyAllowReportAbsenceForWholeDay}initStudent(){var t=this;return(0,p.A)(function*(){t.isBusy=!0,t.student=yield t.studentService.getStudent(t.studentId),t.options=yield t.schoolOptionsService.loadSchoolOptions(t.student.schoolId);let i=yield t.translate("ABSENCE_DO_YOU_WANT_TO_REPORT_ABSENCE_FOR_TODAY");t.confirmSimpleHeading=i.replace("{studentName}",t.student.name),t.student.preschoolChild?t.preschoolAttendances=yield t.preschoolAttendanceService.getChildAttendances(Number(t.studentId),new Date(t.today),new Date(t.today)):t.attendances=yield t.attendanceService.getAttendance(t.studentId,new Date(t.today),new Date(t.today)),t.isBusy=!1})()}reportAllDay(){var t=this;return(0,p.A)(function*(){if(t.studentId){if(t.student.preschoolChild||t.student.leisureChild){let i=yield t.preschoolAttendanceService.getChildAttendances(Number(t.studentId),new Date(t.today),new Date(t.today));t.reportPreschoolAttendances(i)}if(!t.student.preschoolChild){let i=yield t.attendanceService.getAttendance(t.studentId,new Date(t.today),new Date(t.today));t.reportAttendances(i)}}})()}reportAttendances(t){var i=this;return(0,p.A)(function*(){yield i.attendanceTypes.init({schoolId:i.student.schoolId});let r=i.attendanceTypes.validAbsenceType.attendanceTypeId;t.forEach(_=>{_.attendanceTypeId=r,_.note=i.note}),i.updateAttendances(t)})()}reportPreschoolAttendances(t){var i=this;return(0,p.A)(function*(){yield i.updatePreschoolAttendances(t),i.step="done",i.note="",i.initStudent()})()}updatePreschoolAttendances(t){var i=this;return(0,p.A)(function*(){t.forEach(function(){var r=(0,p.A)(function*(_){_.absence=!0,yield i.preschoolAttendanceService.updateAttendance(_)});return function(_){return r.apply(this,arguments)}}())})()}updateAttendances(t){var i=this;return(0,p.A)(function*(){yield i.attendanceService.updateAttendances(t),i.step="done",i.note="",i.initStudent()})()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(c.Xi),e.rXU(A.c$),e.rXU(I.p),e.rXU(c.W3),e.rXU(h.$),e.rXU(g.a),e.rXU(u.k),e.rXU(G.b),e.rXU(T.Q),e.rXU(E.Y),e.rXU(v.Z))},n.\u0275cmp=e.VBU({type:n,selectors:[["","student-absence-report",""]],inputs:{lessonsDisabled:"lessonsDisabled",studentId:"studentId",userInfo:"userInfo",validAbsenceType:"validAbsenceType"},features:[e.Jv_([G.b]),e.Vt3,e.OA$],attrs:pt,decls:2,vars:2,consts:[["class","ion-margin-top",4,"ngIf"],[4,"ngIf"],[1,"ion-margin-top"],["style","display: flex; justify-content: center; align-items: center;",4,"ngIf"],["class","help-text ion-padding ion-text-center",4,"ngIf"],[2,"display","flex","justify-content","center","align-items","center"],[1,"reportedAbsentToday","ion-no-margin"],[1,"ion-text-center"],["class","reportedAbsentToday ion-no-margin",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["color","success",3,"click"],["color","primary",3,"click",4,"ngIf"],["color","primary",3,"click"],["size","large","color","success","margin","",3,"click","disabled"],["color","primary","margin","",3,"click"],["fill","outline",3,"click"],[1,"help-text","ion-padding","ion-text-center"]],template:function(t,i){1&t&&e.DNE(0,ut,1,0,"q-spinner",0)(1,Et,6,5,"ng-container",1),2&t&&(e.Y8G("ngIf",i.isBusy),e.R7$(),e.Y8G("ngIf",!i.isBusy))},dependencies:[c.Jm,c.hU,c.lO,c.ln,l.bT,L.t,A.D9],styles:["[student-absence-report][_ngcontent-%COMP%]   .help-text[_ngcontent-%COMP%]{font-size:.75em}.reportedAbsentToday[_ngcontent-%COMP%]{font-size:1rem}"]}),a})();function St(n,a){if(1&n&&(e.j41(0,"ion-card")(1,"h1",1),e.EFF(2),e.k0s(),e.nrm(3,"div",2),e.k0s()),2&n){const o=a.$implicit;e.R7$(2),e.JRh(o.name),e.R7$(),e.Y8G("studentId",o.id)}}let Tt=(()=>{var n;class a{constructor(t){this.studentsProvider=t}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(D.s))},n.\u0275cmp=e.VBU({type:n,selectors:[["absence-report-guardian"]],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"ion-text-center"],["student-absence-report","",3,"studentId"]],template:function(t,i){1&t&&e.DNE(0,St,4,2,"ion-card",0),2&t&&e.Y8G("ngForOf",i.studentsProvider.list)},dependencies:[c.b_,l.Sq,w],encapsulation:2}),a})();var vt=d(8330);function yt(n,a){1&n&&(e.j41(0,"div",3),e.nrm(1,"q-spinner"),e.k0s())}function Ft(n,a){1&n&&(e.j41(0,"div",4),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&n&&(e.R7$(),e.JRh(e.bMT(2,1,"NO_STUDENTS_CONNECTED")))}function kt(n,a){if(1&n){const o=e.RV6();e.j41(0,"div",3)(1,"ion-item",5)(2,"ion-label",6),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"ion-input",7),e.nI1(6,"translate"),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.openStudentPicker())}),e.k0s()()()}if(2&n){const o=e.XpG();e.R7$(3),e.JRh(e.bMT(4,3,"STUDENT")),e.R7$(2),e.FS9("placeholder",e.bMT(6,5,"NO_ITEM_SELECTED")),e.Y8G("value",o.studentName)}}function Pt(n,a){if(1&n&&e.nrm(0,"div",8),2&n){const o=e.XpG();e.Y8G("studentId",o.student.id)}}let Dt=(()=>{var n;class a extends M.${constructor(t,i,r,_,f,C){super(t,i,r),this.modalCtrl=_,this.studentsProvider=f,this.zone=C,this.isInitialized=!1,this.hasStudents=!1,this.initView()}get studentName(){return this.student?this.student.name:this.translations.SELECT_STUDENT}initView(){var t=this;return(0,p.A)(function*(){t.students=yield t.studentsProvider.init(),t.hasStudents=t.students.length>0,t.addSub(t.translateService.get(["NO_STUDENTS_CONNECTED","SELECT_STUDENT"]).subscribe(i=>t.translations=i)),t.isInitialized=!0})()}openStudentPicker(){var t=this;return(0,p.A)(function*(){let i=yield t.modalCtrl.create({component:vt.M,componentProps:{multi:!1,items:t.students,title:t.translations.SELECT_STUDENT,emptyLabel:t.translations.NO_STUDENTS_CONNECTED}});i.present(),t.zone.run(()=>i.onDidDismiss().then(r=>{r&&r.data&&r.data.item&&(t.student=r.data.item,t.studentId=r.data.item.id)}))})()}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(c.Xi),e.rXU(A.c$),e.rXU(I.p),e.rXU(c.W3),e.rXU(D.s),e.rXU(e.SKi))},n.\u0275cmp=e.VBU({type:n,selectors:[["absence-report-not-guardian"]],features:[e.Vt3],decls:4,vars:4,consts:[["class","ion-padding",4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],["student-absence-report","",3,"studentId",4,"ngIf"],[1,"ion-padding"],[1,"ion-padding","ion-text-center"],[1,"ion-no-padding"],["position","stacked"],["readonly","",3,"click","value","placeholder"],["student-absence-report","",3,"studentId"]],template:function(t,i){1&t&&e.DNE(0,yt,2,0,"div",0)(1,Ft,3,3,"div",1)(2,kt,7,7,"div",0)(3,Pt,1,1,"div",2),2&t&&(e.Y8G("ngIf",!i.isInitialized),e.R7$(),e.Y8G("ngIf",i.isInitialized&&!i.hasStudents),e.R7$(),e.Y8G("ngIf",i.isInitialized&&i.hasStudents),e.R7$(),e.Y8G("ngIf",i.student))},dependencies:[c.$w,c.uz,c.he,c.Gw,l.bT,L.t,w,A.D9],styles:[".student-picker[_ngcontent-%COMP%]{border:solid 1px var(--quiculum-pink)}"]}),a})();var xt=d(4416);function Gt(n,a){1&n&&(e.j41(0,"div",4),e.nrm(1,"q-spinner"),e.k0s())}function Ot(n,a){1&n&&e.nrm(0,"absence-report-guardian")}function Mt(n,a){1&n&&e.nrm(0,"absence-report-not-guardian")}function Lt(n,a){if(1&n&&(e.j41(0,"div"),e.DNE(1,Ot,1,0,"absence-report-guardian",3)(2,Mt,1,0,"absence-report-not-guardian",3),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.isGuardianOrStudent),e.R7$(),e.Y8G("ngIf",!o.isGuardianOrStudent)}}const jt=[{path:"",component:(()=>{var n;class a extends b.v{constructor(t,i,r,_,f,C,R,x){super(t,r,i,_,f,R),this.students=C,this.userInfo=R,this.loginStatus=x,this.isInitialized=!1}get isGuardianOrStudent(){return"Guardian"==this.loginStatus.roleName||"Student"==this.loginStatus.roleName}ionViewDidEnter(){return this.initializePage(),!0}initializePage(){Promise.all([this.userInfo.init(),this.students.init()]).then(t=>{this.isInitialized=!0})}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(S.$),e.rXU(c.Xi),e.rXU(m.Ix),e.rXU(A.c$),e.rXU(I.p),e.rXU(D.s),e.rXU(v.Z),e.rXU(O.B))},n.\u0275cmp=e.VBU({type:n,selectors:[["page-absence-report"]],features:[e.Vt3],decls:6,vars:6,consts:[[3,"translucent"],[3,"pageTitle"],["class","ion-padding-top",4,"ngIf"],[4,"ngIf"],[1,"ion-padding-top"]],template:function(t,i){1&t&&(e.j41(0,"ion-header",0),e.nrm(1,"app-header",1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"ion-content"),e.DNE(4,Gt,2,0,"div",2)(5,Lt,3,2,"div",3),e.k0s()),2&t&&(e.Y8G("translucent",!0),e.R7$(),e.FS9("pageTitle",e.bMT(2,4,"ABSENCE_REPORT_TITLE")),e.R7$(3),e.Y8G("ngIf",!i.isInitialized),e.R7$(),e.Y8G("ngIf",i.isInitialized))},dependencies:[l.bT,c.W9,c.eU,Tt,Dt,xt.l,L.t,A.D9]}),a})()}];let $t=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.iI.forChild(jt),m.iI]}),a})();var Nt=d(7019);let Bt=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.MD,s.YN,s.X1,c.bv,$t,A.h,Nt.h,$.dX]}),a})()},8330:(j,k,d)=>{d.d(k,{M:()=>M});var l=d(467),c=d(1876),s=d(4438),m=d(4742),b=d(3656),e=d(230),S=d(177);function A(h,T){if(1&h){const g=s.RV6();s.j41(0,"ion-button",1),s.bIt("click",function(){s.eBV(g);const E=s.XpG();return s.Njj(E.dismiss())}),s.EFF(1),s.nI1(2,"translate"),s.k0s()}2&h&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"DONE")," "))}function I(h,T){if(1&h&&(s.j41(0,"p",6),s.EFF(1),s.k0s()),2&h){const g=s.XpG();s.R7$(),s.JRh(g.emptyLabel)}}function D(h,T){if(1&h){const g=s.RV6();s.j41(0,"ion-searchbar",8),s.nI1(1,"translate"),s.bIt("ionInput",function(E){s.eBV(g);const F=s.XpG(2);return s.Njj(F.onSearchInput(E))}),s.k0s()}2&h&&s.FS9("placeholder",s.bMT(1,1,"SEARCH"))}function v(h,T){if(1&h){const g=s.RV6();s.j41(0,"ion-item")(1,"ion-label"),s.EFF(2),s.k0s(),s.j41(3,"ion-checkbox",10),s.bIt("ionChange",function(){const E=s.eBV(g).$implicit,F=s.XpG(3);return s.Njj(F.onClickItem(E))}),s.k0s()()}if(2&h){const g=T.$implicit,u=s.XpG(3);s.R7$(2),s.JRh(g.name),s.R7$(),s.Y8G("checked",u.isSelected(g))}}function O(h,T){if(1&h&&(s.j41(0,"ion-list"),s.DNE(1,v,4,2,"ion-item",9),s.k0s()),2&h){const g=s.XpG(2);s.R7$(),s.Y8G("ngForOf",g.filteredItems)}}function p(h,T){if(1&h&&(s.j41(0,"div")(1,"ion-label",13),s.EFF(2),s.k0s()()),2&h){const g=s.XpG().$implicit;s.R7$(2),s.JRh(g.schoolName)}}function G(h,T){if(1&h){const g=s.RV6();s.j41(0,"ion-item",12),s.bIt("click",function(){const E=s.eBV(g).$implicit,F=s.XpG(3);return s.Njj(F.onClickItem(E))}),s.j41(1,"ion-label"),s.EFF(2),s.k0s(),s.DNE(3,p,3,1,"div",5),s.k0s()}if(2&h){const g=T.$implicit;s.R7$(2),s.JRh(g.name),s.R7$(),s.Y8G("ngIf",g.schoolName)}}function y(h,T){if(1&h&&(s.j41(0,"ion-list"),s.DNE(1,G,4,2,"ion-item",11),s.k0s()),2&h){const g=s.XpG(2);s.R7$(),s.Y8G("ngForOf",g.filteredItems)}}function P(h,T){if(1&h&&(s.qex(0),s.DNE(1,D,2,3,"ion-searchbar",7)(2,O,2,1,"ion-list",5)(3,y,2,1,"ion-list",5),s.bVm()),2&h){const g=s.XpG();s.R7$(),s.Y8G("ngIf",g.isSearchVisible),s.R7$(),s.Y8G("ngIf",g.isMultiSelect),s.R7$(),s.Y8G("ngIf",!g.isMultiSelect)}}let M=(()=>{var h;class T{constructor(u,E,F){this.modalCtrl=u,this.navParams=E,this.translate=F,this.isSearching=!1,this.filteredItems=[],this.selection=new c.Y}ionViewWillEnter(){var u=this;return(0,l.A)(function*(){yield u.initLang(),u.initView()})()}get isSearchVisible(){return this.items&&this.items.length>10}isSelected(u){return this.selection.isSelected(u)}onClickItem(u){this.isMultiSelect?this.toggleSelection(u):(this.selection.selectItem(u),this.dismiss())}onSearchInput(u){let E=u.target.value||"";this.filteredItems=this.items.filter(F=>this.match(E,F))}dismiss(){let u=this.selection.selectedItems;0===u.length?this.modalCtrl.dismiss():this.modalCtrl.dismiss(this.isMultiSelect?{items:u}:{item:u[0]})}initLang(){this.translate.setDefaultLang("sv");const u=this.translate.getBrowserLang();u&&u.startsWith("en")?this.translate.use("en"):this.translate.use("sv"),this.translate.get(["SELECTABLE_OPTIONS_MISSING","SELECT_ONE_OR_MORE","SELECT_ONE"]).subscribe(F=>{this.translations=F})}initView(){this.selection=new c.Y,this.emptyLabel=this.navParams.data.emptyLabel||this.translations.SELECTABLE_OPTIONS_MISSING,this.isMultiSelect=this.navParams.data.multi,this.title=this.navParams.data.title||(this.isMultiSelect?this.translations.SELECT_ONE_OR_MORE:this.translations.SELECT_ONE),this.items=this.navParams.data.items,this.isEmpty=0==this.items.length,this.selection.setSelectedItems(this.navParams.data.selectedItems||[]),this.filteredItems=this.items}match(u,E){let F=u.toLocaleLowerCase();return E.name.toLocaleLowerCase().indexOf(F)>-1}toggleSelection(u){this.selection.toggleItem(u)}}return(h=T).\u0275fac=function(u){return new(u||h)(s.rXU(m.W3),s.rXU(b.y8),s.rXU(e.c$))},h.\u0275cmp=s.VBU({type:h,selectors:[["page-picker"]],decls:14,vars:7,consts:[["slot","start"],["fill","clear",3,"click"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-padding","ion-text-center"],["autocapitalize","off",3,"placeholder","ionInput",4,"ngIf"],["autocapitalize","off",3,"ionInput","placeholder"],[4,"ngFor","ngForOf"],["item-end","",3,"ionChange","checked"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[2,"color","black","font-size","0.7em"]],template:function(u,E){1&u&&(s.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),s.bIt("click",function(){return E.dismiss()}),s.j41(4,"span"),s.EFF(5),s.nI1(6,"translate"),s.k0s()()(),s.j41(7,"ion-title"),s.EFF(8),s.k0s(),s.j41(9,"ion-buttons",2),s.DNE(10,A,3,3,"ion-button",3),s.k0s()()(),s.j41(11,"ion-content"),s.DNE(12,I,2,1,"p",4)(13,P,4,3,"ng-container",5),s.k0s()),2&u&&(s.R7$(5),s.JRh(s.bMT(6,5,"CANCEL")),s.R7$(3),s.JRh(E.title),s.R7$(2),s.Y8G("ngIf",E.isMultiSelect),s.R7$(2),s.Y8G("ngIf",E.isEmpty),s.R7$(),s.Y8G("ngIf",!E.isEmpty))},dependencies:[S.Sq,S.bT,m.Jm,m.QW,m.eY,m.W9,m.eU,m.uz,m.he,m.nf,m.S1,m.BC,m.ai,m.hB,m.Gw,e.D9],encapsulation:2}),T})()},2129:(j,k,d)=>{d.d(k,{h:()=>s});var l=d(467),c=d(1622);class s extends c.D{constructor(b,e){super(),this.api=b,this.loginStatus=e,this.list=[],this.setupClearOnLogout()}clear(){this.list=[]}init(b){var e=this;return(0,l.A)(function*(){let S=JSON.stringify(b);return S!=e.stringifiedParams&&(e.clear(),e.stringifiedParams=S),e.list.length||(e.list=yield e.loadList(b)),e.list})()}refresh(){var b=this;return(0,l.A)(function*(){return b.list=[],b.init()})()}loadList(b){return this.api.get(this.listEndpoint,b)}setupClearOnLogout(){this.addSub(this.loginStatus.isLoggedInState.subscribe(b=>{b||this.clear()}))}}},6969:(j,k,d)=>{d.d(k,{s:()=>b});var l=d(2129),c=d(4438),s=d(6244),m=d(6186);let b=(()=>{var e;class S extends l.h{constructor(I,D){super(I,D),this.listEndpoint="api/students/list?includeallschools=true",this.setupClearOnRoleChange()}setupClearOnRoleChange(){this.addSub(this.loginStatus.roleNameState.subscribe(I=>{I&&this.clear()}))}}return(e=S).\u0275fac=function(I){return new(I||e)(c.KVO(s.j),c.KVO(m.B))},e.\u0275prov=c.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),S})()}}]);