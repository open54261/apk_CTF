"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[761],{4416:(G,v,_)=>{_.d(v,{l:()=>e});var d=_(4438),k=_(9598),i=_(4742),p=_(177),m=_(230);const E=["*"];function P(y,I){if(1&y&&(d.j41(0,"ion-buttons",5),d.nrm(1,"ion-back-button",6),d.nI1(2,"translate"),d.k0s()),2&y){const F=d.XpG();d.R7$(),d.FS9("text",d.bMT(2,2,"BACK")),d.Y8G("defaultHref",F.backPage)}}function D(y,I){1&y&&(d.j41(0,"ion-menu-toggle",5)(1,"ion-button",7),d.nrm(2,"ion-icon",8),d.k0s()())}function b(y,I){if(1&y&&(d.j41(0,"ion-title"),d.EFF(1),d.nI1(2,"translate"),d.k0s()),2&y){const F=d.XpG();d.R7$(),d.SpI(" ",d.bMT(2,1,F.pageTitle)," ")}}let e=(()=>{var y;class I{constructor(x){this.router=x,this.backPage=""}navToMyAccount(){this.router.navigate(["my-account"])}}return(y=I).\u0275fac=function(x){return new(x||y)(d.rXU(k.Ix))},y.\u0275cmp=d.VBU({type:y,selectors:[["app-header"]],inputs:{pageTitle:"pageTitle",backPage:"backPage"},ngContentSelectors:E,decls:9,vars:3,consts:[["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end"],[3,"click"],["name","cog"],["slot","start"],[3,"defaultHref","text"],["size","small","fill","clear"],["name","menu"]],template:function(x,O){1&x&&(d.NAR(),d.j41(0,"ion-header")(1,"ion-toolbar"),d.DNE(2,P,3,4,"ion-buttons",0)(3,D,3,0,"ion-menu-toggle",0)(4,b,3,3,"ion-title",1),d.j41(5,"ion-buttons",2)(6,"ion-button",3),d.bIt("click",function(){return O.navToMyAccount()}),d.nrm(7,"ion-icon",4),d.k0s()()()(),d.SdG(8)),2&x&&(d.R7$(2),d.Y8G("ngIf",O.backPage),d.R7$(),d.Y8G("ngIf",!O.backPage),d.R7$(),d.Y8G("ngIf",!O.isLoadingUserInfo))},dependencies:[i.Jm,i.QW,i.eU,i.iq,i.cA,i.BC,i.ai,i.el,p.bT,m.D9]}),I})()},2952:(G,v,_)=>{_.d(v,{t:()=>m});var d=_(4438),k=_(4742),i=_(177);function p(E,P){if(1&E&&(d.j41(0,"p"),d.EFF(1),d.k0s()),2&E){const D=d.XpG();d.R7$(),d.JRh(D.text)}}let m=(()=>{var E;class P{constructor(){this.text=""}}return(E=P).\u0275fac=function(b){return new(b||E)},E.\u0275cmp=d.VBU({type:E,selectors:[["q-spinner"]],hostVars:2,hostBindings:function(b,e){2&b&&d.HbH(e.expand)},inputs:{text:"text",expand:"expand"},decls:5,vars:1,consts:[[1,"ion-no-padding","ion-no-margin"],[1,"ion-justify-content-center","ion-align-items-center"],[1,"ion-text-center"],[4,"ngIf"]],template:function(b,e){1&b&&(d.j41(0,"ion-grid",0)(1,"ion-row",1)(2,"ion-col",2),d.nrm(3,"ion-spinner"),d.DNE(4,p,2,1,"p",3),d.k0s()()()),2&b&&(d.R7$(4),d.Y8G("ngIf",e.text))},dependencies:[k.hU,k.lO,k.ln,k.w2,i.bT],styles:[".expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:100%}.expand[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{color:var(--quiculum-gray)}"]}),P})()},1876:(G,v,_)=>{_.d(v,{Y:()=>d});class d{constructor(i){this._selectedItems=[],this.equalityFunction=(p,m)=>p==m,i&&(this.equalityFunction=i)}get isAnySelected(){return this._selectedItems.length>0}get selectedItems(){return this._selectedItems}isSelected(i){return!!this.selectedItems.find(m=>this.equalityFunction(i,m))}clear(){this._selectedItems=[]}deselectItem(i){let m=this.selectedItems.findIndex(E=>this.equalityFunction(i,E));m>-1&&this.selectedItems.splice(m,1)}selectItem(i){this.isSelected(i)||this.selectedItems.push(i)}selectItems(i){i.forEach(p=>this.selectItem(p))}setSelectedItems(i){this._selectedItems=i}toggleItem(i){this.isSelected(i)?this.deselectItem(i):this.selectItem(i)}}},1106:(G,v,_)=>{_.d(v,{U:()=>k});var d=_(4438);let k=(()=>{var i;class p{onInput(E){this.resize()}constructor(E){this.element=E}ngOnInit(){setTimeout(()=>this.resize(),0),this.interval=setInterval(()=>this.resize(),2e3)}ngOnDestroy(){clearInterval(this.interval)}resize(){let E=this.element.nativeElement.getElementsByClassName("text-input")[0],P=0;E&&(P=E.scrollHeight,E.style.height=P+"px"),this.element.nativeElement.style.height=P+16+"px"}}return(i=p).\u0275fac=function(E){return new(E||i)(d.rXU(d.aKT))},i.\u0275dir=d.FsC({type:i,selectors:[["ion-textarea","autosize",""]],hostBindings:function(E,P){1&E&&d.bIt("input",function(b){return P.onInput(b.target)})}}),p})()},761:(G,v,_)=>{_.r(v),_.d(v,{PreschoolPageModule:()=>st});var d=_(177),k=_(9417),i=_(4742),p=_(9598),m=_(467),E=_(3207),P=_(6090),D=_(8330),b=_(5383),e=_(4438),y=_(1204),I=_(230),F=_(5151),x=_(9196),O=_(2342),W=_(6830),A=_(9813),u=_(4078),M=_(4416),C=_(3656);let f=(()=>{var o;class r{constructor(t,n){this.modalCtrl=t,this.navParams=n}ngOnInit(){this.calendar=this.navParams.data.calendar;const{numberOfDaysUntilChangeEnabled:t,numberOfDaysUntilChangeEnabledOnHolidays:n}=this.calendar;this.infoText=`Du f\xe5r inte \xe4ndra en tid som infaller tidigare \xe4n ${t?t+" dagar fr\xe5n":""} dagens datum, eller tidigare \xe4n ${n?n+" dagar fr\xe5n":""} dagar fr\xe5n datum om det \xe4r lov, eller d\xe5 skolan/f\xf6rskolan \xe4r st\xe4ngd.`}dismiss(){this.modalCtrl.dismiss()}}return(o=r).\u0275fac=function(t){return new(t||o)(e.rXU(i.W3),e.rXU(C.y8))},o.\u0275cmp=e.VBU({type:o,selectors:[["page-preschool-calendar-day-info"]],decls:18,vars:7,consts:[["color","altcolor8"],["slot","start"],["fill","clear",3,"click"],[1,"page-title"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.bIt("click",function(){return n.dismiss()}),e.j41(4,"span"),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()()(),e.j41(7,"ion-content")(8,"ion-grid")(9,"ion-row")(10,"ion-col")(11,"h3",3),e.EFF(12),e.nI1(13,"translate"),e.k0s()()(),e.j41(14,"ion-row")(15,"ion-col")(16,"ion-text"),e.EFF(17),e.k0s()()()()()),2&t&&(e.R7$(5),e.JRh(e.bMT(6,3,"CANCEL")),e.R7$(7),e.JRh(e.bMT(13,5,"INFORMATION")),e.R7$(5),e.SpI(" ",n.infoText," "))},dependencies:[i.Jm,i.QW,i.hU,i.W9,i.lO,i.eU,i.ln,i.IO,i.ai,I.D9],styles:["ion-label[_ngcontent-%COMP%]{color:#000!important}.page-title[_ngcontent-%COMP%]{text-transform:capitalize}"]}),r})();var g=_(7586),T=_(2952),L=_(7583),X=_(7143);function H(o,r){1&o&&e.nrm(0,"q-spinner")}function z(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-datetime",14),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG(3);return e.DH7(s.plannedStart,n)||(s.plannedStart=n),e.Njj(n)}),e.k0s()}if(2&o){const a=e.XpG(3);e.Y8G("min",a.frameDayStart)("max",a.plannedEnd),e.R50("ngModel",a.plannedStart)}}function K(o,r){if(1&o&&(e.j41(0,"ion-col",5)(1,"ion-item",7)(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-input",12),e.nI1(6,"qTime"),e.j41(7,"ion-popover",13),e.DNE(8,z,1,3,"ng-template"),e.k0s()()()),2&o){const a=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,2,"PRESCHOOL_CHECK_IN")),e.R7$(2),e.Y8G("value",e.bMT(6,4,a.plannedStart))}}function J(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-datetime",17),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG(3);return e.DH7(s.plannedEnd,n)||(s.plannedEnd=n),e.Njj(n)}),e.k0s()}if(2&o){const a=e.XpG(3);e.Y8G("min",a.plannedStart)("max",a.frameDayEnd),e.R50("ngModel",a.plannedEnd)}}function Q(o,r){if(1&o&&(e.j41(0,"ion-col",5)(1,"ion-item",7)(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-input",15),e.nI1(6,"qTime"),e.j41(7,"ion-popover",16),e.DNE(8,J,1,3,"ng-template"),e.k0s()()()),2&o){const a=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,2,"PRESCHOOL_CHECK_OUT")),e.R7$(2),e.Y8G("value",e.bMT(6,4,a.plannedEnd))}}function Z(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",5)(3,"h3",6),e.EFF(4),e.nI1(5,"qDayAndDate"),e.k0s()(),e.j41(6,"ion-col",5)(7,"ion-item",7)(8,"ion-label"),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"ion-toggle",8),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG();return e.DH7(s.absence,n)||(s.absence=n),e.Njj(n)}),e.k0s()()(),e.DNE(12,K,9,6,"ion-col",9)(13,Q,9,6,"ion-col",9),e.j41(14,"ion-col",5)(15,"ion-item",7)(16,"ion-label",10),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"ion-textarea",11),e.nI1(20,"translate"),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG();return e.DH7(s.note,n)||(s.note=n),e.Njj(n)}),e.k0s()()()()()}if(2&o){const a=e.XpG();e.R7$(4),e.JRh(e.bMT(5,8,a.attendance.date)),e.R7$(5),e.JRh(e.bMT(10,10,"PRESCHOOL_ABSENCE")),e.R7$(2),e.R50("ngModel",a.absence),e.R7$(),e.Y8G("ngIf",!a.absence),e.R7$(),e.Y8G("ngIf",!a.absence),e.R7$(4),e.SpI(" ",e.bMT(18,12,"PRESCHOOL_ATTENDANCE_NOTE")," "),e.R7$(2),e.FS9("placeholder",e.bMT(20,14,"WRITE_YOUR_MESSAGE_HERE")),e.R50("ngModel",a.note)}}let q=(()=>{var o;class r extends P.v{constructor(t,n,s,l,h,c,S,R,j){super(t,n,s,h,c,S),this.navParams=l,this.modalCtrl=R,this.dateService=j,this.isInitialized=!1,g.locale("sv"),this.today=g().format("L")}ngOnInit(){this.attendance=this.navParams.data.attendance,this.calendarFrame=this.navParams.data.calendarFrame,this.setFrameDay()}ionViewWillEnter(){this.initializeForm()}setFrameDay(){if(this.attendance&&this.calendarFrame){let t=this.dateService.getQDayOfWeek(this.attendance.date);const{start:n,end:s}=this.calendarFrame.calendarFrameDays.find(l=>l.weekDay==t);this.start=n,this.end=s,this.frameDayStart=this.start?this.datetimeParser(this.today,n):"",this.frameDayEnd=this.start?this.datetimeParser(this.today,s):""}}save(){let t={plannedStart:g(this.plannedStart).format("LT"),plannedEnd:g(this.plannedEnd).format("LT"),note:this.note,absence:this.absence},n=Object.assign({},this.attendance,t);this.modalCtrl.dismiss(n)}toggleAbsence(){this.absence=!this.absence}initializeForm(){if(!this.attendance)return;const t=this.datetimeParser(this.today,this.attendance.plannedStart),n=this.datetimeParser(this.today,this.attendance.plannedEnd),s=g(this.frameDayStart),l=g(this.frameDayEnd),h=g(t),c=g(n);this.plannedStart=s.isAfter(h)?this.frameDayStart:t,this.plannedEnd=c.isBefore(l)&&c.isAfter(g(this.plannedStart))?n:this.frameDayEnd,this.note=this.attendance.note,this.absence=this.attendance.absence,this.isInitialized=!0}dismiss(){this.modalCtrl.dismiss()}datetimeParser(t,n){return g(t+" "+n,"L LT").local().format()}}return(o=r).\u0275fac=function(t){return new(t||o)(e.rXU(y.$),e.rXU(p.Ix),e.rXU(i.Xi),e.rXU(C.y8),e.rXU(I.c$),e.rXU(F.p),e.rXU(x.Z),e.rXU(i.W3),e.rXU(u.k))},o.\u0275cmp=e.VBU({type:o,selectors:[["page-preschool-calendar-day-editor"]],features:[e.Vt3],decls:16,vars:9,consts:[["slot","start"],["fill","clear",3,"click"],["slot","end"],["fill","clear","color","action",3,"click"],[4,"ngIf"],["size","12"],[1,"page-title"],["lines","none",1,"ion-no-padding"],["color","action",3,"ngModelChange","ngModel"],["size","12",4,"ngIf"],["position","stacked"],["autosize","","autocapitalize","on",3,"ngModelChange","placeholder","ngModel"],["slot","end","id","startPicker","inputmode","none",1,"ion-text-end","ion-no-padding","ion-no-margin",3,"value"],["trigger","startPicker"],["presentation","time","displayFormat","HH:mm","inputmode","none",3,"ngModelChange","min","max","ngModel"],["slot","end","id","endPicker","inputmode","none",1,"ion-text-end","ion-no-padding","ion-no-margin",3,"value"],["trigger","endPicker"],["inputmode","none","presentation","time","displayFormat","HH:mm",3,"ngModelChange","min","max","ngModel"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return n.dismiss()}),e.j41(4,"span"),e.EFF(5),e.nI1(6,"translate"),e.k0s()()(),e.j41(7,"ion-title"),e.EFF(8),e.k0s(),e.j41(9,"ion-buttons",2)(10,"ion-button",3),e.bIt("click",function(){return n.save()}),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"ion-content"),e.DNE(14,H,1,0,"q-spinner",4)(15,Z,21,16,"ion-grid",4),e.k0s()),2&t&&(e.R7$(5),e.JRh(e.bMT(6,5,"CANCEL")),e.R7$(3),e.JRh(n.titleText),e.R7$(3),e.SpI(" ",e.bMT(12,7,"SAVE")," "),e.R7$(3),e.Y8G("ngIf",!n.isInitialized),e.R7$(),e.Y8G("ngIf",n.isInitialized))},dependencies:[d.bT,k.BC,k.vS,i.Jm,i.QW,i.hU,i.W9,i.A9,i.lO,i.eU,i.$w,i.uz,i.he,i.ln,i.nc,i.BC,i.BY,i.ai,i.CF,i.hB,i.Je,i.Gw,T.t,I.D9,L.K,X.k],styles:["ion-label[_ngcontent-%COMP%]{color:#000!important}.page-title[_ngcontent-%COMP%]{text-transform:capitalize}"]}),r})();function ee(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-datetime",13),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG(2);return e.DH7(s.plannedStart,n)||(s.plannedStart=n),e.Njj(n)}),e.k0s()}if(2&o){const a=e.XpG(2);e.R50("ngModel",a.plannedStart)}}function te(o,r){if(1&o&&(e.j41(0,"ion-col",4)(1,"ion-item",6)(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-input",11),e.nI1(6,"qTime"),e.j41(7,"ion-popover",12),e.DNE(8,ee,1,1,"ng-template"),e.k0s()()()),2&o){const a=e.XpG();e.R7$(3),e.JRh(e.bMT(4,2,"PRESCHOOL_CHECK_IN")),e.R7$(2),e.Y8G("value",e.bMT(6,4,a.plannedStart))}}function ne(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-datetime",13),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG(2);return e.DH7(s.plannedEnd,n)||(s.plannedEnd=n),e.Njj(n)}),e.k0s()}if(2&o){const a=e.XpG(2);e.R50("ngModel",a.plannedEnd)}}function ie(o,r){if(1&o&&(e.j41(0,"ion-col",4)(1,"ion-item",6)(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-input",14),e.nI1(6,"qTime"),e.j41(7,"ion-popover",15),e.DNE(8,ne,1,1,"ng-template"),e.k0s()()()),2&o){const a=e.XpG();e.R7$(3),e.JRh(e.bMT(4,2,"PRESCHOOL_CHECK_OUT")),e.R7$(2),e.Y8G("value",e.bMT(6,4,a.plannedEnd))}}let ae=(()=>{var o;class r{constructor(t,n){this.navParams=t,this.modalCtrl=n,this.attendanceRecords=[],this.absence=!1,g.locale("sv"),this.today=g().format("L")}ngOnInit(){this.attendanceRecords=this.navParams.data.attendanceRecords,console.log("attendanceRecords:",this.attendanceRecords),this.initializeForm()}initializeForm(){if(this.attendanceRecords.length>0){if(this.attendance=this.attendanceRecords[0],!this.attendance)return;const t=this.datetimeParser(this.today,this.attendance.plannedStart),n=this.datetimeParser(this.today,this.attendance.plannedEnd);this.plannedStart=t,this.plannedEnd=n,this.note=this.attendance.note,this.absence=this.attendance.absence}}save(){const t={plannedStart:g(this.plannedStart).format("LT"),plannedEnd:g(this.plannedEnd).format("LT"),note:this.note,absence:this.absence};this.attendanceRecords.forEach(n=>{n.plannedStart=t.plannedStart,n.plannedEnd=t.plannedEnd,n.note=t.note,n.absence=t.absence}),this.modalCtrl.dismiss(this.attendanceRecords)}dismiss(){this.modalCtrl.dismiss()}datetimeParser(t,n){return g(t+" "+n,"L LT").local().format()}}return(o=r).\u0275fac=function(t){return new(t||o)(e.rXU(C.y8),e.rXU(i.W3))},o.\u0275cmp=e.VBU({type:o,selectors:[["page-preschool-calendar-multi-editor"]],decls:33,vars:20,consts:[["slot","start"],["fill","clear",3,"click"],["slot","end"],["fill","clear","color","action",3,"click"],["size","12"],[1,"page-title"],["lines","none",1,"ion-no-padding"],["color","action",3,"ngModelChange","ngModel"],["size","12",4,"ngIf"],["position","stacked"],["autosize","","autocapitalize","on",3,"ngModelChange","placeholder","ngModel"],["slot","end","id","startPicker","inputmode","none",1,"ion-text-end","ion-no-padding","ion-no-margin",3,"value"],["trigger","startPicker"],["presentation","time","displayFormat","HH:mm","inputmode","none",3,"ngModelChange","ngModel"],["slot","end","id","endPicker","inputmode","none",1,"ion-text-end","ion-no-padding","ion-no-margin",3,"value"],["trigger","endPicker"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return n.dismiss()}),e.j41(4,"span"),e.EFF(5),e.nI1(6,"translate"),e.k0s()()(),e.nrm(7,"ion-title"),e.j41(8,"ion-buttons",2)(9,"ion-button",3),e.bIt("click",function(){return n.save()}),e.EFF(10),e.nI1(11,"translate"),e.k0s()()()(),e.j41(12,"ion-content")(13,"ion-grid")(14,"ion-row")(15,"ion-col",4)(16,"h3",5),e.EFF(17),e.k0s()(),e.j41(18,"ion-col",4)(19,"ion-item",6)(20,"ion-label"),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.j41(23,"ion-toggle",7),e.mxI("ngModelChange",function(l){return e.DH7(n.absence,l)||(n.absence=l),l}),e.k0s()()(),e.DNE(24,te,9,6,"ion-col",8)(25,ie,9,6,"ion-col",8),e.j41(26,"ion-col",4)(27,"ion-item",6)(28,"ion-label",9),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"ion-textarea",10),e.nI1(32,"translate"),e.mxI("ngModelChange",function(l){return e.DH7(n.note,l)||(n.note=l),l}),e.k0s()()()()()()),2&t&&(e.R7$(5),e.JRh(e.bMT(6,10,"CANCEL")),e.R7$(5),e.SpI(" ",e.bMT(11,12,"SAVE")," "),e.R7$(7),e.SpI(" ",1===n.attendanceRecords.length?"Redigerar 1 dag":"Redigerar "+n.attendanceRecords.length+" dagar"," "),e.R7$(4),e.JRh(e.bMT(22,14,"PRESCHOOL_ABSENCE")),e.R7$(2),e.R50("ngModel",n.absence),e.R7$(),e.Y8G("ngIf",!n.absence),e.R7$(),e.Y8G("ngIf",!n.absence),e.R7$(4),e.SpI(" ",e.bMT(30,16,"PRESCHOOL_ATTENDANCE_NOTE")," "),e.R7$(2),e.FS9("placeholder",e.bMT(32,18,"WRITE_YOUR_MESSAGE_HERE")),e.R50("ngModel",n.note))},dependencies:[d.bT,k.BC,k.vS,i.Jm,i.QW,i.hU,i.W9,i.A9,i.lO,i.eU,i.$w,i.uz,i.he,i.ln,i.nc,i.BC,i.BY,i.ai,i.CF,i.hB,i.Je,i.Gw,I.D9,X.k],styles:["ion-label[_ngcontent-%COMP%]{color:#000!important}.page-title[_ngcontent-%COMP%]{text-transform:capitalize}"]}),r})();var $=_(60),oe=_(4173);const se=["scroll"];function le(o,r){if(1&o&&(e.j41(0,"ion-list-header",20)(1,"ion-label"),e.EFF(2),e.k0s()()),2&o){const a=e.XpG().$implicit;e.R7$(2),e.Lme(" ",a.month," ",a.year," ")}}function re(o,r){if(1&o){const a=e.RV6();e.j41(0,"div")(1,"ion-checkbox",24),e.bIt("ionChange",function(){e.eBV(a);const n=e.XpG(2).$implicit,s=e.XpG(2);return e.Njj(s.toggleMonthSelection(n.month,n.year))}),e.EFF(2," \xa0 "),e.j41(3,"span",25),e.EFF(4,"V\xe4lj m\xe5nad"),e.k0s()()()}if(2&o){const a=e.XpG(2).$implicit,t=e.XpG(2);e.R7$(),e.Y8G("checked",t.selectedMonths.has(a.year+"-"+a.month))}}function ce(o,r){if(1&o&&(e.j41(0,"ion-item",21)(1,"div",22),e.DNE(2,re,5,1,"div",23),e.k0s()()),2&o){const a=e.XpG().$implicit,t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",a.firstDayInMonth&&t._enableChooseMore)}}function de(o,r){if(1&o){const a=e.RV6();e.j41(0,"div")(1,"ion-checkbox",29),e.bIt("ionChange",function(){e.eBV(a);const n=e.XpG(2).$implicit,s=e.XpG(2);return e.Njj(s.toggleWeekSelection(n.weekNumber))}),e.EFF(2,"\xa0 "),e.j41(3,"span",25),e.EFF(4,"V\xe4lj vecka"),e.k0s()()()}if(2&o){const a=e.XpG(2).$implicit,t=e.XpG(2);e.R7$(),e.Y8G("checked",t.selectedWeeks.has(a.weekNumber))}}function _e(o,r){if(1&o&&(e.j41(0,"div",30),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o){const a=e.XpG(2).$implicit;e.R7$(),e.Lme(" ",e.bMT(2,2,"WEEK_SHORT")," ",a.weekNumber," ")}}function he(o,r){if(1&o&&(e.j41(0,"ion-item",26)(1,"div",22),e.DNE(2,de,5,1,"div",23),e.k0s(),e.j41(3,"div",27),e.DNE(4,_e,3,4,"div",28),e.k0s()()),2&o){const a=e.XpG().$implicit,t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.isFirstDayInWeek(a,t.days)&&!t.isSaving(a)&&!a.closed&&!a.isPassed&&t._enableChooseMore),e.R7$(2),e.Y8G("ngIf",t.isFirstDayInWeek(a,t.days))}}function me(o,r){if(1&o&&(e.j41(0,"span",31),e.EFF(1),e.k0s()),2&o){const a=e.XpG().$implicit;e.R7$(),e.Lme(" ",a.attendance.plannedStart," - ",a.attendance.plannedEnd," ")}}function ge(o,r){1&o&&(e.j41(0,"ion-badge",32),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"PRESCHOOL_ABSENCE")," "))}function pe(o,r){if(1&o){const a=e.RV6();e.j41(0,"fa-icon",33),e.bIt("click",function(){e.eBV(a);const n=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.editDay(n))}),e.k0s()}if(2&o){const a=e.XpG(3);e.Y8G("icon",a.faEdit)("fixedWidth",!0)}}function ue(o,r){if(1&o){const a=e.RV6();e.j41(0,"fa-icon",34),e.bIt("click",function(){e.eBV(a);const n=e.XpG(3);return e.Njj(n.openInfo())}),e.k0s()}if(2&o){const a=e.XpG(3);e.Y8G("icon",a.faInfo)("fixedWidth",!0)}}function fe(o,r){if(1&o&&e.nrm(0,"fa-icon",35),2&o){const a=e.XpG(3);e.Y8G("icon",a.faSpinner)("spin",!0)("fixedWidth",!0)}}function Ce(o,r){if(1&o){const a=e.RV6();e.j41(0,"div",36)(1,"ion-checkbox",37),e.bIt("ionChange",function(){e.eBV(a);const n=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.toggleDaySelection(n))}),e.k0s()()}if(2&o){const a=e.XpG().$implicit,t=e.XpG(2);e.R7$(),e.Y8G("checked",t.selectedDays.has(a))}}function Ee(o,r){if(1&o&&(e.j41(0,"ion-col",38)(1,"div",39),e.EFF(2),e.k0s()()),2&o){const a=e.XpG().$implicit;e.R7$(2),e.JRh(a.attendance.note)}}function ke(o,r){1&o&&(e.j41(0,"ion-badge",42),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"PRESCHOOL_HOLLIDAY")," "))}function Pe(o,r){1&o&&(e.j41(0,"ion-badge",43),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"PRESCHOOL_CLOSED")," "))}function Se(o,r){if(1&o&&(e.j41(0,"ion-col",38),e.DNE(1,ke,3,3,"ion-badge",40)(2,Pe,3,3,"ion-badge",41),e.k0s()),2&o){const a=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",a.holliday),e.R7$(),e.Y8G("ngIf",a.closed)}}function Ie(o,r){if(1&o&&(e.qex(0),e.DNE(1,le,3,2,"ion-list-header",3)(2,ce,3,1,"ion-item",4)(3,he,5,2,"ion-item",5),e.j41(4,"ion-item",6),e.nI1(5,"qDate"),e.j41(6,"div",7),e.EFF(7),e.k0s(),e.j41(8,"ion-label")(9,"ion-grid",1)(10,"ion-row",8)(11,"ion-col",9)(12,"span",10),e.EFF(13),e.k0s()(),e.j41(14,"ion-col",11)(15,"div",12),e.DNE(16,me,2,2,"span",13)(17,ge,3,3,"ion-badge",14)(18,pe,1,2,"fa-icon",15)(19,ue,1,2,"fa-icon",16)(20,fe,1,3,"fa-icon",17)(21,Ce,2,1,"div",18),e.k0s()()(),e.j41(22,"ion-row",1),e.DNE(23,Ee,3,1,"ion-col",19)(24,Se,3,2,"ion-col",19),e.k0s()()()(),e.bVm()),2&o){const a=r.$implicit,t=e.XpG(2);e.R7$(),e.Y8G("ngIf",a.firstDayInMonth),e.R7$(),e.Y8G("ngIf",a.firstDayInMonth),e.R7$(),e.Y8G("ngIf",t.isFirstDayInWeek(a,t.days)),e.R7$(),e.AVh("passed",a.isPassed),e.FS9("id",e.bMT(5,16,a.attendance.date)),e.R7$(3),e.SpI(" ",a.dayOfMonth," "),e.R7$(6),e.JRh(a.weekday),e.R7$(3),e.Y8G("ngIf",!a.attendance.absence&&!a.closed),e.R7$(),e.Y8G("ngIf",a.attendance.absence),e.R7$(),e.Y8G("ngIf",a.editable&&!t.isSaving(a)&&!a.closed&&!t._enableChooseMore),e.R7$(),e.Y8G("ngIf",!(a.editable&&!t.isSaving(a)||a.isPassed)),e.R7$(),e.Y8G("ngIf",t.isSaving(a)),e.R7$(),e.Y8G("ngIf",a.editable&&!t.isSaving(a)&&!a.isPassed&&!a.closed&&t._enableChooseMore),e.R7$(2),e.Y8G("ngIf",null==a.attendance?null:a.attendance.note),e.R7$(),e.Y8G("ngIf",a.holliday||a.closed)}}function be(o,r){if(1&o&&(e.j41(0,"ion-list",1),e.DNE(1,Ie,25,18,"ng-container",2),e.k0s()),2&o){const a=e.XpG();e.R7$(),e.Y8G("ngForOf",a.days)}}let ye=(()=>{var o;class r{set enableChooseMore(t){this._enableChooseMore=t,this.onEnableChooseMoreChange(t)}get enableChooseMore(){return this._enableChooseMore}onEnableChooseMoreChange(t){this.selectedDays.clear(),this.selectedWeeks.clear(),this.selectedMonths.clear(),console.log("enableChooseMore har \xe4ndrats till:",t)}onsaveMultipleChange(t){if(this.selectedDays.size>0){const n=[];this.selectedDays.forEach(s=>{n.push(s.attendance)}),this.openMultiEditor(n)}else this.userAlertService.info(this.translations.ERROR_NOT_SELECTED,"top")}constructor(t,n,s,l,h,c){this.dateService=t,this.calendarService=n,this.attendanceService=s,this.modalCtrl=l,this.translateService=h,this.userAlertService=c,this.initialized=new e.bkB,this.isInitialized=!1,this.days=[],this.daySaving=null,this.faEdit=b.MT7,this.faSpinner=b.z1G,this.faInfo=b.iW_,this.selectedDays=new Set,this.selectedWeeks=new Set,this.selectedMonths=new Set,this.initializeTranslations()}initializeTranslations(){var t=this;return(0,m.A)(function*(){t.translations=yield(0,E.s)(t.translateService.get(["ERROR_NOT_SELECTED"]))})()}ngOnChanges(){this.calendar&&this.calendarFrame&&this.child&&this.attendances&&this.initializeComponent()}editDay(t){var n=this;return(0,m.A)(function*(){let s={calendarFrame:n.calendarFrame,attendance:t.attendance},l=yield n.modalCtrl.create({component:q,componentProps:s});l.present(),l.onDidDismiss().then(function(){var h=(0,m.A)(function*(c){if(c&&c.data){n.daySaving=t,yield n.attendanceService.updateAttendance(c.data);let S=n.days.find(R=>R.attendance.id==c.data.id);S.attendance.plannedStart=c.data.plannedStart,S.attendance.plannedEnd=c.data.plannedEnd,S.attendance.note=c.data.note,S.attendance.absence=c.data.absence,n.daySaving=null}});return function(c){return h.apply(this,arguments)}}())})()}openInfo(){var t=this;return(0,m.A)(function*(){let n={calendar:t.calendar},s=yield t.modalCtrl.create({component:f,componentProps:n});s.present(),s.onDidDismiss().then(function(){var l=(0,m.A)(function*(h){});return function(h){return l.apply(this,arguments)}}())})()}isMonday(t){return 1==t.dayOfWeek}isFirstDayInWeek(t,n){const s=n.find(l=>l.weekNumber===t.weekNumber);return(null==s?void 0:s.dayOfMonth)===t.dayOfMonth}isSaving(t){return this.daySaving==t}initializeComponent(){var t=this;return(0,m.A)(function*(){t.frame=yield t.calendarService.getCalendarFrame(t.child.calendarFrameId),t.days=t.buildDays(),t.isInitialized=!0,t.initialized.emit()})()}buildDays(){let t=this.dateService.addDays(this.dateService.today(),this.calendar.numberOfDaysUntilChangeEnabled),n=this.dateService.addDays(this.dateService.today(),this.calendar.numberOfDaysUntilChangeEnabledOnHolidays),s=[];for(let l=0;l<this.calendar.days.length;l++){let h=this.calendar.days[l],c=h.holliday?!this.dateService.isBefore(h.date,n):!this.dateService.isBefore(h.date,t),S=0==l||s.length&&!this.dateService.isSameMonth(s[s.length-1].attendance.date,h.date),R=this.buildDayViewModel(h,c,S);R&&s.push(R)}return s}buildDayViewModel(t,n,s){let l=this.attendances.find(h=>this.dateService.isSameDay(h.date,t.date));return l?{calendarDay:t,attendance:l,month:this.dateService.formatMonthLong(l.date),weekNumber:this.dateService.getIsoWeek(l.date),year:this.dateService.getYear(t.date),dayOfMonth:this.dateService.dayOfMonth(l.date),dayOfWeek:this.dateService.getIsoDayOfWeek(l.date),weekday:this.dateService.formatWeekDayLong(l.date),start:l.plannedStart,end:l.plannedEnd,note:l.note,absence:l.absence,holliday:t.holliday,closed:t.closed,editable:n,firstDayInMonth:s,isPassed:this.dateService.isBeforeToday(l.date)}:null}toggleDaySelection(t){t.isPassed||t.closed||(this.selectedDays.has(t)?(this.selectedDays.delete(t),this.updateWeekAndMonthSelection(t)):(this.selectedDays.add(t),this.selectWeekAndMonthIfAllDaysSelected(t)))}toggleWeekSelection(t){const n=this.days.filter(s=>s.weekNumber===t&&!s.isPassed&&!s.closed);this.selectedWeeks.has(t)?(this.selectedWeeks.delete(t),n.forEach(s=>this.selectedDays.delete(s)),this.updateMonthSelectionBasedOnWeek(n[0].month,n[0].year)):(this.selectedWeeks.add(t),n.forEach(s=>this.selectedDays.add(s)),this.updateMonthSelectionBasedOnWeek(n[0].month,n[0].year))}toggleMonthSelection(t,n){const s=this.days.filter(h=>h.month===t&&h.year===n&&!h.isPassed&&!h.closed),l=`${n}-${t}`;this.selectedMonths.has(l)?(this.selectedMonths.delete(l),s.forEach(h=>{this.selectedDays.delete(h),this.selectedWeeks.delete(h.weekNumber)})):(this.selectedMonths.add(l),s.forEach(h=>{this.selectedDays.add(h),this.selectedWeeks.add(h.weekNumber)}))}updateWeekAndMonthSelection(t){this.days.filter(c=>c.weekNumber===t.weekNumber&&!c.isPassed&&!c.closed).every(c=>this.selectedDays.has(c))||this.selectedWeeks.delete(t.weekNumber),this.days.filter(c=>c.month===t.month&&c.year===t.year&&!c.isPassed&&!c.closed).every(c=>this.selectedWeeks.has(c.weekNumber))||this.selectedMonths.delete(`${t.year}-${t.month}`)}selectWeekAndMonthIfAllDaysSelected(t){this.days.filter(c=>c.weekNumber===t.weekNumber&&!c.isPassed&&!c.closed).every(c=>this.selectedDays.has(c))&&this.selectedWeeks.add(t.weekNumber),this.days.filter(c=>c.month===t.month&&c.year===t.year&&!c.isPassed&&!c.closed).every(c=>this.selectedWeeks.has(c.weekNumber))&&this.selectedMonths.add(`${t.year}-${t.month}`)}updateMonthSelectionBasedOnWeek(t,n){const l=this.days.filter(c=>c.month===t&&c.year===n&&!c.isPassed&&!c.closed).every(c=>this.selectedWeeks.has(c.weekNumber)),h=`${n}-${t}`;l?this.selectedMonths.add(h):this.selectedMonths.delete(h)}openMultiEditor(t){var n=this;return(0,m.A)(function*(){console.log(t);let s=yield n.modalCtrl.create({component:ae,componentProps:{attendanceRecords:t}});s.present(),s.onDidDismiss().then(function(){var l=(0,m.A)(function*(h){if(h.data){for(let c of h.data){yield n.attendanceService.updateAttendance(c);let S=n.days.find(R=>R.attendance.id==c.id);S&&(S.attendance.plannedStart=c.plannedStart,S.attendance.plannedEnd=c.plannedEnd,S.attendance.note=c.note,S.attendance.absence=c.absence)}n.daySaving=null,n.selectedDays=new Set,n.selectedWeeks=new Set,n.selectedMonths=new Set}});return function(h){return l.apply(this,arguments)}}())})()}}return(o=r).\u0275fac=function(t){return new(t||o)(e.rXU(u.k),e.rXU(O.X),e.rXU(A.Q),e.rXU(i.W3),e.rXU(I.c$),e.rXU(F.p))},o.\u0275cmp=e.VBU({type:o,selectors:[["preschool-calendar"]],viewQuery:function(t,n){if(1&t&&e.GBs(se,5),2&t){let s;e.mGM(s=e.lsd())&&(n.scroll=s.first)}},inputs:{calendar:"calendar",calendarFrame:"calendarFrame",child:"child",attendances:"attendances",enableChooseMore:"enableChooseMore"},outputs:{initialized:"initialized"},features:[e.OA$],decls:1,vars:1,consts:[["class","ion-no-padding",4,"ngIf"],[1,"ion-no-padding"],[4,"ngFor","ngForOf"],["lines","none","class","ion-padding-top",4,"ngIf"],["lines","none",4,"ngIf"],["class","week-header","lines","none",4,"ngIf"],[1,"ion-no-padding",3,"id"],["slot","start",1,"day-of-month","ion-text-center"],[1,""],["size","4"],[1,"weekday"],["size","8",1,"centerBadge"],[2,"display","flex"],["class","time",4,"ngIf"],["color","info",4,"ngIf"],[3,"icon","fixedWidth","click",4,"ngIf"],["class","infoIcon",3,"icon","fixedWidth","click",4,"ngIf"],[3,"icon","spin","fixedWidth",4,"ngIf"],["style","display: flex; margin-left: 10px; margin-top: -12px;",4,"ngIf"],["size","12","class","ion-padding-top",4,"ngIf"],["lines","none",1,"ion-padding-top"],["lines","none"],["slot","start",1,"cheakbox-item","ion-text-center"],[4,"ngIf"],["labelPlacement","end",1,"week-number",3,"ionChange","checked"],[2,"font-weight","bold"],["lines","none",1,"week-header"],["slot","end",1,"week-number"],["class","ion-text-right",4,"ngIf"],["labelPlacement","end",1,"week-numbe",3,"ionChange","checked"],[1,"ion-text-right"],[1,"time"],["color","info"],[3,"click","icon","fixedWidth"],[1,"infoIcon",3,"click","icon","fixedWidth"],[3,"icon","spin","fixedWidth"],[2,"display","flex","margin-left","10px","margin-top","-12px"],[3,"ionChange","checked"],["size","12",1,"ion-padding-top"],[1,"note"],["color","primary",4,"ngIf"],["color","danger",4,"ngIf"],["color","primary"],["color","danger"]],template:function(t,n){1&t&&e.DNE(0,be,2,1,"ion-list",0),2&t&&e.Y8G("ngIf",n.isInitialized)},dependencies:[i.In,i.eY,i.hU,i.lO,i.uz,i.he,i.nf,i.AF,i.ln,i.hB,d.Sq,d.bT,$.aY,oe.v,I.D9],styles:["[slot=start].day-of-month[_ngcontent-%COMP%]{width:1.75em}[slot=end].week-number[_ngcontent-%COMP%]{width:30px;font-size:.8em;margin-right:10px}.weekday[_ngcontent-%COMP%]{text-transform:capitalize}.cheakbox-item[_ngcontent-%COMP%]{margin-left:1.75rem}.closed[_ngcontent-%COMP%]{color:var(--danger)}.note[_ngcontent-%COMP%]{font-size:.9em;font-style:italic}.passed[_ngcontent-%COMP%]{--background: var(--disabled)}.centerBadge[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-end}.centerBadge[_ngcontent-%COMP%]   fa-icon[_ngcontent-%COMP%]{margin-left:6px}fa-icon.infoIcon[_ngcontent-%COMP%]{color:var(--color8)}"]}),r})();var B=_(7376);function Te(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-button",1),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.dismiss())}),e.j41(1,"ion-label"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()}2&o&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"DONE")," "))}function Me(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-toolbar")(1,"ion-grid")(2,"ion-row")(3,"ion-col")(4,"ion-button",5),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.autoSelect("All"))}),e.EFF(5),e.nI1(6,"translate"),e.k0s()(),e.j41(7,"ion-col")(8,"ion-button",5),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.autoSelect("Even"))}),e.EFF(9),e.nI1(10,"translate"),e.k0s()(),e.j41(11,"ion-col")(12,"ion-button",5),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.autoSelect("Odd"))}),e.EFF(13),e.nI1(14,"translate"),e.k0s()(),e.j41(15,"ion-col")(16,"ion-button",5),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.autoSelect("Custom"))}),e.EFF(17),e.nI1(18,"translate"),e.k0s()()()()()}2&o&&(e.R7$(5),e.SpI(" ",e.bMT(6,4,"All")," "),e.R7$(4),e.SpI(" ",e.bMT(10,6,"Even")," "),e.R7$(4),e.SpI(" ",e.bMT(14,8,"Odd")," "),e.R7$(4),e.SpI(" ",e.bMT(18,10,"WEEKS_PICKER_AUTO_SELECT_NONE")," "))}function ve(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-col",12)(1,"div",13),e.bIt("click",function(){const n=e.eBV(a).$implicit,s=e.XpG(3);return e.Njj(s.onClickItem(n))}),e.EFF(2),e.k0s()()}if(2&o){const a=r.$implicit;e.R7$(),e.AVh("selected",a.selected),e.R7$(),e.SpI(" ",a.weekNumber," ")}}function Re(o,r){if(1&o&&(e.qex(0),e.j41(1,"h3",9),e.EFF(2),e.k0s(),e.j41(3,"ion-grid",10)(4,"ion-row"),e.DNE(5,ve,3,3,"ion-col",11),e.k0s()(),e.bVm()),2&o){const a=r.$implicit;e.R7$(2),e.JRh(a.year),e.R7$(3),e.Y8G("ngForOf",a.weeks)}}function De(o,r){if(1&o){const a=e.RV6();e.qex(0),e.DNE(1,Re,6,2,"ng-container",6),e.j41(2,"div",7)(3,"ion-button",8),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.dismiss())}),e.EFF(4),e.k0s()(),e.bVm()}if(2&o){const a=e.XpG();e.R7$(),e.Y8G("ngForOf",a.weeksByYear),e.R7$(3),e.JRh(a.nextButtonLabel)}}let Fe=(()=>{var o;class r{constructor(t,n,s,l){this.modalCtrl=t,this.navParams=n,this.translate=s,this.dateService=l,this.isInitialized=!1,this.weeksByYear=[],this.autoSelected="Custom"}ionViewWillEnter(){var t=this;return(0,m.A)(function*(){yield t.initLang(),t.initView()})()}onClickItem(t){t.selected=!t.selected,this.isMultiSelect||this.dismiss()}autoSelect(t){if("Custom"!=t){if(this.autoSelected==t)return this.autoSelected="Custom",void this.deselectAll();switch(t){case"All":this.selectAll();break;case"Even":this.selectEven();break;case"Odd":this.selectOdd()}}else this.deselectAll()}deselectAll(){this.weeks.forEach(t=>t.selected=!1)}selectAll(){this.weeks.forEach(t=>t.selected=!0)}selectEven(){this.weeks.forEach(t=>t.selected=this.dateService.getIsoWeek(t.date)%2==0)}selectOdd(){this.weeks.forEach(t=>t.selected=this.dateService.getIsoWeek(t.date)%2==1)}getSelectedItems(){return this.weeks.filter(t=>t.selected)}dismiss(){let t=this.getSelectedItems().map(n=>n.date);0===t.length?this.modalCtrl.dismiss():this.modalCtrl.dismiss(this.isMultiSelect?{items:t}:{item:t[0]})}initLang(){this.translate.setDefaultLang("sv");const t=this.translate.getBrowserLang();t&&t.startsWith("en")?this.translate.use("en"):this.translate.use("sv"),this.translate.get(["NEXT_STEP","SELECTABLE_OPTIONS_MISSING","WEEK_SHORT","WEEKS_PICKER_TITLE_SINGLE","WEEKS_PICKER_TITLE_MULTI"]).subscribe(s=>{this.translations=s})}initView(){let t=this.navParams.data.startDate||this.dateService.today(),n=this.navParams.data.endDate||this.dateService.addMonths(t,12);this.isMultiSelect=!!this.navParams.data.multi,this.hideNextButton=!!this.navParams.data.hideNextButton,this.nextButtonLabel=this.navParams.data.nextButtonLabel||this.translations.NEXT_STEP,this.title=this.navParams.data.title||(this.isMultiSelect?this.translations.WEEKS_PICKER_TITLE_MULTI:this.translations.WEEKS_PICKER_TITLE_SINGLE),this.weeks=this.buildWeekViewModels(t,n),this.weeksByYear=this.groupByYear(this.weeks),this.isEmpty=0==this.weeks.length,this.isInitialized=!0}buildWeekViewModels(t,n){let s=[],l=this.dateService.startOfWeek(t);for(;this.dateService.isBefore(l,n);)s.push(l),l=this.dateService.addDays(l,7);return s.map(h=>{let c=h.getFullYear();return{date:h,year:c,weekNumber:this.dateService.getIsoWeek(h),selected:!1}})}groupByYear(t){let n=(0,B.groupBy)(t,"year");return(0,B.map)(n,(s,l)=>({year:Number(l),weeks:(0,B.sortBy)(s,"week")}))}}return(o=r).\u0275fac=function(t){return new(t||o)(e.rXU(i.W3),e.rXU(C.y8),e.rXU(I.c$),e.rXU(u.k))},o.\u0275cmp=e.VBU({type:o,selectors:[["page-weeks-picker"]],decls:14,vars:7,consts:[["slot","start"],["fill","clear",3,"click"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[4,"ngIf"],["expand","block",3,"click"],[4,"ngFor","ngForOf"],[1,"ion-padding-top","ion-text-center"],[3,"click"],[1,"ion-text-center"],[1,"ion-justify-content-center"],["size","3",4,"ngFor","ngForOf"],["size","3"],[1,"week","multi","ion-text-center",3,"click"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return n.dismiss()}),e.j41(4,"ion-label"),e.EFF(5),e.nI1(6,"translate"),e.k0s()()(),e.j41(7,"ion-title"),e.EFF(8),e.k0s(),e.j41(9,"ion-buttons",2),e.DNE(10,Te,4,3,"ion-button",3),e.k0s()()(),e.j41(11,"ion-content"),e.DNE(12,Me,19,12,"ion-toolbar",4)(13,De,5,2,"ng-container",4),e.k0s()),2&t&&(e.R7$(5),e.JRh(e.bMT(6,5,"CANCEL")),e.R7$(3),e.JRh(n.title),e.R7$(2),e.Y8G("ngIf",n.isMultiSelect),e.R7$(2),e.Y8G("ngIf",n.isMultiSelect),e.R7$(),e.Y8G("ngIf",n.isInitialized&&!n.isEmpty))},dependencies:[d.Sq,d.bT,i.Jm,i.QW,i.hU,i.W9,i.lO,i.eU,i.he,i.ln,i.BC,i.ai,I.D9],styles:[".week[_ngcontent-%COMP%]{font-size:1.5em;line-height:1.8em;width:2em;height:2em;border:solid .2em white;border-radius:1.2em}.week.selected[_ngcontent-%COMP%]{border-color:var(--quiculum-pink)}"]}),r})();var xe=_(1916),Oe=_(1106),je=_(357);function Ge(o,r){1&o&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"STANDARD_TIMES_PICKED_WEEKS")," "))}function Ne(o,r){if(1&o&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&o){const a=e.XpG();e.R7$(),e.JRh(a.selectedWeeksSummary)}}function We(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-datetime",19),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG(2).$implicit;return e.DH7(s.plannedStart,n)||(s.plannedStart=n),e.Njj(n)}),e.j41(1,"span",20),e.EFF(2),e.nI1(3,"qWeekdayName"),e.k0s()()}if(2&o){const a=e.XpG(2).$implicit;e.Y8G("min",a.start)("max",a.plannedEnd),e.R50("ngModel",a.plannedStart),e.R7$(2),e.JRh(e.bMT(3,4,a.date))}}function Ae(o,r){if(1&o&&(e.j41(0,"ion-col",9)(1,"ion-item",11)(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-input",17),e.nI1(6,"qTime"),e.nI1(7,"qWeekdayName"),e.j41(8,"ion-popover",18),e.nI1(9,"qWeekdayName"),e.DNE(10,We,4,6,"ng-template"),e.k0s()()()),2&o){const a=e.XpG().$implicit;e.R7$(3),e.JRh(e.bMT(4,4,"PRESCHOOL_CHECK_IN")),e.R7$(2),e.Y8G("value",e.bMT(6,6,a.plannedStart))("id",e.bMT(7,8,a.date)+"_start"),e.R7$(3),e.Y8G("trigger",e.bMT(9,10,a.date)+"_start")}}function $e(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-datetime",19),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG(2).$implicit;return e.DH7(s.plannedEnd,n)||(s.plannedEnd=n),e.Njj(n)}),e.j41(1,"span",20),e.EFF(2),e.nI1(3,"qWeekdayName"),e.k0s()()}if(2&o){const a=e.XpG(2).$implicit;e.Y8G("min",a.plannedStart)("max",a.end),e.R50("ngModel",a.plannedEnd),e.R7$(2),e.JRh(e.bMT(3,4,a.date))}}function Xe(o,r){if(1&o&&(e.j41(0,"ion-col",9)(1,"ion-item",11)(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-input",17),e.nI1(6,"qTime"),e.nI1(7,"qWeekdayName"),e.j41(8,"ion-popover",18),e.nI1(9,"qWeekdayName"),e.DNE(10,$e,4,6,"ng-template"),e.k0s()()()),2&o){const a=e.XpG().$implicit;e.R7$(3),e.JRh(e.bMT(4,4,"PRESCHOOL_CHECK_OUT")),e.R7$(2),e.Y8G("value",e.bMT(6,6,a.plannedEnd))("id",e.bMT(7,8,a.date)+"_end"),e.R7$(3),e.Y8G("trigger",e.bMT(9,10,a.date)+"_end")}}function Be(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-grid",8)(1,"ion-row")(2,"ion-col",9)(3,"h4",10),e.EFF(4),e.nI1(5,"qWeekdayName"),e.k0s()(),e.j41(6,"ion-col",9)(7,"ion-item",11)(8,"ion-label"),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"ion-toggle",12),e.mxI("ngModelChange",function(n){const s=e.eBV(a).$implicit;return e.DH7(s.absence,n)||(s.absence=n),e.Njj(n)}),e.k0s()()(),e.DNE(12,Ae,11,12,"ion-col",13)(13,Xe,11,12,"ion-col",13),e.j41(14,"ion-col",9)(15,"div",14)(16,"ion-item",11)(17,"ion-label",15),e.EFF(18),e.nI1(19,"translate"),e.k0s(),e.j41(20,"ion-textarea",16),e.nI1(21,"translate"),e.mxI("ngModelChange",function(n){const s=e.eBV(a).$implicit;return e.DH7(s.note,n)||(s.note=n),e.Njj(n)}),e.k0s()()()()()()}if(2&o){const a=r.$implicit;e.R7$(4),e.SpI(" ",e.bMT(5,8,a.date)," "),e.R7$(5),e.JRh(e.bMT(10,10,"PRESCHOOL_ABSENCE")),e.R7$(2),e.R50("ngModel",a.absence),e.R7$(),e.Y8G("ngIf",!a.absence),e.R7$(),e.Y8G("ngIf",!a.absence),e.R7$(5),e.SpI(" ",e.bMT(19,12,"PRESCHOOL_ATTENDANCE_NOTE")," "),e.R7$(2),e.FS9("placeholder",e.bMT(21,14,"WRITE_YOUR_MESSAGE_HERE")),e.R50("ngModel",a.note)}}function we(o,r){if(1&o&&(e.j41(0,"div",21)(1,"ion-chip",22),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&o){const a=e.XpG();e.R7$(),e.Y8G("color",a.tooManyHoursPlanned?"danger":"success"),e.R7$(),e.E5c(" ",e.bMT(3,4,"STANDARD_TIMES_PLANNED_HOURS"),": ",a.plannedHours," / ",a.totalHours," ")}}function Ue(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-button",23),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.save())}),e.nrm(1,"fa-icon",24),e.j41(2,"span"),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&o){const a=e.XpG();e.Y8G("disabled",a.disabled||a.tooManyHoursPlanned),e.R7$(),e.Y8G("icon",a.faSave),e.R7$(2),e.SpI("\xa0",e.bMT(4,3,"SAVE"),"")}}let Le=(()=>{var o;class r extends xe.${constructor(t,n,s,l,h,c){super(t,n,s),this.modalCtrl=l,this.dateService=h,this.toastCtrl=c,this.disabled=!1,this.attendanceUpdated=new e.bkB,this.selectedWeeks=[],this.selectedWeeksSummary=null,this.days=[],this.faSave=b.hSh,g.locale("sv"),this.today=g().format("L")}get plannedHours(){return this.days?this.days.reduce((t,n)=>t+this.getPlannedMinutes(n),0)/60:0}get totalHours(){return this.calendarFrame?this.calendarFrame.hoursPerWeek:0}get tooManyHoursPlanned(){return this.plannedHours>this.totalHours}pickWeeks(){var t=this;return(0,m.A)(function*(){let s={startDate:t.dateService.addDays(t.dateService.today(),t.calendar.numberOfDaysUntilChangeEnabled),endDate:t.dateService.date(t.calendar.end),multi:!0},l=yield t.modalCtrl.create({component:Fe,componentProps:s});l.onDidDismiss().then(h=>{h&&h.data&&(t.selectWeeks(h.data.items||[h.data.item]),t.buildDays())}),l.present()})()}save(){var t=this;return(0,m.A)(function*(){const n={actualWeeks:t.selectedWeeks.map(s=>({year:s.getFullYear(),week:t.dateService.getIsoWeek(s)})),dayAttendances:t.days};t.attendanceUpdated.emit(n)})()}frameDay(t){return this.calendarFrame.calendarFrameDays[t]}getPlannedMinutes(t){return t.absence?0:this.dateService.differenceInMinutes(t.plannedEnd,t.plannedStart)}selectWeeks(t){t&&t.length>0?(this.selectedWeeks=t,this.selectedWeeksSummary=t.map(n=>this.dateService.getIsoWeek(n)).join(", ")):(this.selectedWeeks=[],this.selectedWeeksSummary=null)}buildDays(){if(this.days=[],0==this.selectedWeeks.length)return;let t=this.attendances.filter(n=>this.isAttendanceEditableAndSelected(n));[0,1,2,3,4].forEach(n=>{var s,l;let h=t.find(rt=>this.dateService.getQDayOfWeek(rt.date)==n),c=this.dateService.date(h.date);const S=this.dateParser(null===(s=this.frameDay(n))||void 0===s?void 0:s.start),R=this.dateParser(null===(l=this.frameDay(n))||void 0===l?void 0:l.end);let j=this.dateParser(h.plannedStart),N=this.dateParser(h.plannedEnd);const w=g(S),U=g(R),lt=g(j),V=g(N);j=w.isAfter(lt)?S:j,N=V.isBefore(U)&&V.isAfter(g(j))?N:R,this.days.push({date:c,weekDay:n,plannedStart:j,plannedEnd:N,note:h.note,absence:h.absence,start:S,end:R})})}isAttendanceEditableAndSelected(t){let n=this.dateService.addDays(this.dateService.today(),this.calendar.numberOfDaysUntilChangeEnabled);return!this.dateService.isBefore(t.date,n)&&this.isWithinSelectedWeeks(t)}isWithinSelectedWeeks(t){return this.selectedWeeks.some(n=>this.dateService.isSameWeek(n,t.date))}dateParser(t){return t?g(this.today+" "+t,"L LT").local().format():null}}return(o=r).\u0275fac=function(t){return new(t||o)(e.rXU(i.Xi),e.rXU(I.c$),e.rXU(F.p),e.rXU(i.W3),e.rXU(u.k),e.rXU(i.K_))},o.\u0275cmp=e.VBU({type:o,selectors:[["standard-times"]],inputs:{calendar:"calendar",calendarFrame:"calendarFrame",child:"child",attendances:"attendances",disabled:"disabled"},outputs:{attendanceUpdated:"attendanceUpdated"},features:[e.Vt3],decls:13,vars:8,consts:[[1,"ion-padding"],[1,"week-selection","ion-padding-bottom"],[4,"ngIf"],["size","small","color","light",3,"click"],["class","ion-no-padding",4,"ngFor","ngForOf"],["class","ion-padding-top ion-padding-bottom ion-text-center",4,"ngIf"],[1,"ion-text-center"],["color","success",3,"disabled","click",4,"ngIf"],[1,"ion-no-padding"],["size","12"],[1,"ion-padding-top"],["lines","none",1,"ion-no-padding"],["color","action",3,"ngModelChange","ngModel"],["size","12",4,"ngIf"],[1,"ion-padding-bottom"],["position","stacked"],["autocapitalize","on","autosize","",3,"ngModelChange","placeholder","ngModel"],["slot","end",1,"ion-text-end","ion-no-padding","ion-no-margin",3,"value","id"],[3,"trigger"],["displayFormat","HH:mm","presentation","time",3,"ngModelChange","min","max","ngModel"],["slot","title"],[1,"ion-padding-top","ion-padding-bottom","ion-text-center"],[1,"hours-planned",3,"color"],["color","success",3,"click","disabled"],[3,"icon"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div"),e.DNE(3,Ge,3,3,"div",2)(4,Ne,2,1,"div",2),e.k0s(),e.j41(5,"div")(6,"ion-button",3),e.bIt("click",function(){return n.pickWeeks()}),e.EFF(7),e.nI1(8,"translate"),e.k0s()()(),e.DNE(9,Be,22,16,"ion-grid",4)(10,we,4,6,"div",5),e.j41(11,"div",6),e.DNE(12,Ue,5,5,"ion-button",7),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("ngIf",n.selectedWeeksSummary),e.R7$(),e.Y8G("ngIf",n.selectedWeeksSummary),e.R7$(3),e.SpI(" ",e.bMT(8,6,"SELECT_WEEKS"),""),e.R7$(2),e.Y8G("ngForOf",n.days),e.R7$(),e.Y8G("ngIf",n.selectedWeeksSummary),e.R7$(2),e.Y8G("ngIf",n.selectedWeeksSummary))},dependencies:[i.Jm,i.ZB,i.hU,i.A9,i.lO,i.$w,i.uz,i.he,i.ln,i.nc,i.BY,i.CF,i.hB,i.Je,i.Gw,Oe.U,d.Sq,d.bT,k.BC,k.vS,$.aY,je.Y,X.k,I.D9],styles:[".week-selection[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.day-title[_ngcontent-%COMP%]{text-transform:capitalize}ion-label[_ngcontent-%COMP%]{color:#000!important}.hours-planned[_ngcontent-%COMP%]{font-size:1.33em;padding-left:1em;padding-right:1em}"]}),r})();const Ye=["preschoolCalendar"];function Ve(o,r){if(1&o&&(e.j41(0,"ion-label",12),e.EFF(1),e.k0s()),2&o){const a=e.XpG(2);e.R7$(),e.SpI(" ",null==a.selectedChild?null:a.selectedChild.schoolName," ")}}function He(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-item",10),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.openChildPicker())}),e.j41(1,"ion-label"),e.EFF(2),e.nI1(3,"translate"),e.DNE(4,Ve,2,1,"ion-label",11),e.k0s()()}if(2&o){const a=e.XpG();e.R7$(2),e.SpI(" ",(null==a.selectedChild?null:a.selectedChild.name)||e.bMT(3,2,"SELECT_CHILD")," "),e.R7$(2),e.Y8G("ngIf",a.selectedChild)}}function ze(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-item",13)(1,"ion-checkbox",14),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG();return e.DH7(s.enableChooseMore,n)||(s.enableChooseMore=n),e.Njj(n)}),e.bIt("ionChange",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.change())}),e.EFF(2,"Markera flera"),e.k0s()()}if(2&o){const a=e.XpG();e.R7$(),e.R50("ngModel",a.enableChooseMore)}}function Ke(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-button",15),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.loadMoreHistory())}),e.EFF(1," Visa historik "),e.k0s()}}function Je(o,r){1&o&&(e.j41(0,"p",16),e.EFF(1,"OBS! Dagar eller veckor som \xe4r lovdagar uppdateras inte n\xe4r man \xe4ndar standardtider."),e.k0s())}function Qe(o,r){if(1&o){const a=e.RV6();e.j41(0,"standard-times",17),e.bIt("attendanceUpdated",function(n){e.eBV(a);const s=e.XpG();return e.Njj(s.onAttendanceUpdated(n))}),e.k0s()}if(2&o){const a=e.XpG();e.Y8G("calendar",a.calendar)("calendarFrame",a.calendarFrame)("child",a.selectedChild)("attendances",a.attendances)("disabled",a.isSavingStandardTimes)}}function Ze(o,r){if(1&o){const a=e.RV6();e.j41(0,"preschool-calendar",18,0),e.bIt("initialized",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.scrollToToday())}),e.k0s()}if(2&o){const a=e.XpG();e.Y8G("calendar",a.calendar)("calendarFrame",a.calendarFrame)("child",a.selectedChild)("attendances",a.attendances)("enableChooseMore",a.enableChooseMore)}}function qe(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-fab",19)(1,"ion-fab-button",20),e.bIt("click",function(){e.eBV(a);const n=e.XpG();return e.Njj(n.openMultiEditor())}),e.nrm(2,"fa-icon",21),e.k0s()()}if(2&o){const a=e.XpG();e.R7$(2),e.Y8G("icon",a.faEdit)}}function et(o,r){if(1&o){const a=e.RV6();e.j41(0,"ion-segment",22),e.mxI("ngModelChange",function(n){e.eBV(a);const s=e.XpG();return e.DH7(s.view,n)||(s.view=n),e.Njj(n)}),e.j41(1,"ion-segment-button",23),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"ion-segment-button",24),e.EFF(5),e.nI1(6,"translate"),e.k0s()()}if(2&o){const a=e.XpG();e.R50("ngModel",a.view),e.R7$(2),e.SpI(" ",e.bMT(3,3,"CALENDAR")," "),e.R7$(3),e.SpI(" ",e.bMT(6,5,"STANDARD_TIMES")," ")}}const nt=[{path:"",component:(()=>{var o;class r extends P.v{constructor(t,n,s,l,h,c,S,R,j,N,w,U){super(t,s,n,l,h,c),this.uip=c,this.alertCtrl=S,this.modalCtrl=R,this.calendarService=j,this.preschoolChildService=N,this.attendanceService=w,this.dateService=U,this.children=[],this.attendances=[],this.haschanged=!1,this.isBusy=!1,this.isSavingStandardTimes=!1,this.defaultView="calendar",this.userInfo={},this.faEdit=b.MT7,this.saveMultiple=!1,this.currentStartDate=new Date,this.showHistory=!1,this.enableChooseMore=!1,this.initializeTranslations()}ngOnInit(){this.initializePage(),this.addSub(this.uip.userInfoState.subscribe(t=>this.userInfo=t))}get isGuardian(){return this.userInfo&&"Guardian"==this.userInfo.roleName}openChildPicker(){var t=this;return(0,m.A)(function*(){t.isBusy=!0;let n=yield t.modalCtrl.create({component:D.M,componentProps:{items:t.children}});n.present(),n.onDidDismiss().then(function(){var s=(0,m.A)(function*(l){l&&l.data&&l.data.item&&(!t.selectedChild||l.data.item.id!=t.selectedChild.id)&&(yield t.selectChild(l.data.item),t.haschanged=!1,t.scrollToToday()),t.isBusy=!1});return function(l){return s.apply(this,arguments)}}())})()}selectChild(t){var n=this;return(0,m.A)(function*(){n.selectedChild=t,yield n.withSpinner(()=>n.loadChildData(),n.translations.STANDARD_TIMES_LOADING_PLANNED_ATTENDANCE),n.view||(n.view="calendar")})()}onAttendanceUpdated(t){var n=this;return(0,m.A)(function*(){yield n.save(t)})()}save(t){var n=this;return(0,m.A)(function*(){let s=n.children.filter(l=>l.id!=n.selectedChild.id&&l.calendarFrameId==n.selectedChild.calendarFrameId);s.length>0?yield n.offerUserToApplyStandardTimesToOtherChildren(s,t):yield n.applyStandardTimesToSelectedAndOtherChildren(t,[])})()}scrollToToday(){let t=this.attendances.find(n=>this.dateService.isSameWeek(n.date,this.dateService.today()));if(t){let n=t.date;setTimeout(()=>this.scrollToDate(n),500)}}initializeTranslations(){var t=this;return(0,m.A)(function*(){t.translations=yield(0,E.s)(t.translateService.get(["NO","SAVE_COMPLETE","STANDARD_TIMES_LOADING_PLANNED_ATTENDANCE","STANDARD_TIMES_SAVING","STANDARD_TIMES_UPDATE_OTHER_CHILDREN","YES"]))})()}initializePage(){var t=this;return(0,m.A)(function*(){t.children=yield t.withSpinner(()=>t.preschoolChildService.getChildren()),1==t.children.length&&t.selectChild(t.children[0])})()}loadChildData(){var t=this;return(0,m.A)(function*(){yield t.loadCalendar(),yield t.loadCalendarFrame(),yield t.loadAttendances()})()}loadCalendar(){var t=this;return(0,m.A)(function*(){t.calendar=yield t.calendarService.getCurrentCalendar(t.selectedChild.schoolId)})()}loadCalendarFrame(){var t=this;return(0,m.A)(function*(){t.calendarFrame=yield t.calendarService.getCalendarFrame(t.selectedChild.calendarFrameId)})()}loadAttendances(){var t=this;return(0,m.A)(function*(){const n=new Date,s=new Date(n);s.setDate(n.getDate()-7),t.attendances=(yield t.attendanceService.getChildAttendances(t.selectedChild.studentId,s,t.calendar.end))||[]})()}loadMoreHistory(){var t=this;return(0,m.A)(function*(){const n=new Date((new Date).getFullYear(),0,1),s=new Date(t.currentStartDate);s.setMonth(t.currentStartDate.getMonth()-1),s<n&&s.setTime(n.getTime());const l=(yield t.attendanceService.getChildAttendances(t.selectedChild.studentId,s,t.currentStartDate))||[];t.attendances=[...l,...t.attendances],t.currentStartDate=s,t.showHistory=!0})()}offerUserToApplyStandardTimesToOtherChildren(t,n){var s=this;return(0,m.A)(function*(){const l=t.map(c=>({type:"checkbox",label:`${c.firstName} ${c.lastName}`,value:c.id,checked:!0}));(yield s.alertCtrl.create({header:s.translations.STANDARD_TIMES_UPDATE_OTHER_CHILDREN,buttons:[{text:s.translations.NO,handler:()=>s.applyStandardTimesToSelectedAndOtherChildren(n,[])},{text:s.translations.YES,handler:c=>{s.applyStandardTimesToSelectedAndOtherChildren(n,c)}}],inputs:[...l]})).present()})()}applyStandardTimesToSelectedAndOtherChildren(t,n){var s=this;return(0,m.A)(function*(){s.isSavingStandardTimes=!0;let l=[s.selectedChild.studentId].concat(n);yield s.saveStandardTimeForChildren(t,l),s.isSavingStandardTimes=!1,s.cheakstandardTimesUpdate(t)?(yield s.alertCtrl.create({header:"OBS!",message:"Det finns dagar i ditt urval som inte \xe4ndrats f\xf6r att de \xe4r lovdagar eller st\xe4ngda",buttons:[{text:"OK",handler:S=>{s.userAlertService.info(s.translations.SAVE_COMPLETE,"top")}}]})).present():s.userAlertService.info(s.translations.SAVE_COMPLETE,"top"),yield s.loadAttendances()})()}cheakstandardTimesUpdate(t){const n=this.calendar.days.map(l=>({week:this.dateService.getIsoWeek(l.date),holliday:l.holliday,closed:l.closed})),s=t.actualWeeks.find(l=>n.some(h=>h.week===l.week&&h.holliday));return s?console.log("Matching week found with holiday",s):console.log("No matching week with holiday or closed found"),s}change(){this.showHistory=!1}saveStandardTimeForChildren(t,n){var s=this;return(0,m.A)(function*(){for(var l=0;l<n.length;l++)yield s.saveStandardTimesForChild(t,n[l])})()}saveStandardTimesForChild(t,n){var s=this;return(0,m.A)(function*(){const l={calendarId:s.calendar.id,studentId:n,weekType:"Custom",actualWeeks:t.actualWeeks,dayAttendances:t.dayAttendances};yield s.attendanceService.updateCalendarAttendance(l)})()}scrollToDate(t){if(this.showHistory)return void this.content.scrollToTop(700);let n=this.dateService.formatDateIso8601(t),s=document.getElementById(n);s&&this.content.scrollByPoint(0,s.offsetTop,700)}openMultiEditor(){this.enableChooseMore&&this.preschoolCalendar&&this.preschoolCalendar.onsaveMultipleChange(!0)}}return(o=r).\u0275fac=function(t){return new(t||o)(e.rXU(y.$),e.rXU(i.Xi),e.rXU(p.Ix),e.rXU(I.c$),e.rXU(F.p),e.rXU(x.Z),e.rXU(i.hG),e.rXU(i.W3),e.rXU(O.X),e.rXU(W.N),e.rXU(A.Q),e.rXU(u.k))},o.\u0275cmp=e.VBU({type:o,selectors:[["page-preschool-calendar"]],viewQuery:function(t,n){if(1&t&&(e.GBs(i.W9,5),e.GBs(Ye,5)),2&t){let s;e.mGM(s=e.lsd())&&(n.content=s.first),e.mGM(s=e.lsd())&&(n.preschoolCalendar=s.first)}},features:[e.Vt3],decls:14,vars:11,consts:[["preschoolCalendar",""],[3,"pageTitle"],["button","","lines","none",3,"click",4,"ngIf"],["lines","none",4,"ngIf"],["expand","full","fill","outline",3,"click",4,"ngIf"],["class","warning-text",4,"ngIf"],[3,"calendar","calendarFrame","child","attendances","disabled","attendanceUpdated",4,"ngIf"],["id","preschoolCalendar",3,"calendar","calendarFrame","child","attendances","enableChooseMore","initialized",4,"ngIf"],["horizontal","end","vertical","bottom","slot","fixed",4,"ngIf"],["color","action",3,"ngModel","ngModelChange",4,"ngIf"],["button","","lines","none",3,"click"],["class","light-label",4,"ngIf"],[1,"light-label"],["lines","none"],[3,"ngModelChange","ionChange","ngModel"],["expand","full","fill","outline",3,"click"],[1,"warning-text"],[3,"attendanceUpdated","calendar","calendarFrame","child","attendances","disabled"],["id","preschoolCalendar",3,"initialized","calendar","calendarFrame","child","attendances","enableChooseMore"],["horizontal","end","vertical","bottom","slot","fixed"],[3,"click"],[2,"font-size","large",3,"icon"],["color","action",3,"ngModelChange","ngModel"],["value","calendar"],["value","standard"]],template:function(t,n){1&t&&(e.j41(0,"app-header",1),e.nI1(1,"translate"),e.j41(2,"ion-toolbar"),e.DNE(3,He,5,4,"ion-item",2)(4,ze,3,1,"ion-item",3),e.k0s()(),e.j41(5,"ion-content"),e.DNE(6,Ke,2,0,"ion-button",4)(7,Je,2,0,"p",5)(8,Qe,1,5,"standard-times",6)(9,Ze,2,5,"preschool-calendar",7)(10,qe,3,1,"ion-fab",8),e.k0s(),e.j41(11,"ion-footer")(12,"ion-toolbar"),e.DNE(13,et,7,7,"ion-segment",9),e.k0s()()),2&t&&(e.FS9("pageTitle",e.bMT(1,9,"PRESCHOOL_CALENDAR_TITLE")),e.R7$(3),e.Y8G("ngIf",n.isGuardian),e.R7$(),e.Y8G("ngIf",n.isGuardian&&n.selectedChild&&"calendar"==n.view),e.R7$(2),e.Y8G("ngIf",!n.isBusy&&"calendar"==n.view),e.R7$(),e.Y8G("ngIf","standard"==n.view),e.R7$(),e.Y8G("ngIf",!n.isBusy&&"standard"==n.view),e.R7$(),e.Y8G("ngIf",!n.isBusy&&"calendar"==n.view),e.R7$(),e.Y8G("ngIf",n.enableChooseMore&&"calendar"==n.view),e.R7$(3),e.Y8G("ngIf",n.selectedChild))},dependencies:[d.bT,k.BC,k.vS,i.Jm,i.eY,i.W9,i.Q8,i.YW,i.M0,i.uz,i.he,i.Gp,i.eP,i.ai,i.hB,i.Je,M.l,ye,Le,$.aY,I.D9],styles:["page-preschool-calendar[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{margin-bottom:50px}page-preschool-calendar[_ngcontent-%COMP%]   .child-view-selector[_ngcontent-%COMP%]{position:fixed;z-index:2}page-preschool-calendar[_ngcontent-%COMP%]   .child-view[_ngcontent-%COMP%]{margin-top:40px}.warning-text[_ngcontent-%COMP%]{font-size:14px;padding-left:20px;padding-right:20px}.light-label[_ngcontent-%COMP%]{color:#000;font-size:.7em;margin-top:4px;float:right;font-weight:400!important}"]}),r})()}];let it=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[p.iI.forChild(nt),p.iI]}),r})();var at=_(7019),ot=_(1683);let st=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[d.MD,k.YN,i.bv,it,at.h,I.h,ot.Y,$.dX]}),r})()},8330:(G,v,_)=>{_.d(v,{M:()=>A});var d=_(467),k=_(1876),i=_(4438),p=_(4742),m=_(3656),E=_(230),P=_(177);function D(u,M){if(1&u){const C=i.RV6();i.j41(0,"ion-button",1),i.bIt("click",function(){i.eBV(C);const g=i.XpG();return i.Njj(g.dismiss())}),i.EFF(1),i.nI1(2,"translate"),i.k0s()}2&u&&(i.R7$(),i.SpI(" ",i.bMT(2,1,"DONE")," "))}function b(u,M){if(1&u&&(i.j41(0,"p",6),i.EFF(1),i.k0s()),2&u){const C=i.XpG();i.R7$(),i.JRh(C.emptyLabel)}}function e(u,M){if(1&u){const C=i.RV6();i.j41(0,"ion-searchbar",8),i.nI1(1,"translate"),i.bIt("ionInput",function(g){i.eBV(C);const T=i.XpG(2);return i.Njj(T.onSearchInput(g))}),i.k0s()}2&u&&i.FS9("placeholder",i.bMT(1,1,"SEARCH"))}function y(u,M){if(1&u){const C=i.RV6();i.j41(0,"ion-item")(1,"ion-label"),i.EFF(2),i.k0s(),i.j41(3,"ion-checkbox",10),i.bIt("ionChange",function(){const g=i.eBV(C).$implicit,T=i.XpG(3);return i.Njj(T.onClickItem(g))}),i.k0s()()}if(2&u){const C=M.$implicit,f=i.XpG(3);i.R7$(2),i.JRh(C.name),i.R7$(),i.Y8G("checked",f.isSelected(C))}}function I(u,M){if(1&u&&(i.j41(0,"ion-list"),i.DNE(1,y,4,2,"ion-item",9),i.k0s()),2&u){const C=i.XpG(2);i.R7$(),i.Y8G("ngForOf",C.filteredItems)}}function F(u,M){if(1&u&&(i.j41(0,"div")(1,"ion-label",13),i.EFF(2),i.k0s()()),2&u){const C=i.XpG().$implicit;i.R7$(2),i.JRh(C.schoolName)}}function x(u,M){if(1&u){const C=i.RV6();i.j41(0,"ion-item",12),i.bIt("click",function(){const g=i.eBV(C).$implicit,T=i.XpG(3);return i.Njj(T.onClickItem(g))}),i.j41(1,"ion-label"),i.EFF(2),i.k0s(),i.DNE(3,F,3,1,"div",5),i.k0s()}if(2&u){const C=M.$implicit;i.R7$(2),i.JRh(C.name),i.R7$(),i.Y8G("ngIf",C.schoolName)}}function O(u,M){if(1&u&&(i.j41(0,"ion-list"),i.DNE(1,x,4,2,"ion-item",11),i.k0s()),2&u){const C=i.XpG(2);i.R7$(),i.Y8G("ngForOf",C.filteredItems)}}function W(u,M){if(1&u&&(i.qex(0),i.DNE(1,e,2,3,"ion-searchbar",7)(2,I,2,1,"ion-list",5)(3,O,2,1,"ion-list",5),i.bVm()),2&u){const C=i.XpG();i.R7$(),i.Y8G("ngIf",C.isSearchVisible),i.R7$(),i.Y8G("ngIf",C.isMultiSelect),i.R7$(),i.Y8G("ngIf",!C.isMultiSelect)}}let A=(()=>{var u;class M{constructor(f,g,T){this.modalCtrl=f,this.navParams=g,this.translate=T,this.isSearching=!1,this.filteredItems=[],this.selection=new k.Y}ionViewWillEnter(){var f=this;return(0,d.A)(function*(){yield f.initLang(),f.initView()})()}get isSearchVisible(){return this.items&&this.items.length>10}isSelected(f){return this.selection.isSelected(f)}onClickItem(f){this.isMultiSelect?this.toggleSelection(f):(this.selection.selectItem(f),this.dismiss())}onSearchInput(f){let g=f.target.value||"";this.filteredItems=this.items.filter(T=>this.match(g,T))}dismiss(){let f=this.selection.selectedItems;0===f.length?this.modalCtrl.dismiss():this.modalCtrl.dismiss(this.isMultiSelect?{items:f}:{item:f[0]})}initLang(){this.translate.setDefaultLang("sv");const f=this.translate.getBrowserLang();f&&f.startsWith("en")?this.translate.use("en"):this.translate.use("sv"),this.translate.get(["SELECTABLE_OPTIONS_MISSING","SELECT_ONE_OR_MORE","SELECT_ONE"]).subscribe(T=>{this.translations=T})}initView(){this.selection=new k.Y,this.emptyLabel=this.navParams.data.emptyLabel||this.translations.SELECTABLE_OPTIONS_MISSING,this.isMultiSelect=this.navParams.data.multi,this.title=this.navParams.data.title||(this.isMultiSelect?this.translations.SELECT_ONE_OR_MORE:this.translations.SELECT_ONE),this.items=this.navParams.data.items,this.isEmpty=0==this.items.length,this.selection.setSelectedItems(this.navParams.data.selectedItems||[]),this.filteredItems=this.items}match(f,g){let T=f.toLocaleLowerCase();return g.name.toLocaleLowerCase().indexOf(T)>-1}toggleSelection(f){this.selection.toggleItem(f)}}return(u=M).\u0275fac=function(f){return new(f||u)(i.rXU(p.W3),i.rXU(m.y8),i.rXU(E.c$))},u.\u0275cmp=i.VBU({type:u,selectors:[["page-picker"]],decls:14,vars:7,consts:[["slot","start"],["fill","clear",3,"click"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-padding","ion-text-center"],["autocapitalize","off",3,"placeholder","ionInput",4,"ngIf"],["autocapitalize","off",3,"ionInput","placeholder"],[4,"ngFor","ngForOf"],["item-end","",3,"ionChange","checked"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[2,"color","black","font-size","0.7em"]],template:function(f,g){1&f&&(i.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),i.bIt("click",function(){return g.dismiss()}),i.j41(4,"span"),i.EFF(5),i.nI1(6,"translate"),i.k0s()()(),i.j41(7,"ion-title"),i.EFF(8),i.k0s(),i.j41(9,"ion-buttons",2),i.DNE(10,D,3,3,"ion-button",3),i.k0s()()(),i.j41(11,"ion-content"),i.DNE(12,b,2,1,"p",4)(13,W,4,3,"ng-container",5),i.k0s()),2&f&&(i.R7$(5),i.JRh(i.bMT(6,5,"CANCEL")),i.R7$(3),i.JRh(g.title),i.R7$(2),i.Y8G("ngIf",g.isMultiSelect),i.R7$(2),i.Y8G("ngIf",g.isEmpty),i.R7$(),i.Y8G("ngIf",!g.isEmpty))},dependencies:[P.Sq,P.bT,p.Jm,p.QW,p.eY,p.W9,p.eU,p.uz,p.he,p.nf,p.S1,p.BC,p.ai,p.hB,p.Gw,E.D9],encapsulation:2}),M})()},357:(G,v,_)=>{_.d(v,{Y:()=>i});var d=_(4438),k=_(4078);let i=(()=>{var p;class m{constructor(P){this.dateService=P}transform(P,D){return P?this.dateService.formatWeekDayLong(P):""}}return(p=m).\u0275fac=function(P){return new(P||p)(d.rXU(k.k,16))},p.\u0275pipe=d.EJ8({name:"qWeekdayName",type:p,pure:!0}),m})()}}]);