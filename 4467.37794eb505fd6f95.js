"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4467],{1916:(b,C,l)=>{l.d(C,{$:()=>T});var m=l(467),_=l(3207),u=l(4438),D=l(4742),v=l(230),S=l(5151);let T=(()=>{var p;class P{constructor(o,c,h){this.loadingCtrl=o,this.translateService=c,this.userAlertService=h,this.subscriptions=[],this.showLoading=!1,this.loadingDismissTimeout=-1,this.loadingDismissTimeoutMS=3e4}ngOnDestroy(){this.subscriptions.forEach(o=>o.unsubscribe())}addSub(o){this.subscriptions.push(o)}translate(o,c){var h=this;return(0,m.A)(function*(){return(yield(0,_.s)(h.translateService.get(o)))||c||o})()}withSpinner(o,c,h){var g=this;return(0,m.A)(function*(){let y;yield g.presentLoading(c),g.loadingDismissTimeout=setTimeout(()=>g.timeoutLoading(h),g.loadingDismissTimeoutMS);try{y=yield o()}catch(I){g.userAlertService.debug(I)}return yield g.dismissLoading(),y})()}timeoutLoading(o){var c=this;return(0,m.A)(function*(){o||(o=yield c.translate("LOADING_FAILED")),c.userAlertService.error(o),yield c.dismissLoading()})()}dismissLoading(){var o=this;return(0,m.A)(function*(){-1!=o.loadingDismissTimeout&&(clearTimeout(o.loadingDismissTimeout),o.loadingDismissTimeout=-1),o.showLoading=!1,(yield o.loadingCtrl.getTop())&&(yield o.loadingCtrl.dismiss(null))})()}presentLoading(o){var c=this;return(0,m.A)(function*(){return c.showLoading=!0,yield c.loadingCtrl.create({message:o}).then(h=>{h.present().then(()=>{c.showLoading&&h.dismiss()})})})()}}return(p=P).\u0275fac=function(o){return new(o||p)(u.rXU(D.Xi),u.rXU(v.c$),u.rXU(S.p))},p.\u0275cmp=u.VBU({type:p,selectors:[["ng-component"]],decls:0,vars:0,template:function(o,c){},encapsulation:2}),P})()},6848:(b,C,l)=>{l.r(C),l.d(C,{CalendarPageModule:()=>Q});var m=l(177),_=l(9417),u=l(4742),D=l(9598),v=l(467),S=l(7376),T=l(1916),p=l(4780),P=l(8330),e=l(4438),o=l(230),c=l(5151),h=l(1622),g=l(1207),y=l(4078),I=l(6186);let O=(()=>{var i;class d extends h.D{constructor(t,n,a){super(),this.calendarService=t,this.dateService=n,this.loginStatus=a,this.isLoading=!1,this.calendarEvents=[],this.setSubscriptions()}initialize(t,n,a){var r=this;return(0,v.A)(function*(){if(!r.loadPromise||t!=r.startDate||n!=r.endDate){r.isLoading=!0;let f=r.dateService.formatDateIso8601(t),E=r.dateService.formatDateIso8601(n);r.loadPromise=r.calendarService.getMyCalendarEvents({startDate:f,endDate:E,studentIds:a}),r.calendarEvents=yield r.loadPromise,r.isLoading=!1}return r.loadPromise})()}refresh(){this.startDate=void 0,this.endDate=void 0,this.calendarEvents=[],this.loadPromise=void 0}onLoginStatusChange(t){t||this.refresh()}onRoleChange(t){this.refresh()}setSubscriptions(){this.addSub(this.loginStatus.roleNameState.subscribe(t=>this.onRoleChange(t))),this.addSub(this.loginStatus.isLoggedInState.subscribe(t=>this.onLoginStatusChange(t)))}}return(i=d).\u0275fac=function(t){return new(t||i)(e.KVO(g.I),e.KVO(y.k),e.KVO(I.B))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),d})();var R=l(6969),L=l(9196),F=l(8593),$=l(4416),G=l(2952),N=l(4173),A=l(7175);function x(i,d){if(1&i&&(e.j41(0,"ion-label",9),e.EFF(1),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.SpI(" ",null==s.selectedStudent?null:s.selectedStudent.schoolName," ")}}function B(i,d){if(1&i){const s=e.RV6();e.j41(0,"ion-item",7),e.bIt("click",function(){e.eBV(s);const n=e.XpG();return e.Njj(n.openStudentPicker())}),e.j41(1,"ion-label"),e.EFF(2),e.nI1(3,"translate"),e.DNE(4,x,2,1,"ion-label",8),e.k0s()()}if(2&i){const s=e.XpG();e.R7$(2),e.SpI(" ",(null==s.selectedStudent?null:s.selectedStudent.name)||e.bMT(3,2,"SELECT_STUDENT")," "),e.R7$(2),e.Y8G("ngIf",s.selectedStudent)}}function j(i,d){1&i&&e.nrm(0,"q-spinner",10)}function U(i,d){1&i&&(e.j41(0,"div",11),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"NO_CALENDAR_EVENTS_FOR_MONTH")," "))}function W(i,d){if(1&i&&(e.j41(0,"ion-badge",19),e.EFF(1),e.k0s()),2&i){const s=d.$implicit;e.Y8G("color",s.labelCssClass),e.R7$(),e.SpI(" ",s.name," ")}}function X(i,d){if(1&i){const s=e.RV6();e.j41(0,"ion-item",15),e.bIt("click",function(){const n=e.eBV(s).$implicit,a=e.XpG(3);return e.Njj(a.toEventPage(n.id))}),e.j41(1,"ion-label")(2,"p",16),e.EFF(3),e.k0s(),e.j41(4,"h4"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.nI1(8,"qNoHtml"),e.k0s(),e.j41(9,"div")(10,"ion-badge",17),e.EFF(11),e.k0s()(),e.j41(12,"div"),e.DNE(13,W,2,2,"ion-badge",18),e.k0s()()()}if(2&i){const s=d.$implicit,t=e.XpG(3);e.xc7("border-left-color",null==s||null==s.category?null:s.category.color),e.AVh("highlighted",t.isHighlighted(s)),e.R7$(3),e.Lme("",s.startTime," - ",s.endTime,""),e.R7$(2),e.JRh(s.title),e.R7$(2),e.JRh(e.bMT(8,12,s.text)),e.R7$(3),e.xc7("background-color",null==s||null==s.category?null:s.category.color),e.R7$(),e.SpI(" ",null==s||null==s.category?null:s.category.name," "),e.R7$(2),e.Y8G("ngForOf",s.students)}}function V(i,d){if(1&i&&(e.qex(0),e.j41(1,"ion-list-header",13),e.nI1(2,"qDate"),e.j41(3,"ion-label"),e.EFF(4),e.nI1(5,"qDate"),e.k0s()(),e.DNE(6,X,14,14,"ion-item",14),e.bVm()),2&i){const s=d.$implicit;e.R7$(),e.FS9("id",e.bMT(2,3,s.date)),e.R7$(3),e.SpI(" ",e.bMT(5,5,s.date)," "),e.R7$(2),e.Y8G("ngForOf",s.events)}}function Y(i,d){if(1&i&&(e.j41(0,"ion-list"),e.DNE(1,V,7,7,"ng-container",12),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.Y8G("ngForOf",s.days)}}const K=[{path:"",component:(()=>{var i;class d extends T.${constructor(t,n,a,r,f,E,Z,w,q,ee){super(t,n,a),this.calendarProvider=r,this.dateService=f,this.studentsProvider=E,this.userInfoProvider=Z,this.modalCtrl=w,this.router=q,this.studentService=ee,this.isBusy=!0,this.events=[],this.filteredEvents=[],this.highlightedEvents=[],this.students=[],this.filteredStudents=[],this.scrollDelayTimeout=-1,this.userInfo={}}ngOnInit(){this.addSub(this.userInfoProvider.userInfoState.subscribe(t=>this.userInfo=t))}getStudents(){var t=this;return(0,v.A)(function*(){try{var a=(yield t.studentService.getStudents()).filter(r=>r.schoolId===t.userInfo.schoolId);t.filteredStudents=a.map(r=>({id:r.studentId.toString(),name:`${r.firstName} ${r.lastName}`,schoolName:r.schoolName}))}catch(r){}})()}ionViewDidEnter(){var t=this;return(0,v.A)(function*(){t.calendarMonth.init(),t.initView()})()}get isGuardian(){return this.userInfo&&"Guardian"===this.userInfo.roleName}isHighlighted(t){return!!this.highlightedEvents.find(n=>n.id==t.id)}onSelectMonth(t){var n=this;return(0,v.A)(function*(){yield n.loadEvents(t.startDate,t.endDate),n.buildViewModel(),n.dateService.isSameMonth(t.startDate,Date.now())&&(n.setHighlightedEvents(Date.now()),n.scrollToNextEventWithDelay())})()}onSelectDay(t){this.clearScrollDelayTimeout(),t.nextDateWithEvents&&this.scrollToDate(t.nextDateWithEvents),this.setHighlightedEvents(t.date)}openStudentPicker(){var t=this;return(0,v.A)(function*(){let n=yield t.modalCtrl.create({component:P.M,componentProps:{items:t.filteredStudents}});n.present(),n.onDidDismiss().then(a=>{a&&a.data&&a.data.item&&(!t.selectedStudent||a.data.item.id!=t.selectedStudent.id)&&(t.selectedStudent=a.data.item,t.buildViewModel())})})()}buildViewModel(){this.isGuardian&&this.events&&this.events.forEach(t=>{t.students=this.students.filter(n=>t.studentIds.find(a=>a==Number(n.id)))}),this.filterEvents(),this.days=S(this.filteredEvents).groupBy("date").toPairs().map(t=>({date:t[0],events:t[1],numberOfEvents:t[1].length})).orderBy("date").value()}clearScrollDelayTimeout(){-1!==this.scrollDelayTimeout&&(clearTimeout(this.scrollDelayTimeout),this.scrollDelayTimeout=-1)}filterEvents(){if(null==this.selectedStudent||"all"==this.selectedStudent.id)this.filteredEvents=this.events;else{let t=Number(this.selectedStudent.id);this.filteredEvents=this.events.filter(n=>n.studentIds.indexOf(t)>-1)}}initView(){var t=this;return(0,v.A)(function*(){yield t.studentsProvider.init();let n=yield t.translate("SHOW_ALL");t.isGuardian&&(t.students=t.studentsProvider.list.map((f,E)=>({id:f.id,name:f.name,labelCssClass:`altcolor${E}`})),yield t.getStudents(),t.students.unshift({id:"all",name:n}));let a=t.dateService.startOfMonth(Date.now()),r=t.dateService.endOfMonth(Date.now());yield t.loadEvents(a,r),t.buildViewModel(),t.setHighlightedEvents(Date.now()),setTimeout(()=>t.scrollToNextEventWithDelay(),500)})()}loadEvents(t,n){var a=this;return(0,v.A)(function*(){a.isBusy=!0,t=a.dateService.startOfWeek(t),n=a.dateService.endOfWeek(n);let r=a.isGuardian?a.studentsProvider.list.map(f=>Number(f.id)):void 0;a.events=yield a.calendarProvider.initialize(t,n,r),a.isBusy=!1})()}scrollToDateWithDelay(t){this.clearScrollDelayTimeout(),this.scrollDelayTimeout=setTimeout(()=>{this.scrollToDate(t),this.clearScrollDelayTimeout()},500)}scrollToDate(t){let n=this.dateService.formatDateIso8601(t),a=document.getElementById(n);a&&this.content.scrollToPoint(0,a.offsetTop,700)}scrollToNextEventWithDelay(){let t=S.find(this.days,n=>this.dateService.isSameDay(n.date,Date.now())||this.dateService.isBefore(Date.now(),n.date));t||(t=S.last(this.days)),t&&this.scrollToDateWithDelay(this.dateService.date(t.date))}setHighlightedEvents(t){this.highlightedEvents=this.events.filter(n=>this.dateService.isSameDay(n.date,t))}toEventPage(t){this.router.navigate(["tabs","calendar-event",t])}}return(i=d).\u0275fac=function(t){return new(t||i)(e.rXU(u.Xi),e.rXU(o.c$),e.rXU(c.p),e.rXU(O),e.rXU(y.k),e.rXU(R.s),e.rXU(L.Z),e.rXU(u.W3),e.rXU(D.Ix),e.rXU(F.b))},i.\u0275cmp=e.VBU({type:i,selectors:[["page-calendar"]],viewQuery:function(t,n){if(1&t&&(e.GBs(u.W9,5),e.GBs(p.W,5)),2&t){let a;e.mGM(a=e.lsd())&&(n.content=a.first),e.mGM(a=e.lsd())&&(n.calendarMonth=a.first)}},features:[e.Vt3],decls:8,vars:5,consts:[["pageTitle","CALENDAR_TITLE"],["lines","none","button","",3,"click",4,"ngIf"],[3,"selectMonth","selectDay","events"],[1,"ion-padding-top"],["class","ion-margin-top",4,"ngIf"],["class","ion-text-center",4,"ngIf"],[4,"ngIf"],["lines","none","button","",3,"click"],["class","light-label",4,"ngIf"],[1,"light-label"],[1,"ion-margin-top"],[1,"ion-text-center"],[4,"ngFor","ngForOf"],["padding","",3,"id"],["class","event",3,"highlighted","border-left-color","click",4,"ngFor","ngForOf"],[1,"event",3,"click"],[1,"time"],["qLabel",""],["qLabel","","class","student-label",3,"color",4,"ngFor","ngForOf"],["qLabel","",1,"student-label",3,"color"]],template:function(t,n){1&t&&(e.j41(0,"app-header",0)(1,"ion-list"),e.DNE(2,B,5,4,"ion-item",1),e.k0s(),e.j41(3,"calendar-month",2),e.bIt("selectMonth",function(r){return n.onSelectMonth(r)})("selectDay",function(r){return n.onSelectDay(r)}),e.k0s()(),e.j41(4,"ion-content",3),e.DNE(5,j,1,0,"q-spinner",4)(6,U,3,3,"div",5)(7,Y,2,1,"ion-list",6),e.k0s()),2&t&&(e.R7$(2),e.Y8G("ngIf",n.isGuardian),e.R7$(),e.Y8G("events",n.days),e.R7$(2),e.Y8G("ngIf",n.isBusy),e.R7$(),e.Y8G("ngIf",0==(null==n.days?null:n.days.length)),e.R7$(),e.Y8G("ngIf",!n.isBusy))},dependencies:[m.Sq,m.bT,u.In,u.W9,u.uz,u.he,u.nf,u.AF,p.W,$.l,G.t,o.D9,N.v,A.P],styles:["a[ion-list-header][_ngcontent-%COMP%]{text-decoration:none}.student-select[_ngcontent-%COMP%]{max-width:100%!important}p.time[_ngcontent-%COMP%]{font-size:.7em}.event[_ngcontent-%COMP%]{margin-top:2px;border-left:solid 3px}.event.highlighted[_ngcontent-%COMP%]{--background: var(--highlight) !important}.student-label[_ngcontent-%COMP%]:not(:last-child){margin-right:4px}.light-label[_ngcontent-%COMP%]{color:#000;font-size:.7em;margin-top:4px;float:right;font-weight:400!important}"]}),d})()}];let k=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[D.iI.forChild(K),D.iI]}),d})();var z=l(7019),J=l(1683);let Q=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[m.MD,_.YN,u.bv,k,z.h,o.h,J.Y]}),d})()}}]);