"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2383],{2383:(x,A,l)=>{l.r(A),l.d(A,{SchedulePageModule:()=>St});var m=l(177),I=l(9417),r=l(4742),y=l(9598),u=l(467),g=l(3207),k=l(4780),P=l(6090),v=l(5383),e=l(4438),O=l(1204),M=l(3656),S=l(230),R=l(5151),j=l(9196),W=l(8115),G=l(4078),C=l(60);function B(i,o){if(1&i&&e.nrm(0,"fa-icon",1),2&i){const s=e.XpG();e.HbH(s.color),e.Y8G("icon",s.icon)}}let $=(()=>{var i;class o{constructor(){this.userInfo={},this.faCheckCircle=v.SGM,this.faMinusCircle=v.Ip$}get attendanceCategory(){return this.activity.attendanceType?this.activity.attendanceType.attendanceCategory:"NotReported"}get color(){switch(this.userInfo.roleName){case"Admin":case"Teacher":return this.activity.reportedAttendance?"success":"";case"Guardian":case"Student":switch(this.attendanceCategory){case"Attended":return"success";case"ValidAbsence":case"GrantedAbsence":return"warning";case"InvalidAbsence":case"Late":return"danger";default:return""}default:return""}}get icon(){if(!this.userInfo)return null;switch(this.userInfo.roleName){case"Admin":case"Teacher":return this.activity.reportedAttendance?v.SGM:null;case"Guardian":case"Student":switch(this.attendanceCategory){case"Attended":return v.SGM;case"ValidAbsence":case"InvalidAbsence":case"Late":case"GrantedAbsence":return v.Ip$;default:return null}default:return null}}}return(i=o).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["attendance-status"]],hostVars:2,hostBindings:function(t,n){2&t&&e.HbH(n.color)},inputs:{activity:"activity",userInfo:"userInfo"},decls:1,vars:1,consts:[[3,"icon","class",4,"ngIf"],[3,"icon"]],template:function(t,n){1&t&&e.DNE(0,B,1,3,"fa-icon",0),2&t&&e.Y8G("ngIf",n.icon)},dependencies:[m.bT,C.aY],styles:[".danger[_ngcontent-%COMP%]{color:var(--danger)}.success[_ngcontent-%COMP%]{color:var(--success)}.warning[_ngcontent-%COMP%]{color:var(--warning)}"]}),o})();var F=l(2952),H=l(2934),E=l(7376),z=l(7586),L=l(7900),J=l(9841);let D=(()=>{var i;class o{constructor(t,n,a){this.attendanceTypes=t,this.attendanceService=n,this.dateService=a,this.isInitialized=!1,this.attendances=[],this.markedAbsent=[]}isMarkedAbsent(t){return!!this.markedAbsent.find(n=>n.studentId===t.studentId)}loadAttendancesForActivities(t){var n=this;return(0,u.A)(function*(){n.activities=t;let a=yield Promise.all(t.map(d=>{let _=z(d.date).format("L");return n.attendanceService.getActivityAttendances(d.activityId,_)})),c=E.sortBy(a.flat(),"name");n.attendances=c})()}reportAllMarkedAbsent(){var t=this;return(0,u.A)(function*(){yield t.attendanceTypes.init(),t.invalidAbsenceType=t.attendanceTypes.invalidAbsenceType;let n=t.markedAbsent.map(a=>t.reportAbsent(a));return Promise.all(n)})()}toggleAbsent(t){let n=this.markedAbsent.findIndex(a=>a.studentId===t.studentId);-1==n?this.markedAbsent.push(t):this.markedAbsent.splice(n,1)}refreshList(){this.activities&&this.loadAttendancesForActivities(this.activities)}reportAttendance(){let n=E.uniq(this.attendances.map(c=>c.eventId)).map(c=>this.attendanceService.reportAttendanceForEvent(c));return Promise.all(n).then(c=>this.updateAttendanceSubject(E.flatten(c)))}reportAttendanceForDay(t){let a=E.uniq(this.attendances.map(d=>d.eventId)).map(d=>this.attendanceService.updateAttendancesForRestOfDay(d,t));return Promise.all(a)}updateAttendance(t){return this.attendanceService.updateAttendances([t]).then(n=>this.updateAttendanceSubject(n))}updateAttendances(t){this.attendanceService.updateAttendances(t).then(n=>this.updateAttendanceSubject(n))}clearAbsentMark(t){let n=this.markedAbsent.findIndex(a=>a.studentId==t);n>-1&&this.markedAbsent.splice(n,1)}onAttendanceUpdated(t){if(!t.attendances)return;let n=!1;t.attendances.forEach(a=>{this.studentIsInList(a.studentId)&&(this.clearAbsentMark(a.studentId),n=!0)}),n&&this.refreshList()}studentIsInList(t){return this.attendances.some(n=>n.studentId==t)}reportAbsent(t){return t.attendanceTypeId=this.invalidAbsenceType.attendanceTypeId,t.isBusy=!0,this.updateAttendance(t).then(()=>{t.isBusy=!1,t.attendanceCategory=this.invalidAbsenceType.attendanceCategory,t.categoryColor=this.invalidAbsenceType.categoryColor,t.attendanceType=this.invalidAbsenceType.name})}updateAttendanceSubject(t){let n=this.attendances;for(let d=0;d<t.length;d++){var a=t[d].attendance,c=n.findIndex(_=>_.studentId==a.studentId);n[c]=a}this.attendances=n}}return(i=o).\u0275fac=function(t){return new(t||i)(e.KVO(L.a),e.KVO(J.$),e.KVO(G.k))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac}),o})();function K(i,o){1&i&&e.nrm(0,"q-spinner",3)}function Q(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-button",6),e.bIt("click",function(){e.eBV(s);const n=e.XpG(2);return e.Njj(n.onClickReportAttendance())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"REPORT_ATTENDANCE")," "))}function Z(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-button",6),e.bIt("click",function(){e.eBV(s);const n=e.XpG(2);return e.Njj(n.onClickReportAttendanceForDay())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"REPORT_ATTENDANCE_FOR_REST_OF_DAY")," "))}function q(i,o){if(1&i&&(e.j41(0,"div",4),e.DNE(1,Q,3,3,"ion-button",5)(2,Z,3,3,"ion-button",5),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.Y8G("ngIf",!s.isAttendanceReported()),e.R7$(),e.Y8G("ngIf",s.isAttendanceReported()&&s.canReportRestOfDay())}}function ee(i,o){if(1&i&&e.nrm(0,"fa-icon",14),2&i){const s=e.XpG(3);e.Y8G("icon",s.faSpinner)("fixedWidth",!0)("pulse",!0)}}function te(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-button",15),e.bIt("click",function(){e.eBV(s);const n=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.onClickReportStudentAbsent(n))}),e.j41(1,"fa-stack"),e.nrm(2,"fa-icon",16)(3,"fa-icon",17),e.k0s()()}if(2&i){const s=e.XpG().$implicit,t=e.XpG(2);e.R7$(2),e.Y8G("icon",t.faUser),e.R7$(),e.AVh("text-danger",t.isAbsent(s)),e.Y8G("icon",t.faBan)}}function ne(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-item",9),e.EFF(1),e.j41(2,"ion-buttons",10)(3,"ion-button",11),e.bIt("click",function(){const n=e.eBV(s).$implicit,a=e.XpG(2);return e.Njj(a.onClickEditStudentAttendance(n))}),e.EFF(4),e.DNE(5,ee,1,3,"fa-icon",12),e.k0s(),e.DNE(6,te,4,4,"ion-button",13),e.k0s()()}if(2&i){const s=o.$implicit,t=e.XpG(2);e.R7$(),e.SpI(" ",s.name," "),e.R7$(2),e.Y8G("color",t.attendanceButtonColor(s)),e.R7$(),e.SpI(" ",s.attendanceType," "),e.R7$(),e.Y8G("ngIf",s.isBusy),e.R7$(),e.Y8G("ngIf",!t.isAttendanceReported())}}function ie(i,o){if(1&i&&(e.j41(0,"ion-list",7),e.DNE(1,ne,7,5,"ion-item",8),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.Y8G("ngForOf",s.ds.attendances)}}let se=(()=>{var i;class o{constructor(t,n,a,c){this.ds=t,this.attendanceTypes=n,this.userAlertService=a,this.modalCtrl=c,this.isInitialized=!1,this.attendanceDialogTitle="N\xe4rvaro",this.absent=[],this.faUser=v.X46,this.faBan=v.Dfk,this.faSpinner=v.z1G}ngOnInit(){this.initView()}initView(){var t=this;return(0,u.A)(function*(){yield t.loadAttendance(),t.isInitialized=!0})()}onClickEditStudentAttendance(t){var n=this;return(0,u.A)(function*(){n.selectedAttendance=t;let a={attendance:t,attendanceTypeId:t.attendanceTypeId,minutesAbsent:t&&t.minutesAbsent,attendanceDate:t.lessonDate},c=yield n.modalCtrl.create({component:H.t,componentProps:a});c.present(),c.onDidDismiss().then(d=>{if(d&&d.data&&d.data.type){const{attendanceTypeId:_,name:h,attendanceCategory:f}=d.data.type,{minutes:p}=d.data;n.selectedAttendance.attendanceTypeId=_,n.selectedAttendance.attendanceType=h,n.selectedAttendance.attendanceCategory=f,n.selectedAttendance.minutesAbsent=p,n.ds.updateAttendance(n.selectedAttendance)}})})()}onClickReportStudentAbsent(t){this.ds.toggleAbsent(t)}onClickReportAttendance(){this.ds.reportAllMarkedAbsent().then(()=>this.ds.reportAttendance()).then(()=>{this.activities.forEach(t=>t.reportedAttendance=!0),this.loadAttendance()})}onClickReportAttendanceForDay(){this.ds.reportAttendanceForDay(this.teacherId).then(()=>this.userAlertService.alert("Sparat"))}attendanceButtonColor(t){return this.attendanceTypes.getColor(t.attendanceCategory)}attendanceType(t){return this.attendanceTypes.list.find(n=>n.attendanceTypeId==t)}isAbsent(t){return this.ds.isMarkedAbsent(t)}isAttendanceReported(){return this.activities&&!this.activities.some(t=>!t.reportedAttendance)}canReportRestOfDay(){return this.activities.some(t=>t.dayReportingOfAttendance)}loadAttendance(){var t=this;return(0,u.A)(function*(){yield t.ds.loadAttendancesForActivities(t.activities)})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.rXU(D),e.rXU(L.a),e.rXU(R.p),e.rXU(r.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["attendance-list"]],inputs:{teacherId:"teacherId",activities:"activities"},features:[e.Jv_([D])],decls:3,vars:3,consts:[["class","ion-margin-top",4,"ngIf"],["class","ion-text-center ion-padding-bottom",4,"ngIf"],["class","ion-no-padding",4,"ngIf"],[1,"ion-margin-top"],[1,"ion-text-center","ion-padding-bottom"],["color","success",3,"click",4,"ngIf"],["color","success",3,"click"],[1,"ion-no-padding"],["class","attendance-list-item ion-no-padding",4,"ngFor","ngForOf"],[1,"attendance-list-item","ion-no-padding"],["slot","end",1,"ion-no-margin-horizontal"],["size","small",3,"click","color"],[3,"icon","fixedWidth","pulse",4,"ngIf"],["fill","clear","size","small",3,"click",4,"ngIf"],[3,"icon","fixedWidth","pulse"],["fill","clear","size","small",3,"click"],["stackItemSize","1x",3,"icon"],["stackItemSize","2x",3,"icon"]],template:function(t,n){1&t&&e.DNE(0,K,1,0,"q-spinner",0)(1,q,3,2,"div",1)(2,ie,2,1,"ion-list",2),2&t&&(e.Y8G("ngIf",!n.isInitialized),e.R7$(),e.Y8G("ngIf",n.isInitialized&&(!n.isAttendanceReported()||n.canReportRestOfDay())),e.R7$(),e.Y8G("ngIf",n.isInitialized))},dependencies:[r.Jm,r.QW,r.uz,r.nf,m.Sq,m.bT,C.aY,C.lJ,C.TM,F.t,S.D9],styles:[".attendance-list-item[_ngcontent-%COMP%]   [slot=end][_ngcontent-%COMP%]{margin:0}.attendance-list-item[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{padding-right:0!important}.attendance-list-item[_ngcontent-%COMP%]   [ion-button][_ngcontent-%COMP%]{padding:0 .3em}.text-danger[_ngcontent-%COMP%]{color:var(--danger)}"]}),o})();var ae=l(3543),oe=l(8775);function ce(i,o){if(1&i&&(e.j41(0,"ion-title"),e.EFF(1),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.JRh(s.studentName)}}function re(i,o){1&i&&e.nrm(0,"q-spinner",6)}function le(i,o){if(1&i){const s=e.RV6();e.j41(0,"div",7)(1,"ion-segment",8),e.mxI("ngModelChange",function(n){e.eBV(s);const a=e.XpG();return e.DH7(a.activeView,n)||(a.activeView=n),e.Njj(n)}),e.j41(2,"ion-segment-button",9),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"ion-segment-button",10),e.EFF(6),e.nI1(7,"translate"),e.k0s()()()}if(2&i){const s=e.XpG();e.R7$(),e.R50("ngModel",s.activeView),e.R7$(2),e.SpI(" ",e.bMT(4,3,"LESSON_INFO")," "),e.R7$(3),e.SpI(" ",e.bMT(7,5,"ATTENDANCE")," ")}}function de(i,o){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const s=o.$implicit;e.R7$(),e.SpI(" ",s," ")}}function ue(i,o){if(1&i&&(e.j41(0,"div"),e.DNE(1,de,2,1,"div",19),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.Y8G("ngForOf",null==s.activity?null:s.activity.teacherNames)}}function _e(i,o){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.SpI(" ",null==s.activity?null:s.activity.teacherNames," ")}}function he(i,o){if(1&i&&e.nrm(0,"attendance-status",20),2&i){const s=e.XpG(2);e.Y8G("activity",s.activity)("userInfo",s.userInfo)}}function fe(i,o){1&i&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.JRh(e.bMT(2,1,"LESSON_PLAN_MISSING")))}function ge(i,o){if(1&i&&(e.nrm(0,"ion-textarea",28),e.nI1(1,"nlHtml"),e.nI1(2,"safe")),2&i){const s=e.XpG(5);e.Y8G("innerHtml",e.bMT(2,3,e.bMT(1,1,s.lessonInfo)),e.npT)}}function me(i,o){if(1&i&&(e.nrm(0,"ion-textarea",28),e.nI1(1,"nlHtml"),e.nI1(2,"safe")),2&i){const s=e.XpG(5);e.Y8G("innerHtml",e.bMT(2,3,e.bMT(1,1,s.activity.publicInfo)),e.npT)}}function pe(i,o){if(1&i&&(e.j41(0,"ion-item",25)(1,"ion-label",26),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,ge,3,5,"ion-textarea",27)(5,me,3,5,"ion-textarea",27),e.k0s()),2&i){const s=e.XpG(4);e.R7$(2),e.SpI(" ",e.bMT(3,3,"ON_THIS_LESSON")," "),e.R7$(2),e.Y8G("ngIf",!s.isTeacher&&!s.mergeActivity),e.R7$(),e.Y8G("ngIf",!s.isTeacher&&s.mergeActivity)}}function ve(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-textarea",30),e.mxI("ngModelChange",function(n){e.eBV(s);const a=e.XpG(5);return e.DH7(a.lessonInfo,n)||(a.lessonInfo=n),e.Njj(n)}),e.k0s()}if(2&i){const s=e.XpG(5);e.R50("ngModel",s.lessonInfo)}}function Ie(i,o){if(1&i&&(e.j41(0,"ion-item",13)(1,"ion-label",26),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,ve,1,1,"ion-textarea",29),e.k0s()),2&i){const s=e.XpG(4);e.R7$(2),e.SpI(" ",e.bMT(3,2,"ON_THIS_LESSON")," "),e.R7$(2),e.Y8G("ngIf",s.isTeacher)}}function ye(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-button",34),e.bIt("click",function(){e.eBV(s);const n=e.XpG().index,a=e.XpG(5);return e.Njj(a.onSave(n))}),e.nrm(1,"fa-icon",35),e.k0s()}if(2&i){const s=e.XpG(6);e.R7$(),e.Y8G("icon",s.faSave)}}function Se(i,o){if(1&i){const s=e.RV6();e.qex(0),e.j41(1,"ion-item",13)(2,"ion-label",26),e.EFF(3),e.nI1(4,"translate"),e.j41(5,"span",31),e.EFF(6),e.k0s()(),e.j41(7,"ion-textarea",30),e.mxI("ngModelChange",function(n){const a=e.eBV(s).index,c=e.XpG(5);return e.DH7(c.listOfLessons[a].publicInfo,n)||(c.listOfLessons[a].publicInfo=n),e.Njj(n)}),e.bIt("ngModelChange",function(){const n=e.eBV(s).index,a=e.XpG(5);return e.Njj(a.onLessonInfoChange(n))}),e.k0s()(),e.j41(8,"div",32),e.DNE(9,ye,2,1,"ion-button",33),e.k0s(),e.bVm()}if(2&i){const s=o.$implicit,t=o.index,n=e.XpG(5);e.R7$(3),e.SpI(" ",e.bMT(4,4,"ON_THIS_LESSON")," "),e.R7$(3),e.SpI("(",null==s||null==s.event?null:s.event.name,")"),e.R7$(),e.R50("ngModel",n.listOfLessons[t].publicInfo),e.R7$(2),e.Y8G("ngIf",n.lessonInfoChanged[t])}}function Te(i,o){if(1&i&&(e.qex(0),e.DNE(1,Se,10,6,"ng-container",19),e.bVm()),2&i){const s=e.XpG(4);e.R7$(),e.Y8G("ngForOf",s.listOfLessons)}}function Pe(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-button",34),e.bIt("click",function(){e.eBV(s);const n=e.XpG(5);return e.Njj(n.onClickSave())}),e.nrm(1,"fa-icon",35),e.k0s()}if(2&i){const s=e.XpG(5);e.R7$(),e.Y8G("icon",s.faSave)}}function be(i,o){if(1&i&&(e.j41(0,"div",32),e.DNE(1,Pe,2,1,"ion-button",33),e.k0s()),2&i){const s=e.XpG(4);e.R7$(),e.Y8G("ngIf",s.lessonInfoHasChanged)}}function Ae(i,o){if(1&i&&(e.qex(0),e.j41(1,"h2"),e.EFF(2),e.k0s(),e.j41(3,"p"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.nrm(6,"p",36),e.nI1(7,"nlHtml"),e.nI1(8,"safe"),e.bVm()),2&i){const s=o.$implicit;e.R7$(2),e.JRh(s.name),e.R7$(2),e.Lme("",e.bMT(5,4,"ASSESSMENT"),": ",s.assessment,""),e.R7$(2),e.Y8G("innerHtml",e.bMT(8,8,e.bMT(7,6,s.description)),e.npT)}}function ke(i,o){if(1&i&&(e.qex(0),e.j41(1,"div",21),e.DNE(2,pe,6,5,"ion-item",22)(3,Ie,5,4,"ion-item",23)(4,Te,2,1,"ng-container",2)(5,be,2,1,"div",24),e.k0s(),e.DNE(6,Ae,9,10,"ng-container",19),e.bVm()),2&i){const s=e.XpG(3);e.R7$(2),e.Y8G("ngIf",!s.isTeacher),e.R7$(),e.Y8G("ngIf",s.isTeacher&&!s.mergeActivity),e.R7$(),e.Y8G("ngIf",s.isTeacher&&s.mergeActivity&&s.listOfLessons.length>0),e.R7$(),e.Y8G("ngIf",!s.mergeActivity),e.R7$(),e.Y8G("ngForOf",s.coursePlanParts)}}function Ce(i,o){if(1&i&&(e.j41(0,"div",11),e.DNE(1,fe,3,3,"div",2)(2,ke,7,5,"ng-container",2),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.Y8G("ngIf",!s.lesson),e.R7$(),e.Y8G("ngIf",s.lesson)}}function Re(i,o){1&i&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"COURSE_PLAN_MISSING")," "))}function Ee(i,o){if(1&i&&(e.nrm(0,"div",36),e.nI1(1,"nlHtml"),e.nI1(2,"safe")),2&i){const s=e.XpG(3);e.Y8G("innerHtml",e.bMT(2,3,e.bMT(1,1,s.coursePlanDescription)),e.npT)}}function Oe(i,o){if(1&i&&(e.j41(0,"div",11),e.DNE(1,Re,3,3,"div",2)(2,Ee,3,5,"div",37),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.Y8G("ngIf",!s.coursePlanDescription),e.R7$(),e.Y8G("ngIf",s.coursePlanDescription)}}function Me(i,o){if(1&i){const s=e.RV6();e.qex(0),e.j41(1,"div",11)(2,"ion-item",12)(3,"ion-label")(4,"h2"),e.EFF(5),e.k0s(),e.j41(6,"h3"),e.EFF(7),e.k0s(),e.j41(8,"h4"),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"p"),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.j41(14,"p"),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.j41(17,"p")(18,"ion-grid",13)(19,"ion-row")(20,"ion-col",14),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.j41(23,"ion-col"),e.DNE(24,ue,2,1,"div",2)(25,_e,2,1,"div",2),e.k0s()()()(),e.j41(26,"p",15),e.EFF(27),e.nI1(28,"translate"),e.DNE(29,he,1,2,"attendance-status",16),e.EFF(30),e.k0s()()()(),e.j41(31,"div",7)(32,"ion-segment",8),e.mxI("ngModelChange",function(n){e.eBV(s);const a=e.XpG();return e.DH7(a.planningView,n)||(a.planningView=n),e.Njj(n)}),e.j41(33,"ion-segment-button",17),e.EFF(34),e.nI1(35,"translate"),e.k0s(),e.j41(36,"ion-segment-button",18),e.EFF(37),e.nI1(38,"translate"),e.k0s()()(),e.DNE(39,Ce,3,2,"div",5)(40,Oe,3,2,"div",5),e.bVm()}if(2&i){const s=e.XpG();e.R7$(4),e.xc7("border-color",null==s.activity?null:s.activity.color),e.R7$(),e.SpI(" ",null==s.activity?null:s.activity.subjectName," "),e.R7$(2),e.Lme("",null==s.activity?null:s.activity.startTime," - ",null==s.activity?null:s.activity.endTime,""),e.R7$(2),e.SpI(" ",e.bMT(10,21,(null==s.activity?null:s.activity.locationName)||"NO_LOCATION_REGISTERED")," "),e.R7$(3),e.Lme("",e.bMT(13,23,"COURSE"),": ",null==s.activity?null:s.activity.courseName,""),e.R7$(3),e.Lme("",e.bMT(16,25,"GROUP"),": ",null==s.activity?null:s.activity.teachingGroupName,""),e.R7$(6),e.SpI("",e.bMT(22,27,"TEACHER"),":\xa0"),e.R7$(3),e.Y8G("ngIf",!s.mergeActivity),e.R7$(),e.Y8G("ngIf",s.mergeActivity),e.R7$(2),e.SpI(" ",e.bMT(28,29,"ATTENDANCE"),": "),e.R7$(2),e.Y8G("ngIf","NotReported"!=(null==s.activity||null==s.activity.attendanceType?null:s.activity.attendanceType.attendanceCategory)),e.R7$(),e.SpI(" ",null==s.activity||null==s.activity.attendanceType?null:s.activity.attendanceType.name," "),e.R7$(2),e.R50("ngModel",s.planningView),e.R7$(2),e.SpI(" ",e.bMT(35,31,"LESSON_PLAN")," "),e.R7$(3),e.SpI(" ",e.bMT(38,33,"COURSE_PLAN")," "),e.R7$(2),e.Y8G("ngIf","lessonplan"==s.planningView),e.R7$(),e.Y8G("ngIf","courseplan"==s.planningView)}}function je(i,o){1&i&&(e.j41(0,"div",40),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"ATTENDANCE_IN_FUTURE_NOT_ALLOWED")," "))}function Ge(i,o){if(1&i&&e.nrm(0,"attendance-list",41),2&i){const s=e.XpG(2);e.Y8G("activities",s.activities)("teacherId",s.teacherId)}}function Fe(i,o){if(1&i&&(e.j41(0,"div",11),e.DNE(1,je,3,3,"div",38)(2,Ge,1,2,"attendance-list",39),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.Y8G("ngIf",s.isInFuture),e.R7$(),e.Y8G("ngIf",!s.isInFuture)}}let Ne=(()=>{var i;class o extends P.v{constructor(t,n,a,c,d,_,h,f,p,T,b){super(t,a,n,c,d,_),this.lessonService=h,this.dateService=f,this.modalCtrl=p,this.route=T,this.navParams=b,this.isBusy=!0,this.isSearching=!1,this.planningView="lessonplan",this.userInfo={},this.faSave=v.hSh,this.mergedActivities=[],this.mergeActivity=!1,this.listOfLessons=[],this.lessonInfoChanged=[]}ngOnInit(){const t=this.userInfoProvider.userInfoState.subscribe(n=>{this.userInfo=n});this.addSub(t)}get activities(){return this.activity?this.activity.merged||[this.activity]:[]}get attendanceVisible(){return(this.isAdmin||this.isTeacher)&&this.attendanceEnabled}get coursePlanDescription(){return this.lesson?this.lesson.coursePlanDescription:""}get coursePlanParts(){return this.lesson?this.lesson.coursePlanParts:[]}get isInFuture(){let t=this.dateService.today();return this.dateService.isBefore(t,this.activity.date)}get teacherId(){return this.userInfo?this.userInfo.teacherId:void 0}ionViewWillEnter(){var t=this;return(0,u.A)(function*(){if(t.activity=t.navParams.get("activity"),Array.isArray(t.activity.merged)&&t.activity.merged.length>0){console.log("this.activity.merged:",t.activity),t.mergedActivities=t.activity.merged,t.activity.courseName=t.activity.merged[0].courseName,t.activity.subjectName=t.activity.merged[0].subjectName;let n=[];t.mergedActivities.forEach(a=>{Array.isArray(a.teacherNames)&&n.push(...a.teacherNames)}),t.activity.teacherNames=[...new Set(n)].join(", "),t.mergeActivity=!0}t.event=t.navParams.get("event"),t.attendanceEnabled=!!t.navParams.get("attendanceEnabled"),t.activeView=t.getStartView(),t.mergeActivity?(yield t.getLessonInfo(),t.listOfLessons.length>0&&(t.lesson=t.listOfLessons[0])):(t.lesson=yield t.lessonService.getLesson(t.activity.lessonId),t.lessonInfo=t.lesson.publicInfo),t.isBusy=!1})()}getLessonInfo(){var t=this;return(0,u.A)(function*(){t.lessonInfoChanged=[],t.listOfLessons=[];for(const n of t.mergedActivities)try{let a=yield t.lessonService.getLesson(n.lessonId);t.listOfLessons.push(a),t.lessonInfoChanged.push(!1)}catch(a){console.error("Error fetching lesson:",a)}})()}onLessonInfoChange(t){this.lessonInfoChanged[t]=!0}onClickSave(){var t=this;return(0,u.A)(function*(){t.withSpinner((0,u.A)(function*(){let n=Object.assign({},t.lesson,{publicInfo:t.lessonInfo});yield t.lessonService.updateLesson(n),t.lesson=n}),"Sparar lektionsinfo")})()}onSave(t){var n=this;return(0,u.A)(function*(){n.mergeActivity&&n.withSpinner((0,u.A)(function*(){let a=Object.assign({},n.listOfLessons[t],{publicInfo:n.listOfLessons[t].publicInfo});yield n.lessonService.updateLesson(a),n.listOfLessons[t]={...a},n.lessonInfoChanged[t]=!1}),"Sparar lektionsinfo")})()}get isAdmin(){return this.userInfo&&"Admin"==this.userInfo.roleName}get isTeacher(){return this.userInfo&&"Teacher"==this.userInfo.roleName}get lessonInfoHasChanged(){return this.lesson&&this.lessonInfo!==this.lesson.publicInfo}getStartView(){return"Teacher"!==this.userInfo.roleName||this.isInFuture?"lessoninfo":"attendance"}dismiss(){this.modalCtrl.dismiss()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.rXU(O.$),e.rXU(r.Xi),e.rXU(y.Ix),e.rXU(S.c$),e.rXU(R.p),e.rXU(j.Z),e.rXU(W.u),e.rXU(G.k),e.rXU(r.W3),e.rXU(y.nX),e.rXU(M.y8))},i.\u0275cmp=e.VBU({type:i,selectors:[["page-lesson"]],features:[e.Vt3],decls:12,vars:8,consts:[["slot","start"],["size","large","fill","clear",3,"click"],[4,"ngIf"],["class","ion-margin-top",4,"ngIf"],["class","ion-padding",4,"ngIf"],["class","ion-padding-horizontal",4,"ngIf"],[1,"ion-margin-top"],[1,"ion-padding"],["color","action",3,"ngModelChange","ngModel"],["value","lessoninfo"],["value","attendance"],[1,"ion-padding-horizontal"],[1,"event","ion-no-padding"],[1,"ion-no-padding"],["size","auto"],[1,"attendance"],[3,"activity","userInfo",4,"ngIf"],["value","lessonplan"],["value","courseplan"],[4,"ngFor","ngForOf"],[3,"activity","userInfo"],[1,"ion-padding-bottom"],["class","ion-no-padding","lines","none",4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["class","ion-text-right",4,"ngIf"],["lines","none",1,"ion-no-padding"],["position","stacked"],["readonly","",3,"innerHtml",4,"ngIf"],["readonly","",3,"innerHtml"],["autosize","",3,"ngModel","ngModelChange",4,"ngIf"],["autosize","",3,"ngModelChange","ngModel"],[2,"font-size","12px","color","rgb(168, 168, 168)"],[1,"ion-text-right"],["color","success","size","small",3,"click",4,"ngIf"],["color","success","size","small",3,"click"],[3,"icon"],[3,"innerHtml"],[3,"innerHtml",4,"ngIf"],["class","text-center",4,"ngIf"],[3,"activities","teacherId",4,"ngIf"],[1,"text-center"],[3,"activities","teacherId"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return n.dismiss()}),e.EFF(4),e.nI1(5,"translate"),e.k0s()(),e.DNE(6,ce,2,1,"ion-title",2),e.k0s()(),e.j41(7,"ion-content"),e.DNE(8,re,1,0,"q-spinner",3)(9,le,8,7,"div",4)(10,Me,41,35,"ng-container",2)(11,Fe,3,2,"div",5),e.k0s()),2&t&&(e.R7$(4),e.SpI(" ",e.bMT(5,6,"CLOSE")," "),e.R7$(2),e.Y8G("ngIf",!n.isSearching),e.R7$(2),e.Y8G("ngIf",n.isBusy),e.R7$(),e.Y8G("ngIf",!n.isBusy&&n.attendanceVisible),e.R7$(),e.Y8G("ngIf",!n.isBusy&&"lessoninfo"===n.activeView),e.R7$(),e.Y8G("ngIf",!n.isBusy&&"attendance"===n.activeView))},dependencies:[m.Sq,m.bT,I.BC,I.vS,r.Jm,r.QW,r.hU,r.W9,r.lO,r.eU,r.uz,r.he,r.ln,r.Gp,r.eP,r.nc,r.BC,r.ai,r.Je,r.Gw,$,F.t,se,C.aY,S.D9,ae.m,oe.V],styles:["ion-item.event[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{padding-right:0!important}ion-item.event[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0}ion-item.event[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{padding-bottom:.1em;margin-bottom:.2em;border-bottom:5px solid}ion-item.event[_ngcontent-%COMP%]   .attendance[_ngcontent-%COMP%]{font-size:.8em}"]}),o})();var xe=l(8330),X=l(8292),V=l(6969),$e=l(2129),Le=l(6244),De=l(6186);let Xe=(()=>{var i;class o extends $e.h{constructor(t,n){super(t,n),this.listEndpoint="api/locations/list"}}return(i=o).\u0275fac=function(t){return new(t||i)(e.KVO(Le.j),e.KVO(De.B))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),o})();function Ve(i,o){if(1&i){const s=e.RV6();e.j41(0,"div",10)(1,"ion-button",11),e.bIt("click",function(){e.eBV(s);const n=e.XpG();return e.Njj(n.pickMySchedule())}),e.EFF(2),e.nI1(3,"translate"),e.k0s()()}2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"SHOW_MY_SCHEDULE")," "))}function we(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-item",13),e.bIt("click",function(){const n=e.eBV(s).$implicit,a=e.XpG(2);return e.Njj(a.onClickItem(n))}),e.EFF(1),e.k0s()}if(2&i){const s=o.$implicit;e.R7$(),e.SpI(" ",s.name," ")}}function Ue(i,o){if(1&i&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,we,2,1,"ion-item",12),e.k0s()()),2&i){const s=e.XpG();e.R7$(2),e.Y8G("ngForOf",s.teachers)}}function Ye(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-item",13),e.bIt("click",function(){const n=e.eBV(s).$implicit,a=e.XpG(2);return e.Njj(a.onClickItem(n))}),e.EFF(1),e.k0s()}if(2&i){const s=o.$implicit;e.R7$(),e.SpI(" ",s.name," ")}}function We(i,o){if(1&i&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,Ye,2,1,"ion-item",12),e.k0s()()),2&i){const s=e.XpG();e.R7$(2),e.Y8G("ngForOf",s.students)}}function Be(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-item",13),e.bIt("click",function(){const n=e.eBV(s).$implicit,a=e.XpG(2);return e.Njj(a.onClickItem(n))}),e.EFF(1),e.k0s()}if(2&i){const s=o.$implicit;e.R7$(),e.SpI(" ",s.name," ")}}function He(i,o){if(1&i&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,Be,2,1,"ion-item",12),e.k0s()()),2&i){const s=e.XpG();e.R7$(2),e.Y8G("ngForOf",s.locations)}}let ze=(()=>{var i;class o{constructor(t,n,a,c,d,_,h,f,p,T,b){this.account=t,this.loadingCtrl=n,this.navCtrl=a,this.navParams=c,this.translateService=d,this.userAlertService=_,this.userInfoProvider=h,this.teachersProvider=f,this.studentsProvider=p,this.locationsProvider=T,this.modalCtrl=b,this.teachers=[],this.students=[],this.locations=[],this.userInfo={},this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.userInfoProvider.userInfoState.subscribe(t=>this.userInfo=t))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}ionViewWillEnter(){this.initView()}onChangeType(){this.initObjectList()}onClickItem(t){this.dismiss(t)}pickMySchedule(){var t=this;return(0,u.A)(function*(){let n=t.userInfo;t.isTeacher?(t.type="Teacher",t.dismiss({id:n.teacherId.toString(),name:n.userFullName})):t.isStudent&&(t.type="Student",t.dismiss({id:n.studentId.toString(),name:n.userFullName}))})()}get isTeacher(){return this.userInfo&&"Teacher"==this.userInfo.roleName}get isStudent(){return this.userInfo&&"Student"==this.userInfo.roleName}get isTeacherOrStudent(){return this.isTeacher||this.isStudent}get scheduleObjectLabel(){return this.translations&&this.type?this.translations[this.type.toUpperCase()]:""}dismiss(t){t?this.modalCtrl.dismiss({item:t,type:this.type,id:t.id}):this.modalCtrl.dismiss()}initView(){var t=this;return(0,u.A)(function*(){t.type=t.navParams.get("type"),t.initObjectList(),t.translations=yield(0,g.s)(t.translateService.get(["TEACHER","STUDENT","LOCATION"]))})()}initObjectList(){var t=this;return(0,u.A)(function*(){switch(t.type){case"Teacher":t.teachers.length||(yield t.teachersProvider.init(),t.teachers=t.teachersProvider.list);break;case"Student":t.students.length||(yield t.studentsProvider.init(),t.students=t.studentsProvider.list);break;case"Location":t.locations.length||(yield t.locationsProvider.init(),t.locations=t.locationsProvider.list)}})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.rXU(O.$),e.rXU(r.Xi),e.rXU(M.q9),e.rXU(M.y8),e.rXU(S.c$),e.rXU(R.p),e.rXU(j.Z),e.rXU(X.H),e.rXU(V.s),e.rXU(Xe),e.rXU(r.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["page-schedule-picker"]],decls:26,vars:19,consts:[["slot","start"],["fill","clear",3,"click"],["class","ion-padding-horizontal",4,"ngIf"],[1,"ion-padding"],["color","action",3,"ngModelChange","ionChange","ngModel"],["value","Teacher"],["value","Student"],["value","Location"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"ion-padding-horizontal"],["fill","clear","expand","block",3,"click"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return n.dismiss()}),e.j41(4,"span"),e.EFF(5),e.nI1(6,"translate"),e.k0s()()(),e.j41(7,"ion-title"),e.EFF(8),e.k0s()()(),e.j41(9,"ion-content"),e.DNE(10,Ve,4,3,"div",2),e.j41(11,"div",3)(12,"ion-segment",4),e.mxI("ngModelChange",function(c){return e.DH7(n.type,c)||(n.type=c),c}),e.bIt("ionChange",function(){return n.onChangeType()}),e.j41(13,"ion-segment-button",5),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"ion-segment-button",6),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"ion-segment-button",7),e.EFF(20),e.nI1(21,"translate"),e.k0s()()(),e.j41(22,"div",8),e.DNE(23,Ue,3,1,"div",9)(24,We,3,1,"div",9)(25,He,3,1,"div",9),e.k0s()()),2&t&&(e.R7$(5),e.JRh(e.bMT(6,11,"CANCEL")),e.R7$(3),e.JRh(n.title),e.R7$(2),e.Y8G("ngIf",n.isTeacherOrStudent),e.R7$(2),e.R50("ngModel",n.type),e.R7$(2),e.SpI(" ",e.bMT(15,13,"TEACHER")," "),e.R7$(3),e.SpI(" ",e.bMT(18,15,"STUDENT")," "),e.R7$(3),e.SpI(" ",e.bMT(21,17,"LOCATION")," "),e.R7$(2),e.Y8G("ngSwitch",n.type),e.R7$(),e.Y8G("ngSwitchCase","Teacher"),e.R7$(),e.Y8G("ngSwitchCase","Student"),e.R7$(),e.Y8G("ngSwitchCase","Location"))},dependencies:[m.Sq,m.bT,m.ux,m.e1,r.Jm,r.QW,r.W9,r.eU,r.uz,r.nf,r.Gp,r.eP,r.BC,r.ai,r.Je,I.BC,I.vS,S.D9],encapsulation:2}),o})();class N{constructor(o){this.left=0,this.right=1,this.scheduleActivity=o,this.startTime=o.startTime,this.endTime=o.endTime}collidesWith(o){return!(this.endTime<o.startTime||o.endTime<this.startTime)}static compare(o,s){return o.startTime<s.startTime?-1:s.startTime<o.startTime?1:o.endTime<s.endTime?-1:s.endTime<o.endTime?1:0}}let Je=(()=>{var i;class o{layoutItems(t){let n=[],a=null,c=t.sort(N.compare);for(let d=0;d<c.length;d++){let _=c[d];_.startTime>=a&&(this.packItems(n),n=[],a=null);let h=!1;for(let f=0;f<n.length;f++){let p=n[f];if(!p[p.length-1].collidesWith(_)){p.push(_),h=!0;break}}h||n.push([_]),(null==a||_.endTime>a)&&(a=_.endTime)}n.length>0&&this.packItems(n)}packItems(t){let n=t.length,a=0;for(let c=0;c<t.length;c++){let d=t[c];for(let _=0;_<d.length;_++){let h=d[_],f=this.expandItem(h,a,t);h.left=a/n,h.right=(a+f)/n}a++}}expandItem(t,n,a){let c=1,d=a.slice(n+1);for(let _=0;_<d.length;_++){let h=d[_];for(let f=0;f<h.length;f++){if(t.collidesWith(h[f]))return c;c++}}return c}}return(i=o).\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac}),o})();var w=l(6625),U=l(1261);function Ke(i,o){if(1&i&&(e.j41(0,"ion-col",12)(1,"div",13),e.EFF(2),e.k0s()()),2&i){const s=o.$implicit;e.AVh("header-date-today",s.isToday),e.R7$(2),e.Lme(" ",s.weekDay," ",s.date," ")}}function Qe(i,o){if(1&i&&(e.j41(0,"div",14),e.EFF(1),e.k0s()),2&i){const s=o.$implicit;e.Y8G("id",s),e.R7$(),e.SpI(" ",s," ")}}function Ze(i,o){if(1&i&&e.nrm(0,"fa-icon",24),2&i){const s=e.XpG(3);e.Y8G("icon",s.faCheckCircle)}}function qe(i,o){if(1&i&&(e.j41(0,"div",18),e.DNE(1,Ze,1,1,"fa-icon",19),e.j41(2,"div",20),e.EFF(3),e.k0s(),e.j41(4,"div",21),e.EFF(5),e.k0s(),e.j41(6,"div",22),e.EFF(7),e.k0s(),e.j41(8,"div",23),e.EFF(9),e.k0s()()),2&i){const s=o.$implicit,t=e.XpG(2);e.xc7("border-left-color",s.activity.color)("top",s.top)("height",s.height)("left",s.left)("width",s.width),e.R7$(),e.Y8G("ngIf",s.activity.reportedAttendance&&t.attendanceVisible),e.R7$(2),e.Lme(" ",s.activity.startTime," - ",s.activity.endTime," "),e.R7$(2),e.JRh(s.activity.subjectName),e.R7$(2),e.JRh(s.activity.locationName),e.R7$(2),e.JRh(s.activity.publicInfo)}}function et(i,o){if(1&i&&(e.j41(0,"ion-col",15)(1,"div",16),e.DNE(2,qe,10,16,"div",17),e.k0s()()),2&i){const s=o.index,t=e.XpG();e.R7$(),e.Mz_("id","day-",s,""),e.R7$(),e.Y8G("ngForOf",t.getScheduleActivities(s))}}let nt=(()=>{var i;class o extends P.v{constructor(t,n,a,c,d,_,h,f,p,T,b){super(t,a,n,c,d,_),this.dateService=h,this.screenOrientation=f,this.modalCtrl=p,this.scheduleService=T,this.navParams=b,this.isInitializing=!0,this.weekDayHeaders=[],this.scheduleDays=[],this.hours=[],this.days=[],this.faCheckCircle=v.SGM,this.userInfo={}}ngOnInit(){this.addSub(this.userInfoProvider.userInfoState.subscribe(t=>this.userInfo=t))}ionViewWillEnter(){this.initView()}forward(){this.date=this.dateService.addDays(this.date,7),this.withSpinner(()=>this.buildView(this.date))}back(){this.date=this.dateService.subDays(this.date,7),this.withSpinner(()=>this.buildView(this.date))}jumpToToday(){this.date=new Date(Date.now()),this.withSpinner(()=>this.buildView(this.date))}getScheduleActivities(t){return this.days.length>=t-1?this.days[t]:[]}get attendanceVisible(){return this.isTeacher||this.isAdmin}get isGuardian(){return this.userInfo&&("Guardian"==this.userInfo.roleName||"StudentAssistant"==this.userInfo.roleName)}get isTeacher(){return this.userInfo&&"Teacher"==this.userInfo.roleName}get isAdmin(){return this.userInfo&&("Admin"==this.userInfo.roleName||"StudentAdmin"===this.userInfo.roleName)}initView(){var t=this;return(0,u.A)(function*(){t.date=new Date(t.navParams.get("date")),t.type=t.navParams.get("type"),t.id=+t.navParams.get("id"),t.withSpinner(()=>t.buildView(t.date))})()}buildView(t){var n=this;return(0,u.A)(function*(){n.title=yield n.createTitle(n.date),n.weekDayHeaders=n.createWeekDayHeaders(n.date),n.hours=n.createHours(),n.addSub(n.screenOrientation.onChange().subscribe(()=>{-1===n.screenOrientation.type.indexOf("landscape")&&n.modalCtrl.dismiss()})),yield n.loadSchedule(),n.renderSchedule(),n.scrollToFirstActivities()})()}createHours(){let t=[];for(let n=0;n<24;n++)t.push(`${n<10?"0":""}${n}:00`);return t}createWeekDayHeaders(t){let n=[],a=this.dateService.startOfWeek(t);for(let c=0;c<5;c++){let d=this.dateService.addDays(a,c),_=this.dateService.formatDateShort(d),h=this.dateService.formatWeekDayShort(d),f=this.dateService.isSameDay(d,Date.now());n.push({date:_,weekDay:h,isToday:f})}return n}loadSchedule(){var t=this;return(0,u.A)(function*(){let n=t.dateService.startOfWeek(t.date),a=[0,1,2,3,4].map(c=>t.dateService.addDays(n,c));t.scheduleDays=yield t.scheduleService.getSchedule(t.type,t.id,a),t.scheduleDays.forEach(c=>c.scheduleActivities.forEach(d=>d.endTime=t.scheduleService.calculateEndTime(d.startTime,d.duration)))})()}renderSchedule(){let t=this.scheduleDays.map((n,a)=>this.createDayLayout(n,a));this.days=t}createTitle(t){var n=this;return(0,u.A)(function*(){return`${yield n.translate("WEEK_SHORT","Vecka")} ${n.dateService.getIsoWeek(t)}`})()}createDayLayout(t,n){let a=this.getDayColumnWidth(n);return t.scheduleActivities.map(c=>this.createLayoutItem(c)).sort(N.compare).map(c=>this.createWeekScheduleActivity(c,a))}createLayoutItem(t){return new N(t)}createWeekScheduleActivity(t,n){return{activity:t.scheduleActivity,top:this.calculateActivityTop(t),height:this.calculateActivityHeight(t),left:this.calculateActivityLeft(t,n),width:this.calculateActivityWidth(t,n),isFirst:0===t.left,isLast:1===t.right}}calculateActivityTop(t){let n=t.scheduleActivity.startTime.split(":");return`${60*Number(n[0])+Number(n[1])}px`}calculateActivityHeight(t){return`${t.scheduleActivity.duration}px`}calculateActivityLeft(t,n){let a=t.left*n;return a+=2,`${a}px`}calculateActivityWidth(t,n){let a=(t.right-t.left)*n;return a-=0===t.left?2:1,a-=1===t.right?2:1,`${a}px`}getDayColumnWidth(t){return document.getElementById("day-"+t).clientWidth}scrollToFirstActivities(){let t=E(this.scheduleDays).map(n=>n.scheduleActivities||[]).flatten().orderBy(n=>n.startTime).first();if(t&&t.startTime){const n=+t.startTime.split(":")[0];this.content.scrollToPoint(0,60*n,500)}else console.warn("No valid activity found or startTime missing")}}return(i=o).\u0275fac=function(t){return new(t||i)(e.rXU(O.$),e.rXU(r.Xi),e.rXU(y.Ix),e.rXU(S.c$),e.rXU(R.p),e.rXU(j.Z),e.rXU(G.k),e.rXU(w.Z),e.rXU(r.W3),e.rXU(U.l),e.rXU(M.y8))},i.\u0275cmp=e.VBU({type:i,selectors:[["page-week-schedule"]],viewQuery:function(t,n){if(1&t&&e.GBs(r.W9,5),2&t){let a;e.mGM(a=e.lsd())&&(n.content=a.first)}},features:[e.Jv_([Je]),e.Vt3],decls:24,vars:4,consts:[[1,"ion-no-padding"],[1,"schedule-header","ion-no-padding"],[1,"time-column","column-header"],[1,"ion-text-center",3,"click"],["name","chevron-back"],["name","chevron-forward"],["class","day-column column-header",3,"header-date-today",4,"ngFor","ngForOf"],[1,"schedule-content","ion-no-padding"],[1,"time-column"],[1,"column-content"],["class","hour ion-text-end",3,"id",4,"ngFor","ngForOf"],["class","day-column",4,"ngFor","ngForOf"],[1,"day-column","column-header"],[1,"week-day-header","ion-text-center"],[1,"hour","ion-text-end",3,"id"],[1,"day-column"],[1,"column-content",3,"id"],["class","week-schedule-activity",3,"border-left-color","top","height","left","width",4,"ngFor","ngForOf"],[1,"week-schedule-activity"],["class","attendance-reported ion-float-right",3,"icon",4,"ngIf"],[1,"time"],[1,"subject"],[1,"location"],[1,"info"],[1,"attendance-reported","ion-float-right",3,"icon"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",0)(2,"ion-grid",1)(3,"ion-row")(4,"ion-col",2)(5,"ion-grid",0)(6,"ion-row")(7,"ion-col",3),e.bIt("click",function(){return n.back()}),e.j41(8,"span"),e.nrm(9,"ion-icon",4),e.k0s()(),e.j41(10,"ion-col",3),e.bIt("click",function(){return n.jumpToToday()}),e.j41(11,"span"),e.EFF(12),e.k0s()(),e.j41(13,"ion-col",3),e.bIt("click",function(){return n.forward()}),e.j41(14,"span"),e.nrm(15,"ion-icon",5),e.k0s()()()()(),e.DNE(16,Ke,3,4,"ion-col",6),e.k0s()()()(),e.j41(17,"ion-content")(18,"ion-grid",7)(19,"ion-row")(20,"ion-col",8)(21,"div",9),e.DNE(22,Qe,2,2,"div",10),e.k0s()(),e.DNE(23,et,3,3,"ion-col",11),e.k0s()()()),2&t&&(e.R7$(12),e.JRh(n.title),e.R7$(4),e.Y8G("ngForOf",n.weekDayHeaders),e.R7$(6),e.Y8G("ngForOf",n.hours),e.R7$(),e.Y8G("ngForOf",n.weekDayHeaders))},dependencies:[m.Sq,m.bT,r.hU,r.W9,r.lO,r.eU,r.iq,r.ln,r.ai,C.aY],styles:[".schedule-header[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]{text-transform:uppercase}.schedule-header[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .week-day-header[_ngcontent-%COMP%]{border-left:1px solid white;height:40px;line-height:40px}.schedule-header[_ngcontent-%COMP%]   .column-header.header-date-today[_ngcontent-%COMP%]   .week-day-header[_ngcontent-%COMP%]{background-color:var(--quiculum-pink);color:#fff}.schedule-header[_ngcontent-%COMP%]   .column-header.time-column[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:40px}.schedule-content[_ngcontent-%COMP%]{background-color:#eee}.schedule-content[_ngcontent-%COMP%]   .hour[_ngcontent-%COMP%]{height:60px;padding:2px 16px;font-size:1.5em;color:var(--quiculum-gray)}.schedule-content[_ngcontent-%COMP%]   .day-column[_ngcontent-%COMP%]   .column-content[_ngcontent-%COMP%]{position:relative;border-left:1px solid white}.schedule-content[_ngcontent-%COMP%]   .day-column[_ngcontent-%COMP%]   .column-content[_ngcontent-%COMP%]   .week-schedule-activity[_ngcontent-%COMP%]{background-color:#fff;border-left:5px solid var(--quiculum-gray);position:absolute;padding:2px 2px 2px 5px;font-size:.9em;opacity:.85}.schedule-content[_ngcontent-%COMP%]   .day-column[_ngcontent-%COMP%]   .column-content[_ngcontent-%COMP%]   .week-schedule-activity[_ngcontent-%COMP%]   [faIcon][_ngcontent-%COMP%]{font-size:.85em;margin-top:.1em;color:var(--success)}.schedule-content[_ngcontent-%COMP%]   .day-column[_ngcontent-%COMP%]   .column-content[_ngcontent-%COMP%]   .week-schedule-activity[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:.75em}.schedule-content[_ngcontent-%COMP%]   .day-column[_ngcontent-%COMP%]   .column-content[_ngcontent-%COMP%]   .week-schedule-activity[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{font-size:.73em}.column-content[_ngcontent-%COMP%]{height:1440px;background:url(schedule-background.85ae1e37d587e91f.png) repeat}"]}),o})();var it=l(8593),st=l(4416),at=l(7175);function ot(i,o){if(1&i&&(e.j41(0,"ion-label",9),e.EFF(1),e.k0s()),2&i){const s=e.XpG(2);e.R7$(),e.SpI(" ",null==s.scheduleObject?null:s.scheduleObject.schoolName," ")}}function ct(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-item",7),e.bIt("click",function(){e.eBV(s);const n=e.XpG();return e.Njj(n.openStudentPicker())}),e.j41(1,"ion-label"),e.EFF(2),e.nI1(3,"translate"),e.DNE(4,ot,2,1,"ion-label",8),e.k0s()()}if(2&i){const s=e.XpG();e.R7$(2),e.SpI(" ",(null==s.scheduleObject?null:s.scheduleObject.name)||e.bMT(3,2,"SELECT_STUDENT")," "),e.R7$(2),e.Y8G("ngIf",s.scheduleObject)}}function rt(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-item",10),e.bIt("click",function(){e.eBV(s);const n=e.XpG();return e.Njj(n.openSchedulePicker())}),e.j41(1,"ion-label"),e.EFF(2),e.k0s()()}if(2&i){const s=e.XpG();e.R7$(2),e.SpI(" ",s.scheduleObjectLabel," ")}}function lt(i,o){1&i&&(e.j41(0,"div",11),e.nrm(1,"q-spinner"),e.k0s())}function dt(i,o){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const s=e.XpG().$implicit;e.R7$(),e.SpI(", ",s.locationName,"")}}function ut(i,o){if(1&i&&(e.j41(0,"h4"),e.EFF(1),e.k0s()),2&i){const s=e.XpG().$implicit,t=e.XpG(2);e.R7$(),e.JRh(t.getitems(s))}}function _t(i,o){if(1&i&&(e.j41(0,"h4"),e.EFF(1),e.k0s()),2&i){const s=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",s.teachingGroupName," ")}}function ht(i,o){if(1&i&&(e.j41(0,"h4"),e.EFF(1),e.k0s()),2&i){const s=e.XpG(2).$implicit,t=e.XpG(2);e.R7$(),e.JRh(t.getitems(s))}}function ft(i,o){if(1&i&&(e.qex(0),e.DNE(1,_t,2,1,"h4",18)(2,ht,2,1,"ng-template",null,0,e.C5r),e.bVm()),2&i){const s=e.sdS(3),t=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",null==t?null:t.teachingGroupName)("ngIfElse",s)}}function gt(i,o){if(1&i){const s=e.RV6();e.j41(0,"ion-item",14),e.bIt("click",function(){const n=e.eBV(s).$implicit,a=e.XpG(2);return e.Njj(a.openLesson(n))}),e.j41(1,"ion-label"),e.nrm(2,"attendance-status",15),e.j41(3,"p",16),e.EFF(4),e.DNE(5,dt,2,1,"span",17),e.k0s(),e.DNE(6,ut,2,1,"h4",17)(7,ft,4,2,"ng-container",17),e.j41(8,"p"),e.EFF(9),e.nI1(10,"qNoHtml"),e.k0s()()()}if(2&i){const s=o.$implicit,t=e.XpG(2);e.xc7("border-left-color",s.color),e.R7$(2),e.Y8G("activity",s)("userInfo",t.userInfo),e.R7$(2),e.Lme(" ",s.startTime," - ",s.endTime," "),e.R7$(),e.Y8G("ngIf",s.locationName),e.R7$(),e.Y8G("ngIf",!t.isTeacher),e.R7$(),e.Y8G("ngIf",t.isTeacher),e.R7$(2),e.JRh(e.bMT(10,10,s.publicInfo))}}function mt(i,o){if(1&i&&(e.j41(0,"ion-list",12),e.DNE(1,gt,11,12,"ion-item",13),e.k0s()),2&i){const s=e.XpG();e.R7$(),e.Y8G("ngForOf",s.activities)}}const pt=[{path:"",component:(()=>{var i;class o extends P.v{constructor(t,n,a,c,d,_,h,f,p,T,b,Tt,Pt){super(t,a,n,c,d,_),this.modalCtrl=h,this.scheduleService=f,this.students=p,this.teachers=T,this.dateService=b,this.screenOrientation=Tt,this.studentService=Pt,this.isBusy=!0,this.userInfo={},this.landscapeModal=null,this.filteredStudents=[]}get activities(){return this.scheduleDay?this.scheduleDay.scheduleActivities:[]}ngOnInit(){var t=this;return(0,u.A)(function*(){const n=t.userInfoProvider.userInfoState.subscribe(a=>{t.userInfo=a});t.addSub(n)})()}getStudents(){var t=this;return(0,u.A)(function*(){try{const a=(yield t.studentService.getStudents()).filter(c=>c.schoolId===t.userInfo.schoolId);return t.filteredStudents=a.map(c=>({id:c.studentId.toString(),name:`${c.firstName} ${c.lastName}`,schoolName:c.schoolName})),t.filteredStudents}catch(n){return console.error("Error fetching students:",n),yield t.students.init()}})()}ionViewWillEnter(){this.calendarMonth&&(this.calendarMonth.init(),this.userInfo&&this.userInfo.roleName&&this.initView())}ionViewDidLeave(){this.ngOnDestroy()}getitems(t){return t.subjectName?t.subjectName:Array.isArray(t.merged)&&t.merged.length>0?t.merged[0].subjectName:""}onChangeStudent(){this.loadSchedule(this.date)}onSelectDay(t){this.date=t.date,this.loadSchedule(t.date)}onSelectMonth(t){this.dateService.isSameMonth(t.startDate,Date.now())&&(this.date=new Date(Date.now()),this.loadSchedule(this.date))}openLesson(t){var n=this;return(0,u.A)(function*(){let a=t.events?t.events.find(_=>n.dateService.isSameDay(_.date,n.date)):void 0,c=(n.isAdmin||n.isTeacher)&&"Teacher"==n.type,d=yield n.modalCtrl.create({component:Ne,componentProps:{activity:t,event:a,attendanceEnabled:c}});yield d.present(),d.onDidDismiss().then(()=>{n.isTeacher&&n.loadSchedule(n.date)})})()}openSchedulePicker(){var t=this;return(0,u.A)(function*(){let n=yield t.modalCtrl.create({component:ze,componentProps:{type:t.type,id:t.id}});yield n.present();const{data:a}=yield n.onDidDismiss();a&&a.item&&(t.scheduleObject=a.item,t.type=a.type,t.id=a.id,t.loadSchedule(t.date))})()}openStudentPicker(){var t=this;return(0,u.A)(function*(){let n=yield t.modalCtrl.create({component:xe.M,componentProps:{items:t.filteredStudents}});yield n.present();const{data:a}=yield n.onDidDismiss();a&&a.item&&(!t.id||a.item.id!=t.id)&&(t.scheduleObject=a.item,t.id=a.item.id,t.loadSchedule(t.date))})()}get isGuardian(){return this.userInfo&&this.userInfo&&("Guardian"==this.userInfo.roleName||"StudentAssistant"==this.userInfo.roleName)}get isTeacher(){return this.userInfo&&this.userInfo&&"Teacher"==this.userInfo.roleName}get isAdmin(){return this.userInfo&&("Admin"==this.userInfo.roleName||"StudentAdmin"===this.userInfo.roleName)}get scheduleObjectLabel(){if(!this.translations)return"";if(this.type&&this.scheduleObject){let t=this.translations[this.type.toUpperCase()];return`${this.scheduleObject.name} [${t}]`}return this.translations.SELECT_SCHEDULE}attendanceCheckVisible(t){if(!this.userInfo)return!1;switch(this.userInfo.roleName){case"Admin":case"Teacher":return t.reportedAttendance;case"Guardian":case"Student":return t.attendanceType&&"Attended"==t.attendanceType.attendanceCategory;default:return!1}}handleOrientationChange(t){var n=this;return(0,u.A)(function*(){n.screenOrientation.type.indexOf("landscape")>-1?(n.landscapeModal=yield n.modalCtrl.create({component:nt,componentProps:{date:n.date,type:n.type,id:n.id}}),n.landscapeModal.present()):null!==n.landscapeModal&&(yield n.landscapeModal.dismiss(),n.landscapeModal=null)})()}initView(){var t=this;return(0,u.A)(function*(){t.translations=yield(0,g.s)(t.translateService.get(["SELECT_SCHEDULE","TEACHER","STUDENT","LOCATION"])),t.date=new Date(Date.now()),yield t.setRole(),yield t.loadToday(),t.addSub(t.screenOrientation.onChange().subscribe(n=>t.handleOrientationChange(n))),t.handleOrientationChange()})()}setRole(){var t=this;return(0,u.A)(function*(){if("Guardian"==t.userInfo.roleName||"StudentAssistant"==t.userInfo.roleName){t.type="Student";let n=yield t.getStudents();t.id=n.length>0?Number(n[0].id):void 0,t.scheduleObject=n.find(a=>Number(a.id)===t.id)}else"Student"==t.userInfo.roleName?(t.type="Student",t.id=t.userInfo.studentId):"Teacher"==t.userInfo.roleName&&(t.type="Teacher",t.id=t.userInfo.teacherId,yield t.teachers.init(),t.scheduleObject=t.teachers.list.find(n=>Number(n.id)==t.id))})()}loadToday(){var t=this;return(0,u.A)(function*(){let n=new Date(Date.now());yield t.loadSchedule(n)})()}loadSchedule(t){var n=this;return(0,u.A)(function*(){n.type&&n.id?(n.scheduleDay=yield n.scheduleService.getScheduleDay(t,n.type,n.id),n.scheduleDay.scheduleActivities.forEach(a=>a.endTime=n.scheduleService.calculateEndTime(a.startTime,a.duration)),n.isBusy=!1):n.isBusy=!1})()}}return(i=o).\u0275fac=function(t){return new(t||i)(e.rXU(O.$),e.rXU(r.Xi),e.rXU(y.Ix),e.rXU(S.c$),e.rXU(R.p),e.rXU(j.Z),e.rXU(r.W3),e.rXU(U.l),e.rXU(V.s),e.rXU(X.H),e.rXU(G.k),e.rXU(w.Z),e.rXU(it.b))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-schedule"]],viewQuery:function(t,n){if(1&t&&e.GBs(k.W,5),2&t){let a;e.mGM(a=e.lsd())&&(n.calendarMonth=a.first)}},features:[e.Vt3],decls:10,vars:7,consts:[["noName",""],[3,"pageTitle"],["lines","none","button","","button","",3,"click",4,"ngIf"],["lines","none","button","",3,"click",4,"ngIf"],[3,"selectDay","selectMonth"],["class","ion-padding-top",4,"ngIf"],["class","margin-top",4,"ngIf"],["lines","none","button","","button","",3,"click"],["class","light-label",4,"ngIf"],[1,"light-label"],["lines","none","button","",3,"click"],[1,"ion-padding-top"],[1,"margin-top"],["class","activity",3,"border-left-color","click",4,"ngFor","ngForOf"],[1,"activity",3,"click"],[1,"ion-float-right",3,"activity","userInfo"],[1,"time"],[4,"ngIf"],[4,"ngIf","ngIfElse"]],template:function(t,n){1&t&&(e.j41(0,"app-header",1),e.nI1(1,"translate"),e.j41(2,"ion-header")(3,"ion-toolbar"),e.DNE(4,ct,5,4,"ion-item",2)(5,rt,3,1,"ion-item",3),e.j41(6,"calendar-month",4),e.bIt("selectDay",function(c){return n.onSelectDay(c)})("selectMonth",function(c){return n.onSelectMonth(c)}),e.k0s()()()(),e.j41(7,"ion-content"),e.DNE(8,lt,2,0,"div",5)(9,mt,2,1,"ion-list",6),e.k0s()),2&t&&(e.FS9("pageTitle",e.bMT(1,5,"SCHEDULE_TITLE")),e.R7$(4),e.Y8G("ngIf",n.isGuardian),e.R7$(),e.Y8G("ngIf",n.isAdmin||n.isTeacher),e.R7$(3),e.Y8G("ngIf",n.isBusy),e.R7$(),e.Y8G("ngIf",!n.isBusy))},dependencies:[m.Sq,m.bT,r.W9,r.eU,r.uz,r.he,r.nf,r.ai,$,k.W,st.l,F.t,S.D9,at.P],styles:[".activity[_ngcontent-%COMP%]{margin-bottom:2px;border-left:3px solid}.activity[_ngcontent-%COMP%]   fa-icon[_ngcontent-%COMP%]{color:var(--success)}.student-select[_ngcontent-%COMP%]{max-width:100%}.light-label[_ngcontent-%COMP%]{color:#000;font-size:.7em;margin-top:4px;float:right;font-weight:400!important}"]}),o})()}];let vt=(()=>{var i;class o{}return(i=o).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[y.iI.forChild(pt),y.iI]}),o})();var It=l(7019),yt=l(1683);let St=(()=>{var i;class o{}return(i=o).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[m.MD,I.YN,r.bv,vt,It.h,S.h,yt.Y]}),o})()},8775:(x,A,l)=>{l.d(A,{V:()=>I});var m=l(4438);let I=(()=>{var r;class y{transform(g){return(g=g?g.replace(/href\s*=\s*["']([^"']+)["']/gi,(k,P)=>`href="${P.replace(/\n|<[^>]+>/g,"")}"`):"")?g.replace(/\n/g,"<br/>"):""}}return(r=y).\u0275fac=function(g){return new(g||r)},r.\u0275pipe=m.EJ8({name:"nlHtml",type:r,pure:!0}),y})()},8292:(x,A,l)=>{l.d(A,{H:()=>u});var m=l(2129),I=l(4438),r=l(6244),y=l(6186);let u=(()=>{var g;class k extends m.h{constructor(v,e){super(v,e),this.listEndpoint="api/teachers/list"}}return(g=k).\u0275fac=function(v){return new(v||g)(I.KVO(r.j),I.KVO(y.B))},g.\u0275prov=I.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),k})()}}]);